<!DOCTYPE html>

<html lang="en-US">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="LispBM Reference Documentation - LispBM Array Extensions Reference Manual">
  <meta name="keywords" content="lispbm, lisp, reference, documentation, embedded lisp, microcontroller, LispBM Array Extensions Reference Manual">
  <meta name="author" content="Bo Joel Svensson">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO Meta Tags -->

  <link rel="canonical" href="https://www.lispbm.com/lispbm-reference-manual/arrayref/" />
  <meta name="robots" content="index, follow">

  <!-- Open Graph Meta Tags -->

  <meta property="og:title" content="LispBM Array Extensions Reference Manual">
  <meta property="og:description" content="LispBM Reference Documentation - LispBM Array Extensions Reference Manual">
  <meta property="og:image" content="https://www.lispbm.com/images/lispbm_llama_small.png">
  <meta property="og:url" content="https://www.lispbm.com/lispbm-reference-manual/arrayref/">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="LispBM">

  <!-- Twitter Card Meta Tags -->

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="LispBM Array Extensions Reference Manual">
  <meta name="twitter:description" content="LispBM Reference Documentation - LispBM Array Extensions Reference Manual">
  <meta name="twitter:image" content="https://www.lispbm.com/images/lispbm_llama_small.png">

  <link rel="apple-touch-icon" sizes="180x180" href="https://www.lispbm.com/ico/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.lispbm.com/ico/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.lispbm.com/ico/favicon-16x16.png">
  <link rel="shortcut icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="icon" type="image/vnd.microsoft.icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="icon" type="image/x-icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="manifest" href="https://www.lispbm.com/ico/site.webmanifest">

  <link rel="stylesheet" href="reference.css">

  <title>LispBM Array Extensions Reference Manual</title>
</head>

<body>

<div style="max-width: 900px; margin: 0 auto; padding: 20px;">
  <div style="margin-bottom: 20px;">
    <a href="index.html" style="color: #007bff; text-decoration: none;">← Back to Reference Manual Index</a>
  </div>

<!-- Content starts here -->

<div data-pagefind-body>
<div data-pagefind-filter="Platform">Core LispBM</div>
<div data-pagefind-filter="Document">Arrayref</div>
# LispBM Array Extensions Reference Manual

<p>The array extensions provide functions for reading and writing typed values into byte buffers, copying buffer contents, and freeing arrays. These extensions may or may not be present depending on the platform and configuration of LispBM.</p>
<p>Byte arrays are created using <code>bufcreate</code>, which is part of core LispBM and documented in the LispBM reference manual. All index and length arguments are in bytes. Multi-byte operations default to big-endian byte order unless <code>'little-endian</code> is passed as an optional argument.</p>
<h2 id="buffer-utilities">Buffer Utilities</h2>
<h3 id="buflen">buflen</h3>
<p><code>buflen</code> returns the size of a byte array in bytes. The form of a <code>buflen</code> expression is <code>(buflen buf)</code>.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb1"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>(buflen (bufcreate <span class="dv">10</span>))</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb2"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="dv">10</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb3"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>(buflen (bufcreate <span class="dv">0</span>))</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb4"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="dv">0</span></span></code></pre></div>
</td>
</tr>
</table>

<hr />
<h3 id="bufclear">bufclear</h3>
<p><code>bufclear</code> clears a byte array by setting bytes to a given value. The form is <code>(bufclear buf)</code> or with optional arguments <code>(bufclear buf byte start len)</code>. All optional arguments can be omitted from the right. The default fill byte is 0, the default start is 0, and the default length is the remainder of the array from start. Returns <code>t</code>.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb5"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">4</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>(bufset-u8 b <span class="dv">0</span> <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>(bufset-u8 b <span class="dv">1</span> <span class="dv">2</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>(bufset-u8 b <span class="dv">2</span> <span class="dv">3</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>(bufset-u8 b <span class="dv">3</span> <span class="dv">4</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>(bufclear b)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>b</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb6"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>[<span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span>]</span></code></pre></div>
</td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb7"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">4</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>(bufset-u8 b <span class="dv">0</span> <span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>(bufset-u8 b <span class="dv">1</span> <span class="dv">2</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>(bufset-u8 b <span class="dv">2</span> <span class="dv">3</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>(bufset-u8 b <span class="dv">3</span> <span class="dv">4</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>(bufclear b <span class="dv">255</span> <span class="dv">1</span> <span class="dv">2</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>b</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb8"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>[<span class="dv">1</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">4</span>]</span></code></pre></div>
</td>
</tr>
</table>

<hr />
<h3 id="bufcpy">bufcpy</h3>
<p><code>bufcpy</code> copies bytes from one byte array to another. The form is <code>(bufcpy dst dst-start src src-start len)</code>. Copies <code>len</code> bytes from <code>src</code> starting at <code>src-start</code> into <code>dst</code> starting at <code>dst-start</code>. The number of bytes copied is clamped to fit within both arrays. Returns <code>t</code>.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb9"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>(define dst (bufcreate <span class="dv">4</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>(define src (bufcreate <span class="dv">4</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>(bufset-u8 src <span class="dv">0</span> <span class="dv">10</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>(bufset-u8 src <span class="dv">1</span> <span class="dv">20</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>(bufset-u8 src <span class="dv">2</span> <span class="dv">30</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>(bufset-u8 src <span class="dv">3</span> <span class="dv">40</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>(bufcpy dst <span class="dv">0</span> src <span class="dv">0</span> <span class="dv">4</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>dst</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb10"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>[<span class="dv">10</span> <span class="dv">20</span> <span class="dv">30</span> <span class="dv">40</span>]</span></code></pre></div>
</td>
</tr>
</table>

<hr />
<h2 id="writing-to-buffers">Writing to Buffers</h2>
<h3 id="bufset-x">bufset-[X]</h3>
<p>The <code>bufset</code> functions write a typed value into a byte array at a given byte index. The form is <code>(bufset-[X] buf index value)</code> or <code>(bufset-[X] buf index value 'little-endian)</code>. The available variants are:</p>
<ul>
<li>bufset-i8 — signed 8-bit integer</li>
<li>bufset-i16 — signed 16-bit integer</li>
<li>bufset-i32 — signed 32-bit integer</li>
<li>bufset-u8 — unsigned 8-bit integer</li>
<li>bufset-u16 — unsigned 16-bit integer</li>
<li>bufset-u24 — unsigned 24-bit integer</li>
<li>bufset-u32 — unsigned 32-bit integer</li>
<li>bufset-f32 — 32-bit float</li>
</ul>
<p>Multi-byte variants default to big-endian byte order. Pass <code>'little-endian</code> as the optional fourth argument to write in little-endian order. Returns <code>t</code> on success.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb11"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">8</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>(bufset-i16 b <span class="dv">0</span> <span class="dv">-1000</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>(bufset-u16 b <span class="dv">2</span> <span class="dv">5000</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>(bufset-f32 b <span class="dv">4</span> <span class="fl">3.140000</span>f32)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>b</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb12"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>[<span class="dv">252</span> <span class="dv">24</span> <span class="dv">19</span> <span class="dv">136</span> <span class="dv">64</span> <span class="dv">72</span> <span class="dv">245</span> <span class="dv">195</span>]</span></code></pre></div>
</td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb13"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">8</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>(bufset-i16 b <span class="dv">0</span> <span class="dv">-1000</span> <span class="at">&#39;little-endian</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>(bufset-u16 b <span class="dv">2</span> <span class="dv">5000</span> <span class="at">&#39;little-endian</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>(bufset-f32 b <span class="dv">4</span> <span class="fl">3.140000</span>f32 <span class="at">&#39;little-endian</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>b</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb14"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>[<span class="dv">24</span> <span class="dv">252</span> <span class="dv">136</span> <span class="dv">19</span> <span class="dv">195</span> <span class="dv">245</span> <span class="dv">72</span> <span class="dv">64</span>]</span></code></pre></div>
</td>
</tr>
</table>

<hr />
<h3 id="bufset-bit">bufset-bit</h3>
<p><code>bufset-bit</code> sets a single bit in a byte array. The form is <code>(bufset-bit buf bit-pos value)</code>. The <code>bit-pos</code> argument is the absolute bit position in the array, where bit 0 is the least significant bit of byte 0, bit 8 is the least significant bit of byte 1, and so on. A truthy <code>value</code> sets the bit to 1; a falsy value sets it to 0. Returns <code>t</code>.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb15"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">2</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>(bufset-bit b <span class="dv">0</span> <span class="dv">1</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>(bufset-bit b <span class="dv">1</span> <span class="dv">1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>(bufset-bit b <span class="dv">7</span> <span class="dv">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>(bufset-bit b <span class="dv">8</span> <span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>b</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb16"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>[<span class="dv">131</span> <span class="dv">1</span>]</span></code></pre></div>
</td>
</tr>
</table>

<hr />
<h2 id="reading-from-buffers">Reading from Buffers</h2>
<h3 id="bufget-x">bufget-[X]</h3>
<p>The <code>bufget</code> functions read a typed value from a byte array at a given byte index. The form is <code>(bufget-[X] buf index)</code> or <code>(bufget-[X] buf index 'little-endian)</code>. The available variants are:</p>
<ul>
<li>bufget-i8 — signed 8-bit integer</li>
<li>bufget-i16 — signed 16-bit integer</li>
<li>bufget-i32 — signed 32-bit integer</li>
<li>bufget-u8 — unsigned 8-bit integer</li>
<li>bufget-u16 — unsigned 16-bit integer</li>
<li>bufget-u24 — unsigned 24-bit integer</li>
<li>bufget-u32 — unsigned 32-bit integer</li>
<li>bufget-f32 — 32-bit float</li>
</ul>
<p>Multi-byte variants default to big-endian byte order. Pass <code>'little-endian</code> as the optional third argument to read in little-endian order. The byte order used when reading must match the byte order used when writing.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb17"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">4</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>(bufset-u16 b <span class="dv">0</span> <span class="dv">1000</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>(bufset-u16 b <span class="dv">2</span> <span class="dv">2000</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>(bufget-u16 b <span class="dv">0</span>)</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb18"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="dv">1000</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb19"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">4</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>(bufset-i16 b <span class="dv">0</span> <span class="dv">-500</span> <span class="at">&#39;little-endian</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>(bufget-i16 b <span class="dv">0</span> <span class="at">&#39;little-endian</span>)</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb20"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="dv">-500</span></span></code></pre></div>
</td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb21"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>(define b (bufcreate <span class="dv">4</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>(bufset-f32 b <span class="dv">0</span> <span class="fl">2.718000</span>f32 <span class="at">&#39;little-endian</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>(bufget-f32 b <span class="dv">0</span> <span class="at">&#39;little-endian</span>)</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb22"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="fl">2.718000</span>f32</span></code></pre></div>
</td>
</tr>
</table>

<hr />
<h2 id="memory-management">Memory Management</h2>
<h3 id="free">free</h3>
<p><code>free</code> explicitly frees a byte array, returning its memory immediately rather than waiting for garbage collection. The form is <code>(free buf)</code>. The array must be a read-write (non-constant) byte array. Returns <code>t</code> on success or <code>nil</code> if the array could not be freed. After calling <code>free</code>, the array must not be accessed again.</p>
<p>Use <code>free</code> with care. Accessing a freed array results in undefined behaviour.</p>
<table>
<tr>
<td> Example </td> <td> Result </td>
</tr>
<tr>
<td>

<div class="sourceCode" id="cb23"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>(free (bufcreate <span class="dv">100</span>))</span></code></pre></div>
</td>
<td>

<div class="sourceCode" id="cb24"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>t</span></code></pre></div>
</td>
</tr>
</table>

<hr />
<p>This document was generated by LispBM version 0.36.0</p>
</div> <!-- Close pagefind-body -->
</div> <!-- Close container -->

<footer style="margin-top: 50px; padding: 20px; background: #f8f9fa; border-top: 1px solid #dee2e6; text-align: center;">
  <p>
    <a href="index.html" style="color: #007bff; text-decoration: none;">← Back to Reference Manual Index</a> |
    <a href="https://www.lispbm.com/" style="color: #007bff; text-decoration: none;">LispBM Home</a>
  </p>

  <p>
    Please contact me with questions, suggestions or feedback at blog
    (dot) joel (dot) svensson (at) gmail (dot) com or join the
    <a href="https://discord.gg/KgD4WcnFjv">Discord server</a>.
  </p>

  <p>&copy; Copyright 2026 Bo Joel Svensson</p>

  <p><small>This page was generated using <a href="https://pandoc.org/">Pandoc</a>.</small></p>
</footer>

</body>
</html>
