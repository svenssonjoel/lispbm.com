<!DOCTYPE html>

<html lang="en-US">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="LispBM Reference Documentation - LispBM">
  <meta name="keywords" content="lispbm, lisp, reference, documentation, embedded lisp, microcontroller, LispBM">
  <meta name="author" content="Bo Joel Svensson">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO Meta Tags -->

  <link rel="canonical" href="https://www.lispbm.com/lispbm-reference-manual/vesc-lisp-documentation/" />
  <meta name="robots" content="index, follow">

  <!-- Open Graph Meta Tags -->

  <meta property="og:title" content="LispBM">
  <meta property="og:description" content="LispBM Reference Documentation - LispBM">
  <meta property="og:image" content="https://www.lispbm.com/images/lispbm_llama_small.png">
  <meta property="og:url" content="https://www.lispbm.com/lispbm-reference-manual/vesc-lisp-documentation/">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="LispBM">

  <!-- Twitter Card Meta Tags -->

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="LispBM">
  <meta name="twitter:description" content="LispBM Reference Documentation - LispBM">
  <meta name="twitter:image" content="https://www.lispbm.com/images/lispbm_llama_small.png">

  <link rel="apple-touch-icon" sizes="180x180" href="https://www.lispbm.com/ico/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.lispbm.com/ico/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.lispbm.com/ico/favicon-16x16.png">
  <link rel="shortcut icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="icon" type="image/vnd.microsoft.icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="icon" type="image/x-icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="icon" href="https://www.lispbm.com/ico/favicon.ico">
  <link rel="manifest" href="https://www.lispbm.com/ico/site.webmanifest">

  <link rel="stylesheet" href="reference.css">

  <title>LispBM</title>
</head>

<body>

<div style="max-width: 900px; margin: 0 auto; padding: 20px;">
  <div style="margin-bottom: 20px;">
    <a href="index.html" style="color: #007bff; text-decoration: none;">‚Üê Back to Reference Manual Index</a>
  </div>

<!-- Content starts here -->

<div data-pagefind-body>
<div data-pagefind-filter="Platform">VESC</div>
<div data-pagefind-filter="Document">Vesc Lisp Documentation</div>
# LispBM

<p>This is the VESC-integration of <a href="https://github.com/svenssonjoel/lispBM">lispBM</a> written by Joel Svensson. It allows the VESC to run lisp-programs in a sandboxed environment.</p>
<h3 id="feature-overview">Feature Overview</h3>
<ul>
<li>Development and testing in VESC Tool with live variable monitoring and plotting as well as CPU and memory monitoring.</li>
<li>There is a REPL in VESC Tool where code can be executed and tested live. You even have full access to the functions and bindings in the program you have uploaded.</li>
<li>Sandboxed environment, meaning that the Lisp code (hopefully) cannot freeze or crash the rest of the VESC code when it gets stuck or runs out of heap or stack memory.</li>
<li>The application runs on the VESC itself without the need for having VESC Tool connected and is stored in flash memory.</li>
<li>When a lisp-application is written to the VESC it is automatically started on each boot.</li>
</ul>
<h2 id="language-reference">Language Reference</h2>
<p><a href="lispBM/doc/lbmref.md">LispBM Language Reference</a></p>
<p>The language reference is probably the most important document to read when working with with LBM. It describes the concepts of the language and, importantly, all basic functions it provides for various operations.</p>
<p><strong>Libraries</strong></p>
<p><a href="lispBM/doc/dynref.md">Libraries</a></p>
<p>Most of these are available on ESC and Express. They are loaded dynamically when used the first time.</p>
<p><strong>LBM Gotchas and Caveats</strong></p>
<p><a href="lispBM/doc/gotchas.md">Gotchas</a></p>
<h2 id="vesc-express-libraries">VESC Express Libraries</h2>
<p>The VESC Express has some extra libraries that are documented in separate documents.</p>
<p><strong>Display Driver</strong></p>
<p><a href="lispBM/doc/displayref.md">Display Driver</a></p>
<p>The display driver allows driving many common displays using SPI, such as the ST7789, ST7735, ILI9341, ILI9488, SH8501, SSD1306 and SSD1351. There are accelerated rendering and font extensions that can be used from LispBM.</p>
<p><strong>TTF Font Renderer for Display Driver</strong></p>
<p><a href="lispBM/doc/ttfref.md">TTF Font Renderer</a></p>
<p><strong>VESC Express Wifi and TCP</strong></p>
<p><a href="https://github.com/vedderb/vesc_express/blob/main/main/wifi/README.md">VESC Express Wifi and TCP</a></p>
<p>The WiFi and TCP library allows scanning for and connecting to networks as well as creating and managing TCP connections.</p>
<p><strong>VESC Express BLE</strong></p>
<p><a href="https://github.com/vedderb/vesc_express/blob/main/main/ble/README.md">VESC Express BLE</a></p>
<p>This library allows creating a custom BLE-server with custom characteristics.</p>
<h2 id="vesc-specific-commands-and-extensions">VESC-Specific Commands and Extensions</h2>
<p>The VESC-specific extensions are documented below. If you are reading this on GitHub there is an index in the upper right corner that can be used to navigate this document. It follows you as you scroll around and also includes a search function that filters all the titles in this document.</p>
<p>Note that VESC Tool includes a collection of examples that can be used as a starting point for using LispBM on the VESC.</p>
<hr />
<h3 id="various-commands">Various Commands</h3>
<hr />
<h4 id="print">print</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>(<span class="kw">print</span> arg1 ... argN)</span></code></pre></div>
<p>Print to the VESC Tool Lisp console. Example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>(<span class="kw">print</span> <span class="st">&quot;Hello World&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;Hello World&quot;</span></span></code></pre></div>
<p>Should work for all types. If multiple arguments are provided, each one will be printed on a separate line.</p>
<hr />
<h4 id="puts">puts</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>(puts <span class="kw">str</span>)</span></code></pre></div>
<p>Similar to <code>print</code>, but only takes one string as an argument and prints it without quotes. The string extensions can be used to format the output.</p>
<p><strong>Note:</strong><br />
This extension can print longer strings than <code>print</code>. <code>print</code> will trim any output over 256 bytes, while this extension only trims strings over 400 bytes.</p>
<p>Example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>(puts <span class="st">&quot;Hello World&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">&gt;</span> Hello World</span></code></pre></div>
<hr />
<h4 id="set-print-prefix">set-print-prefix</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>(set-print-prefix <span class="kw">str</span>)</span></code></pre></div>
<p>Adds a prefix to prints that are sent to the repl in VESC Tool. Useful when multiple devices print to the repl over CAN at the same time for determining which print comes from which device. The prefix can't be longer than 50 bytes (including the null byte), and <code>str</code> will be trimmed if longer. The value is remembered until the next power cycle.</p>
<p><strong>Note:</strong><br />
This is applied to all text sent to the repl, not just text created by calling <code>print</code> or <code>puts</code>.</p>
<p>Example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>(set-print-prefix <span class="st">&quot;dev-1| &quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>(puts <span class="st">&quot;This message has</span><span class="sc">\n</span><span class="st">a clear origin!&quot;</span>)</span></code></pre></div>
<p>which outputs</p>
<pre><code>dev-1| This message has
dev-1| a clear origin!
</code></pre>
<hr />
<h4 id="set-fw-name">set-fw-name</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>(set-fw-name <span class="kw">str</span>)</span></code></pre></div>
<p>Set (or override if already set in the firmware) firmware name. The firmware name is printed in the CAN-list in VESC Tool when it is set. It can also be used by packages to determine if they are compatible with the connected hardware.</p>
<hr />
<h4 id="timeout-reset">timeout-reset</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>(timeout-reset)</span></code></pre></div>
<p>Reset the timeout that stops the motor. This has to be run on at least every second to keep the motor running. The timeout time can be configured in App Settings-&gt;General. The <a href="#motor-set-commands">Motor Set Commands</a> will also reset the timeout when they are called.</p>
<hr />
<h4 id="get-ppm">get-ppm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>(get-ppm)</span></code></pre></div>
<p>Read the decoded value on the PPM input, range -1.0 to 1.0. If the PPM-decoder is not running it will be initialized and the PPM-pin will be reconfigured, so make sure that nothing else is using that pin. Example:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>(<span class="kw">print</span> (str-from-n (get-ppm) <span class="st">&quot;PPM Value: %.2f&quot;</span>))</span></code></pre></div>
<p>Note that control type can be set to Off in the PPM app to get the input without running the motor automatically, which is useful when running the motor from lisp.</p>
<hr />
<h4 id="get-ppm-age">get-ppm-age</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>(get-ppm-age)</span></code></pre></div>
<p>Get the age of the last PPM update in seconds. Can be used to determine if there is any valid PPM-signal.</p>
<hr />
<h4 id="set-servo">set-servo</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>(set-servo value)</span></code></pre></div>
<p>Set servo output to value. Range 0 to 1. Note that the servo output has to be enabled in App Settings -&gt; General.</p>
<hr />
<h4 id="get-vin">get-vin</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>(get-vin)</span></code></pre></div>
<p>Get input voltage.</p>
<hr />
<h4 id="select-motor">select-motor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>(select-motor motor)</span></code></pre></div>
<p>Select which motor to control on dual-motor hardware. Options are 1 for motor 1 and 2 for motor 2.</p>
<hr />
<h4 id="get-selected-motor">get-selected-motor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>(get-selected-motor)</span></code></pre></div>
<p>Get currently selected motor on dual motor hardware.</p>
<hr />
<h4 id="get-bms-val">get-bms-val</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>(get-bms-val <span class="kw">val</span> optValArg)</span></code></pre></div>
<p>Get value from BMS. Examples:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-v-tot</span>) <span class="co">; Total voltage</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-v-charge</span>) <span class="co">; Charge input voltage</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-i-in-ic</span>) <span class="co">; Measured current (negative means charging)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-ah-cnt</span>) <span class="co">; Amp hour counter</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-wh-cnt</span>) <span class="co">; Watt hour counter</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-cell-num</span>) <span class="co">; Number of cells in series</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-v-cell</span> <span class="dv">2</span>) <span class="co">; Cell 3 voltage (index starts from 0)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-bal-state</span> <span class="dv">2</span>) <span class="co">; Cell 3 balancing state. 0: not balancing, 1: balancing</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-temp-adc-num</span>) <span class="co">; Temperature sensor count</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-temps-adc</span> <span class="dv">2</span>) <span class="co">; Get sensor 3 temperature (index starts from 0)</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-temp-ic</span>) <span class="co">; Balance IC temperature</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-temp-hum</span>) <span class="co">; Humidity sensor temperature</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-hum</span>) <span class="co">; Humidity</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-pres</span>) <span class="co">; Pressure in PA (Added in 6.05)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-temp-cell-max</span>) <span class="co">; Maximum cell temperature</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-v-cell-min</span>) <span class="co">; Minimum cell voltage (added in 6.06)</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-v-cell-max</span>) <span class="co">; Maximum cell voltage (added in 6.06)</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-soc</span>) <span class="co">; State of charge (0.0 to 1.0)</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-soh</span>) <span class="co">; State of health (0.0 to 1.0)</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-can-id</span>) <span class="co">; CAN ID of BMS</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-ah-cnt-chg-total</span>) <span class="co">; Total ah charged</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-wh-cnt-chg-total</span>) <span class="co">; Total wh charged</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-ah-cnt-dis-total</span>) <span class="co">; Total ah discharged</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-wh-cnt-dis-total</span>) <span class="co">; Total wh discharged</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-msg-age</span>) <span class="co">; Age of last message from BMS in seconds</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-chg-allowed</span>) <span class="co">; Charging allowed (Added in 6.05, Express only)</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-data-version</span>) <span class="co">; Data version (added in 6.06)</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true"></a>(get-bms-val <span class="at">&#39;bms-status</span>) <span class="co">; Status string (added in 6.06)</span></span></code></pre></div>
<p><strong>Note</strong><br />
In firmware 6.06 the following temperature sensor convention was introduced for bms-temps-adc. So when using (get-bms-val 'bms-temps-adc 2) the maximum cell temperature should be returned. If a temperature returns less than -280 degC that reading is not applicable on that BMS. Keep in mind that it will take some time before all BMSes follow this convention after the 6.06 release. (get-bms-val 'bms-data-version) should return 1 if this convention is used.</p>
<table>
<thead>
<tr class="header">
<th>Sensor Index</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Balance IC</td>
</tr>
<tr class="even">
<td>1</td>
<td>Cell Min</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Cell Max</td>
</tr>
<tr class="even">
<td>3</td>
<td>Mosfet Switch</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Ambient Temperature</td>
</tr>
<tr class="even">
<td>5+</td>
<td>Optional sensors</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="set-bms-val">set-bms-val</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>(set-bms-val <span class="kw">val</span> optValArg new-value)</span></code></pre></div>
<p>This lets you set BMS-values so that VESC Tool and the BMS limits can see and use them. The same values as described in <a href="#get-bms-val">get-bms-val</a> can be updated, but with an argument at the end with what the value should be set to.</p>
<p>This is useful if you want to implement communication with a custom BMS and have it show up in VESC Tool.</p>
<p>Example:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>(set-bms-val <span class="at">&#39;bms-cell-num</span> <span class="dv">12</span>) <span class="co">; It is a 12s pack</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>(set-bms-val <span class="at">&#39;bms-v-cell</span> <span class="dv">2</span> <span class="fl">3.92</span>) <span class="co">; Set cell 2 voltage to 3.92V</span></span></code></pre></div>
<hr />
<h4 id="send-bms-can">send-bms-can</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb21"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>(send-bms-can)</span></code></pre></div>
<p>Send BMS-values on CAN-bus. This his useful if a custom BMS-driver is implemented using <a href="#set-bms-val">set-bms-val</a> in order to make devices on the CAN-bus aware of the BMS-state using the VESC protocol.</p>
<hr />
<h4 id="set-bms-chg-allowed">set-bms-chg-allowed</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>(set-bms-chg-allowed allow)</span></code></pre></div>
<p>Enable or disable charging. 1 means enable and 0 means disable.</p>
<hr />
<h4 id="bms-force-balance">bms-force-balance</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>(bms-force-balance balance)</span></code></pre></div>
<p>Start or stop balancing. 1 means start and 0 means stop.</p>
<hr />
<h4 id="bms-zero-offset">bms-zero-offset</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb24"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>(bms-zero-offset)</span></code></pre></div>
<p>Zero current measurement offset on BMS. Has to be done while no current (or charge-current on charge-only BMS) is flowing. Will be sent to every BMS on the CAN-bus.</p>
<hr />
<h4 id="bms-st">bms-st</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb25"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>(bms-st can-id)</span></code></pre></div>
<p>Run self-test on BMS with can-id. Returns the following list on success, otherwise timeout:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>    <span class="dv">1</span> <span class="co">; Balance IC OK</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    <span class="dv">1</span> <span class="co">; Balamce connection check OK</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>    <span class="dv">8</span> <span class="co">; Cell num (8 Cells)</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.691400</span>f32 <span class="fl">3.561700</span>f32) <span class="co">; Cell 1 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.687200</span>f32 <span class="fl">3.367500</span>f32) <span class="co">; Cell 2 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.687500</span>f32 <span class="fl">3.377500</span>f32) <span class="co">; Cell 3 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.688900</span>f32 <span class="fl">3.389400</span>f32) <span class="co">; Cell 4 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.690100</span>f32 <span class="fl">3.401900</span>f32) <span class="co">; Cell 5 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.688800</span>f32 <span class="fl">3.413800</span>f32) <span class="co">; Cell 6 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.689000</span>f32 <span class="fl">3.424600</span>f32) <span class="co">; Cell 7 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a>    (<span class="dv">1</span> <span class="fl">3.688900</span>f32 <span class="fl">3.433300</span>f32) <span class="co">; Cell 8 OK, V_BAL, V_NO_BAL</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a>)</span></code></pre></div>
<hr />
<h4 id="get-adc">get-adc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb27"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>(get-adc ch)</span></code></pre></div>
<p>Get ADC voltage on channel ch (0, 1, 2 or 3). The channels are the following:</p>
<p><strong>Channel 0:</strong><br />
ADC1 on the COMM-port</p>
<p><strong>Channel 1:</strong><br />
ADC2 on the COMM-port</p>
<p><strong>Channel 2:</strong><br />
ADC3 on the COMM-port. Note that some hardware does not have this channel - then the voltage of ADC1 is returned instead.</p>
<p><strong>Channel 3:</strong><br />
This is the ADC-channel that the motor temperature sensor goes to. Note: if you want to use this channel for something else you have to disable the motor temperature sensor in General -&gt; Advanced. Otherwise the input might generate overtemperature faults.</p>
<p><strong>Channel 4+:</strong><br />
Some hardware has additional ADC-channels which also can be read with this function. If they are missing the voltage on ADC1 is returned instead.</p>
<p><strong>Channel 20 (FW6.06+):</strong><br />
Sin/Cos encoder SIN channel</p>
<p><strong>Channel 21 (FW6.06+):</strong><br />
Sin/Cos encoder COS channel</p>
<hr />
<h4 id="override-temp-motor">override-temp-motor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>(override-temp-motor temp)</span></code></pre></div>
<p>Override motor temperature. This can be used to implement custom motor temperature sensors if the sensor you have is not supported. Note: Motor Temperature Sensor Type has to be set to Disabled in General -&gt; Advanced for the override to work.</p>
<hr />
<h4 id="get-adc-decoded">get-adc-decoded</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb29"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>(get-adc-decoded ch)</span></code></pre></div>
<p>Get decoded ADC value on channel ch (0 or 1). Decoded means that the voltage is mapped to the range 0 to 1 according to the configuration in the ADC app. Note that the ADC app must be running for this function to work. No throttle curve is applied to this value, but you can use the <a href="#throttle-curve">throttle-curve</a> function to apply one if desired.</p>
<hr />
<h4 id="systime">systime</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb30"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>(systime)</span></code></pre></div>
<p>Get system time in ticks since boot.</p>
<hr />
<h4 id="secs-since">secs-since</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb31"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a>(secs-since timestamp)</span></code></pre></div>
<p>Get seconds elapsed since systime timestamp.</p>
<hr />
<h4 id="set-aux">set-aux</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb32"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>(set-aux ch state)</span></code></pre></div>
<p>Set AUX output ch (1 or 2) to state. Example:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>(set-aux <span class="dv">1</span> <span class="dv">1</span>) <span class="co">; Set AUX1 to ON.</span></span></code></pre></div>
<p>Note: The AUX output mode must be set to Unused in Motor Settings-&gt;General-&gt;Advanced. Otherwise the firmware will change the AUX state directly after it is set using this function.</p>
<hr />
<h4 id="get-imu-rpy">get-imu-rpy</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb34"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>(get-imu-rpy)</span></code></pre></div>
<p>Get roll, pitch and yaw from the IMU in radians.</p>
<p>The function (ix list ind) can be used to get an element from the list. Example:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>(ix (get-imu-rpy) <span class="dv">0</span>) <span class="co">; Get roll (index 0)</span></span></code></pre></div>
<hr />
<h4 id="get-imu-quat">get-imu-quat</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb36"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>(get-imu-quat)</span></code></pre></div>
<p>Get a list of quaternions from the IMU (q0, q1, q2 and q3).</p>
<hr />
<h4 id="get-imu-acc">get-imu-acc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb37"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a>(get-imu-acc)</span></code></pre></div>
<p>Get a list of the x, y and z acceleration from the IMU in G.</p>
<hr />
<h4 id="get-imu-gyro">get-imu-gyro</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>(get-imu-gyro)</span></code></pre></div>
<p>Get a list of the x, y and z angular rate from the IMU in degrees/s.</p>
<hr />
<h4 id="get-imu-mag">get-imu-mag</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>(get-imu-mag)</span></code></pre></div>
<p>Get a list of the x, y and z magnetic field strength from the IMU in uT. Note that most IMUs do not have a magnetometer.</p>
<hr />
<h4 id="get-imu-acc-derot">get-imu-acc-derot</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Same as get-imu-acc, but derotates the result first. This means that the acceleration will be relative to the horizon and not the IMU chip.</p>
<hr />
<h4 id="get-imu-gyro-derot">get-imu-gyro-derot</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Same as get-imu-gyro, but derotates the result first. This means that the angular rates will be relative to the horizon and not the IMU chip.</p>
<hr />
<h4 id="send-data">send-data</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb40"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>(send-data dataList optInterface optCanId)</span></code></pre></div>
<p>Send a list of custom app data on the commands-interface of the type COMM_CUSTOM_APP_DATA. This can be read from a Qml script in VESC Tool for example or from another node on the CAN-bus.</p>
<p>Example of sending the numbers 1, 2, 3 and 4:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a>(send-data (<span class="kw">list</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span>))</span></code></pre></div>
<p><em>dataList</em> can be a list or a <a href="#byte-arrays">byte array</a>.</p>
<p>The optional argument optInterface (introduced in FW 6.05) can be used to specify which interface to use and the optional argument optCanId can be used to specify which CAN-device to send the message to when using the CAN interface. The available interfaces are:</p>
<table>
<thead>
<tr class="header">
<th>Number</th>
<th>Interface Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>The last interface data was received on (default)</td>
</tr>
<tr class="even">
<td>1</td>
<td>USB</td>
</tr>
<tr class="odd">
<td>2</td>
<td>CAN (requires the argument optCanId)</td>
</tr>
<tr class="even">
<td>3</td>
<td>UART on comm-header</td>
</tr>
<tr class="odd">
<td>4</td>
<td>UART builtin (depending on hardware)</td>
</tr>
<tr class="even">
<td>5</td>
<td>UART extra (depending on hardware)</td>
</tr>
<tr class="odd">
<td>6</td>
<td>WiFi local (express)</td>
</tr>
<tr class="even">
<td>7</td>
<td>WiFi TCP Hub (express)</td>
</tr>
<tr class="odd">
<td>8</td>
<td>BLE (express)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="recv-data">recv-data</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb42"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>(recv-data optTimeout)</span></code></pre></div>
<p>Block current thread until data from VESC Tool arrives. The optional argument optTimeout can be used to specify a timeout in seconds.</p>
<p>If a timeout occurs the symbol timeout will be returned, otherwise a byte array with the data will arrive.</p>
<p>Usage example:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>(<span class="kw">print</span> (recv-data))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>]</span></code></pre></div>
<hr />
<h4 id="sleep">sleep</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb44"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a>(sleep seconds)</span></code></pre></div>
<p>Sleep for <em>seconds</em> seconds. Example:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>(sleep <span class="fl">0.05</span>) <span class="co">; Sleep for 0.05 seconds (50 ms)</span></span></code></pre></div>
<hr />
<h4 id="get-remote-state">get-remote-state</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb46"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a>(get-remote-state)</span></code></pre></div>
<p>Get button and joystick state of connected remote. Note that a remote app such as the VESC remote or nunchuk must be configured and running for this to work. Returns the following list:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>(js-y js-x bt-c bt-z is-rev update-age)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a><span class="co">; Where</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a><span class="co">; js-y : Joystick Y axis, range -1.0 to 1.0</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a><span class="co">; js-x : Joystick X axis, range -1.0 to 1.0</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a><span class="co">; bt-c : C button pressed state, 0 or 1</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a><span class="co">; bt-z : Z button pressed state, 0 or 1</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a><span class="co">; is-rev : Reverse active, 0 or 1</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true"></a><span class="co">; update-age : Age of last update from the remote in seconds</span></span></code></pre></div>
<hr />
<h4 id="sysinfo">sysinfo</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb48"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>(sysinfo param)</span></code></pre></div>
<p>Read system info parameter param. Example:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a>(sysinfo <span class="at">&#39;hw-name</span>) <span class="co">; Hardware name, e.g 60</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a>(sysinfo <span class="at">&#39;fw-ver</span>) <span class="co">; Firmware version as list (Major Minor BetaNum)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a>(sysinfo <span class="at">&#39;has-phase-filters</span>) <span class="co">; t if hardware has phase filters. ESC only.</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a>(sysinfo <span class="at">&#39;uuid</span>) <span class="co">; STM32 UUID. ESC only.</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true"></a>(sysinfo <span class="at">&#39;runtime</span>) <span class="co">; Total runtime in seconds. ESC only.</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true"></a>(sysinfo <span class="at">&#39;odometer</span>) <span class="co">; Total odometer in meters. ESC only. Added in 6.06.</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true"></a>(sysinfo <span class="at">&#39;git-branch</span>) <span class="co">; Git branch name.</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true"></a>(sysinfo <span class="at">&#39;git-hash</span>) <span class="co">; Git hash of current commit.</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true"></a>(sysinfo <span class="at">&#39;compiler</span>) <span class="co">; GCC version, e.g. 7.3.1. ESC only.</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true"></a>(sysinfo <span class="at">&#39;hw-type</span>) <span class="co">; Hardware type, e.g. hw-express. Added in 6.02.</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true"></a>(sysinfo <span class="at">&#39;part-running</span>) <span class="co">; Running partition name. Express only.</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true"></a>(sysinfo <span class="at">&#39;cpu-freq</span>)  <span class="co">; CPU frequency in MHz. Express only.</span></span></code></pre></div>
<hr />
<h4 id="stats">stats</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb50"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a>(stats param)</span></code></pre></div>
<p>Get statistics about the selected motor since boot (or since stats-reset). The following example shows which stats are available:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a>(stats <span class="at">&#39;stat-speed-avg</span>) <span class="co">; Average speed in m/s</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true"></a>(stats <span class="at">&#39;stat-speed-max</span>) <span class="co">; Maximum speed in m/s</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true"></a>(stats <span class="at">&#39;stat-power-avg</span>) <span class="co">; Average power in W</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true"></a>(stats <span class="at">&#39;stat-power-max</span>) <span class="co">; Maximum power in W</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true"></a>(stats <span class="at">&#39;stat-current-avg</span>) <span class="co">; Average current in A</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true"></a>(stats <span class="at">&#39;stat-current-max</span>) <span class="co">; Maximum current in A</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true"></a>(stats <span class="at">&#39;stat-temp-mosfet-avg</span>) <span class="co">; Average MOSFET temp in degC</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true"></a>(stats <span class="at">&#39;stat-temp-mosfet-max</span>) <span class="co">; Maximum MOSFET temp in degC</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true"></a>(stats <span class="at">&#39;stat-temp-motor-avg</span>) <span class="co">; Average motor temp in degC</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true"></a>(stats <span class="at">&#39;stat-temp-motor-max</span>) <span class="co">; Maximum motor temp in degC</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true"></a>(stats <span class="at">&#39;stat-count-time</span>) <span class="co">; Time since start of stat collection in seconds</span></span></code></pre></div>
<hr />
<h4 id="set-odometer">set-odometer</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb52"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>(set-odometer meters)</span></code></pre></div>
<p>Set persistent odometer counter to meters.</p>
<hr />
<h4 id="stats-reset">stats-reset</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb53"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>(stats-reset)</span></code></pre></div>
<p>Reset stat counters to 0.</p>
<hr />
<h4 id="crc16">crc16</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb54"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a>(crc16 array optLen)</span></code></pre></div>
<p>Calculate the 16-bit crc of array. optLen is an optional argument for how many elements to include, if it is left out the entire array will be used. The crc uses the polynomial 0x11021 and initial value 0, which is the same as the VESC packets use. Added in FW 6.02.</p>
<hr />
<h4 id="crc32">crc32</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb55"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a>(crc32 array init optLen)</span></code></pre></div>
<p>Calculate the 32-bit crc of array. optLen is an optional argument for how many elements to include, if it is left out the entire array will be used. The crc uses the polynomial 0x4C11DB7 (ethernet) and initial value init.</p>
<hr />
<h4 id="main-init-done">main-init-done</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb56"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a>(main-init-done)</span></code></pre></div>
<p>Returns true when the main-function is done with all initialization.</p>
<hr />
<h4 id="shutdown-hold">shutdown-hold</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb57"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a>(shutdown-hold hold)</span></code></pre></div>
<p>Hold shutdown. When hold is true hardware shutdown will be delayed until hold is set to false again. Can be used when catching a shutdown-event if more time is needed for cleanup.</p>
<hr />
<h4 id="reboot">reboot</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb58"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a>(reboot)</span></code></pre></div>
<p>Reboot CPU. Required on the express when e.g. changing wifi-settings.</p>
<hr />
<h4 id="override-speed">override-speed</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb59"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a>(overide-speed ovr speed)</span></code></pre></div>
<p>Override speed reported to VESC Tool (and to other extensions). The argument speed is the speed to override with in meters per second and the argument ovr is set to 1 for overriding the speed and to 0 for reporting the speed as before. Example:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a><span class="co">; Override speed with 3.6 km/h</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true"></a>(overide-speed <span class="dv">1</span> (<span class="kw">/</span> <span class="fl">12.0</span> <span class="fl">3.6</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true"></a><span class="co">; Do not override speed anymore</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true"></a>(overide-speed <span class="dv">0</span> <span class="dv">0</span>)</span></code></pre></div>
<hr />
<h3 id="app-override-commands">App Override Commands</h3>
<p>Several app-inputs can be detached from the external interfaces and overridden from lisp. This is useful to take advantage of existing throttle curves and control modes from the apps while providing a custom input source.</p>
<p><strong>Note:</strong> Detach does <em>not</em> mean that the app output is disabled, it means that you can provide the input for the app instead of having it read the external peripheral. So if you e.g. detach the app and override the input with 0 the app will keep sending the corresponding command to the motor as usual, even if that command is a stop command. If you want to disable the app output you can have a look at <a href="#app-disable-output">app-disable-output</a>.</p>
<hr />
<h4 id="app-adc-detach">app-adc-detach</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb61"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a>(app-adc-detach mode state)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true"></a><span class="co">; Where</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true"></a><span class="co">; mode : Select periperial to detach from APP</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true"></a><span class="co">;        - 0 All peripherial attached (no second argument)</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true"></a><span class="co">;        - 1 ADC1/2</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true"></a><span class="co">;        - 2 Buttons</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true"></a><span class="co">;        - 3 ADC1/2 + Buttons</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true"></a><span class="co">; state : Only used when mode is not 0. State 1, 2 or 3 detaches the peripheral and</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true"></a><span class="co">;         state 0 attaches peripheral. For the ADC, 1 means detach both ADCs, 2 means</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true"></a><span class="co">;         detach ADC1 only and 3 means detach ADC2 only. For the buttons state</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true"></a><span class="co">;         1, 2 and 3 mean the same thing, namely detach.</span></span></code></pre></div>
<p>Detaches a peripherial from the APP ADC</p>
<p><strong>Note:</strong> Since firmware 6.05 the ADC-app will no longer reset the timeout by itself when detached. That means that the override-commands have to be sent at a rate higher than the timeout for the output to stay enabled. This is a safety feature that prevents the motor from running after the timeout time if e.g. your script crashes.</p>
<hr />
<h4 id="app-adc-override">app-adc-override</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb62"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>(app-adc-override mode value)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true"></a><span class="co">; Where</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true"></a><span class="co">; mode : Select peripheral to override</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true"></a><span class="co">;        - 0 ADC1</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true"></a><span class="co">;        - 1 ADC2</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true"></a><span class="co">;        - 2 Reverse button</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true"></a><span class="co">;        - 3 Cruise control button</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true"></a><span class="co">; value : 0.0 to 3.3 (button pressed is &gt; 0.0)</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true"></a><span class="co">; Note that throttle mapping also is applied to the override value.</span></span></code></pre></div>
<p>Sets the override value</p>
<hr />
<h4 id="app-adc-range-ok">app-adc-range-ok</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb63"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>(app-adc-range-ok)</span></code></pre></div>
<p>Returns true when the throttle voltage is within range and false (nil) otherwise.</p>
<hr />
<h4 id="app-ppm-detach">app-ppm-detach</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb64"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a>(app-ppm-detach state)</span></code></pre></div>
<p>Detaches the decoded ppm signal from APP PPM. 1 means detach, 0 means attach.</p>
<hr />
<h4 id="app-ppm-override">app-ppm-override</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb65"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a>(app-ppm-override value)</span></code></pre></div>
<p>Sets the override value. Range -1.0 to 1.0.</p>
<hr />
<h4 id="set-remote-state">set-remote-state</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb66"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a>(set-remote-state js-y js-x bt-c bt-z is-rev)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true"></a><span class="co">; Where</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true"></a><span class="co">; js-y : Joystick Y axis, range -1.0 to 1.0, used for throttle position</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true"></a><span class="co">; js-x : Joystick X axis, range -1.0 to 1.0, unused by the app</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true"></a><span class="co">; bt-c : C button pressed state, 0 or 1, used for cruise control</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true"></a><span class="co">; bt-z : Z button pressed state, 0 or 1, unused by the app</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true"></a><span class="co">; is-rev : Reverse active, 0 or 1, reverse mode active</span></span></code></pre></div>
<p>Send input to the VESC Remote app. Unlike the ADC and PPM apps, input can be sent to this app at any time without detaching it and it will be treated the same as a packet from a VESC Remote. That means the timeout as well as all VESC Remote settings will be used.</p>
<hr />
<h4 id="app-disable-output">app-disable-output</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb67"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a>(app-disable-output ms)</span></code></pre></div>
<p>Disable app output for ms milliseconds. 0 means enable now and -1 means disable forever. This can be used to override the control of apps temporarily.</p>
<hr />
<h4 id="app-is-output-disabled">app-is-output-disabled</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb68"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>(app-is-output-disabled)</span></code></pre></div>
<p>Check if app output is disabled. VESC Tool will disable app output during some detection routines, so when running a custom control script it might be useful to check this and disable the output when this value is true.</p>
<hr />
<h4 id="app-pas-get-rpm">app-pas-get-rpm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb69"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true"></a>(app-pas-get-rpm)</span></code></pre></div>
<p>Returns the pedal RPM measured by the PAS-app. If you want to implement your own PAS-control based on this RPM you can use <a href="#app-disable-output">app-disable-output</a> to disable the output of the PAS-app.</p>
<hr />
<h3 id="motor-set-commands">Motor Set Commands</h3>
<hr />
<h4 id="set-current">set-current</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb70"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a>(set-current current optOffDelay)</span></code></pre></div>
<p>Set motor current in amperes.</p>
<p>The optional optOffDelay argument (in seconds) will delay turning off the modulation when setting 0 current. This is useful when running e.g. a control loop that will end up setting 0 current in some circumstances when turning off the modulation would make the control less smooth. The delay value should be longer than the rate at which the control loop runs.</p>
<hr />
<h4 id="set-current-rel">set-current-rel</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb71"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>(set-current-rel current optOffDelay)</span></code></pre></div>
<p>Set motor current relative to the maximum current. Range -1 to 1. For example, if the maximum current is set to 50A, (set-current-rel 0.5) will set the current to 25A.</p>
<p>See <a href="#set-current">set-current</a> for details on what the optional argument optOffDelay does.</p>
<hr />
<h4 id="set-duty">set-duty</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb72"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a>(set-duty dutycycle)</span></code></pre></div>
<p>Set duty cycle. Range -1.0 to 1.0.</p>
<hr />
<h4 id="set-brake">set-brake</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb73"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true"></a>(set-brake current)</span></code></pre></div>
<p>Set braking current.</p>
<hr />
<h4 id="set-brake-rel">set-brake-rel</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb74"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true"></a>(set-brake-rel current)</span></code></pre></div>
<p>Set braking current relative to the maximum current, range 0.0 to 1.0.</p>
<hr />
<h4 id="set-handbrake">set-handbrake</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb75"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true"></a>(set-handbrake current)</span></code></pre></div>
<p>Set handbrake current. This sets an open loop current that allows to hold the motor still even at 0 speed at the cost of efficient.</p>
<hr />
<h4 id="set-handbrake-rel">set-handbrake-rel</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb76"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true"></a>(set-handbrake-rel current)</span></code></pre></div>
<p>Same as set-handbrake, but with a current relative to the maximum current in the range 0.0 to 1.0.</p>
<hr />
<h4 id="set-rpm">set-rpm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb77"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true"></a>(set-rpm rpm)</span></code></pre></div>
<p>Set RPM speed control.</p>
<hr />
<h4 id="set-pos">set-pos</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb78"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true"></a>(set-pos pos)</span></code></pre></div>
<p>Position control. Set motor position in degrees, range 0.0 to 360.0.</p>
<hr />
<h4 id="foc-openloop">foc-openloop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb79"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true"></a>(foc-openloop current rpm)</span></code></pre></div>
<p>Run FOC in open loop. Useful to test thermal properties of motors and power stages.</p>
<hr />
<h4 id="foc-openloop-phase">foc-openloop-phase</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb80"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true"></a>(foc-openloop-phase current phase)</span></code></pre></div>
<p>Run FOC in open loop in phase mode. Phase is the electrical position of the openloop-vector in degrees, range 0.0 to 360.0.</p>
<hr />
<h4 id="set-kill-sw">set-kill-sw</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb81"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true"></a>(set-kill-sw state)</span></code></pre></div>
<p>Set kill switch state. When state is set to 1 the motor is disabled and optionally braking if timeout_brake_current is greater than 0. The kill switch overrides all other inputs and can be used as an emergency stop. The kill switch state here is applied as logic OR with the app settings kill switch input, so as long as any of them is active the motor will be disabled.</p>
<hr />
<h4 id="foc-beep">foc-beep</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb82"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true"></a>(foc-beep freq <span class="kw">time</span> voltage)</span></code></pre></div>
<p>Use the motor to play a beep sound at frequency freq for time seconds using voltage excitation voltage. The frequency can be set between 100 Hz and 7500 Hz.</p>
<hr />
<h4 id="foc-play-tone">foc-play-tone</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb83"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true"></a>(foc-play-tone channel freq voltage)</span></code></pre></div>
<p>Use the motor to play a tone at frequency freq with modulation voltage. Channel can be 0, 1, 2 or 3 and all channels can play tones simultaneously (polyphonic audio). Unlike foc-beep, foc-play-tone also works while the motor is running.</p>
<hr />
<h4 id="foc-play-samples">foc-play-samples</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb84"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true"></a>(foc-play-samples samples freq voltage)</span></code></pre></div>
<p>Use the motor to play sampled audio. Works while the motor is running. Samples is a byte-array with samples, where each sample has the range -128 to 127. Freq is the sampling frequency and voltage is the voltage amplitude the samples will be played at.</p>
<p>The caller is responsible for making sure that the sample buffer stays valid until it is consumed. Internally this function has two buffers and when both buffers are full the function will block until a buffer is free. For smooth playback, it is important to keep feeding this function with buffers faster than it consumes the samples.</p>
<hr />
<h4 id="foc-play-stop">foc-play-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb85"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true"></a>(foc-play-stop)</span></code></pre></div>
<p>Stop playing tones on all channels.</p>
<hr />
<h3 id="motor-get-commands">Motor Get Commands</h3>
<p><strong>Note:</strong><br />
If the optional optFilter-argument is 1 in the commands below the result will be the average since that function was called the last time. That is also how the plots are filtered in VESC Tool. Polling realtime data in VESC Tool at the same time will affect the averaging as it uses the same integrator. This function was added in firmware 6.05.</p>
<hr />
<h4 id="get-current">get-current</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb86"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true"></a>(get-current optFilter)</span></code></pre></div>
<p>Get motor current. Positive means that current is flowing into the motor and negative means that current is flowing out of the motor (regenerative braking).</p>
<hr />
<h4 id="get-current-dir">get-current-dir</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb87"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true"></a>(get-current-dir)</span></code></pre></div>
<p>Get directional current. Positive for torque in the forward direction and negative for torque in the reverse direction.</p>
<hr />
<h4 id="get-current-in">get-current-in</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb88"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true"></a>(get-current-in optFilter)</span></code></pre></div>
<hr />
<h4 id="get-id">get-id</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb89"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true"></a>(get-id optFilter)</span></code></pre></div>
<p>Get FOC d-axis current.</p>
<hr />
<h4 id="get-iq">get-iq</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb90"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true"></a>(get-iq optFilter)</span></code></pre></div>
<p>Get FOC q-axis current.</p>
<hr />
<h4 id="get-id-set">get-id-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb91"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true"></a>(get-id-set)</span></code></pre></div>
<p>Get the set FOC d-axis current. This is the raw requested current.</p>
<hr />
<h4 id="get-iq-set">get-iq-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb92"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true"></a>(get-iq-set)</span></code></pre></div>
<p>Get the set FOC q-axis current. This is the raw requested current.</p>
<hr />
<h4 id="get-vd">get-vd</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb93"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true"></a>(get-vd optFilter)</span></code></pre></div>
<p>Get FOC d-axis voltage.</p>
<hr />
<h4 id="get-vq">get-vq</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb94"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true"></a>(get-vq optFilter)</span></code></pre></div>
<p>Get FOC q-axis voltage.</p>
<hr />
<h4 id="get-est-lambda">get-est-lambda</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb95"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true"></a>(get-est-lambda)</span></code></pre></div>
<p>Get FOC estimated flux linkage in Weber. Requires that one of the observers with flux linkage tracking is used. Added in FW 6.02.</p>
<hr />
<h4 id="get-est-res">get-est-res</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb96"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true"></a>(get-est-res)</span></code></pre></div>
<p>Get FOC estimated motor resistance in Ohm. This value is only accurate when the RPM is low and current is high. Added in FW 6.02.</p>
<hr />
<h4 id="get-est-ind">get-est-ind</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb97"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true"></a>(get-est-ind)</span></code></pre></div>
<p>Get FOC estimated motor inductance Henry. Only works while the first HFI is running (not 45 Deg and not Coupled HFI). Added in FW 6.02.</p>
<hr />
<h4 id="get-hfi-res">get-hfi-res</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb98"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true"></a>(get-hfi-res)</span></code></pre></div>
<p>Get HFI result. Only valid when using single or double pulse ambiguity resolution mode. Returns a list with the following valies:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true"></a>(i1 i2 diff)</span></code></pre></div>
<p>Where i1 is the delta current for the first voltage, i2 is the response current for the second voltage and diff is the difference between them. This can be used to determine how much ambiguity resolution current is required for a given motor.</p>
<hr />
<h4 id="get-duty">get-duty</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb100"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true"></a>(get-duty)</span></code></pre></div>
<p>Get duty cycle. Range -1.0 to 1.0.</p>
<hr />
<h4 id="get-rpm">get-rpm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb101"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true"></a>(get-rpm)</span></code></pre></div>
<p>Get motor ERPM. Negative values mean that the motor spins in the reverse direction.</p>
<hr />
<h4 id="get-rpm-fast">get-rpm-fast</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb102"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true"></a>(get-rpm-fast)</span></code></pre></div>
<p>Same as get-rpm, but with less filtering. This give the RPM-estimation lower latency at the cost of more noise.</p>
<hr />
<h4 id="get-rpm-faster">get-rpm-faster</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb103"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true"></a>(get-rpm-faster)</span></code></pre></div>
<p>Same as get-rpm-fast, but with even less filtering. This give the RPM-estimation even lower latency at the cost of even more noise.</p>
<hr />
<h4 id="get-rpm-set">get-rpm-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb104"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true"></a>(get-rpm-set)</span></code></pre></div>
<p>Get motor ERPM setpoint for PID speed controller.</p>
<hr />
<h4 id="get-pos">get-pos</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb105"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true"></a>(get-pos)</span></code></pre></div>
<p>Get motor position. Returns the motor PID pos (taking into account the Position Angle Division)</p>
<hr />
<h4 id="get-temp-fet">get-temp-fet</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb106"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true"></a>(get-temp-fet optFet)</span></code></pre></div>
<p>Get MOSFET temperature. The argument optFet can be used to select senor 1 to 3. If it is left out or 0 the highest temperature is returned. If the hardware only has one sensor 0 is returned for sensors 1 to 3.</p>
<hr />
<h4 id="get-temp-mot">get-temp-mot</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb107"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true"></a>(get-temp-mot)</span></code></pre></div>
<p>Get motor temperature.</p>
<hr />
<h4 id="get-speed">get-speed</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb108"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true"></a>(get-speed)</span></code></pre></div>
<p>Get speed in meters per second. Requires that the number of motor poles, wheel diameter and gear ratio are set up correctly.</p>
<hr />
<h4 id="get-speed-set">get-speed-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb109"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true"></a>(get-speed-set)</span></code></pre></div>
<p>Get PID speed setpoint in meters per second. Requires that the number of motor poles, wheel diameter and gear ratio are set up correctly.</p>
<hr />
<h4 id="get-dist">get-dist</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb110"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true"></a>(get-dist)</span></code></pre></div>
<p>Get the distance traveled since start in meters. As with (get-speed) this requires that the number of motor poles, wheel diameter and gear ratio are set up correctly. When the motor spins forwards this counter counts up and when it spins backwards it counts down.</p>
<hr />
<h4 id="get-dist-abs">get-dist-abs</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb111"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true"></a>(get-dist-abs)</span></code></pre></div>
<p>Same as get-dist, but will count up when the motors spins in both directions.</p>
<hr />
<h4 id="get-batt">get-batt</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb112"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true"></a>(get-batt)</span></code></pre></div>
<p>Get the battery level, range 0.0 to 1.0. Requires that the battery type and number of cells is set up correctly.</p>
<hr />
<h4 id="get-fault">get-fault</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb113"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true"></a>(get-fault)</span></code></pre></div>
<p>Get fault code.</p>
<hr />
<h4 id="get-ah">get-ah</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb114"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true"></a>(get-ah)</span></code></pre></div>
<p>Get the number of amp hours consumed since start.</p>
<hr />
<h4 id="get-wh">get-wh</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb115"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true"></a>(get-wh)</span></code></pre></div>
<p>Get the number of watt hours consumed since start.</p>
<hr />
<h4 id="get-ah-chg">get-ah-chg</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb116"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true"></a>(get-ah-chg)</span></code></pre></div>
<p>Get the number of amp hours charged since start.</p>
<hr />
<h4 id="get-wh-chg">get-wh-chg</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb117"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true"></a>(get-wh-chg)</span></code></pre></div>
<p>Get the number of watt hours charged since start.</p>
<hr />
<h3 id="positions">Positions</h3>
<p>There are several position sources and many ways to interpret them. The following extensions can be used to get most interpretations of most position sources.</p>
<hr />
<h4 id="get-encoder">get-encoder</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb118"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true"></a>(get-encoder)</span></code></pre></div>
<p>Get angle from selected encoder in degrees.</p>
<hr />
<h4 id="set-encoder">set-encoder</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb119"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true"></a>(set-encoder degrees)</span></code></pre></div>
<p>Set the encoder position in degrees. This command only has an effect in the ABI and custom encoder modes. In ABI mode the encoder position is updated and the index is set to found. In custom encoder mode the encoder position is updated (unless a native library provides custom encoder support).</p>
<p>When using an ABI-encoder this is useful if a position can be derived before the index pulse is found.</p>
<hr />
<h4 id="get-encoder-error-rate">get-encoder-error-rate</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb120"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true"></a>(get-encoder-error-rate)</span></code></pre></div>
<p>Returns the error rate for the selected encoder, range 0.0 to 1.0. If the selected encoder does not provide any error rate -1.0 is returned. If the selected encoder has multiple error rates the highest one is returned.</p>
<hr />
<h4 id="encoder-index-found">encoder-index-found</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>7.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb121"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true"></a>(encoder-index-found)</span></code></pre></div>
<p>Returns 1 if the encoder index is found, 0 otherwise. For encoders without an index pulse or for PWM+ABI 1 is always returned.</p>
<hr />
<h4 id="pos-pid-now">pos-pid-now</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb122"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true"></a>(pos-pid-now)</span></code></pre></div>
<p>Returns the current position of the PID-controller, including compensation for the angle division and offset. Unit: Degrees.</p>
<hr />
<h4 id="pos-pid-set">pos-pid-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb123"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true"></a>(pos-pid-set)</span></code></pre></div>
<p>Returns the set position of the PID-controller, including compensation for the angle division and offset. Unit: Degrees.</p>
<hr />
<h4 id="pos-pid-error">pos-pid-error</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb124"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true"></a>(pos-pid-error)</span></code></pre></div>
<p>Returns the difference between the current and the set PID position. Unit: Degrees.</p>
<hr />
<h4 id="phase-motor">phase-motor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb125"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true"></a>(phase-motor)</span></code></pre></div>
<p>Returns the electrical position of the motor that is used for FOC now. Unit: Degrees.</p>
<hr />
<h4 id="phase-encoder">phase-encoder</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb126"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true"></a>(phase-encoder)</span></code></pre></div>
<p>Returns the encoder position mapped to the electrical position of the motor. Unit: Degrees.</p>
<hr />
<h4 id="phase-hall">phase-hall</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb127"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true"></a>(phase-hall)</span></code></pre></div>
<p>Returns the hall sensor position of the motor. Unit: Degrees.</p>
<hr />
<h4 id="phase-observer">phase-observer</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb128"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true"></a>(phase-observer)</span></code></pre></div>
<p>Returns the FOC observer position. Unit: Degrees.</p>
<hr />
<h4 id="observer-error">observer-error</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb129"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true"></a>(observer-error)</span></code></pre></div>
<p>Returns the difference between the observer position and the encoder position mapped to the electrical position of the motor. Unit: Degrees.</p>
<hr />
<h4 id="phase-all">phase-all</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06.1+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb130"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true"></a>(phase-all)</span></code></pre></div>
<p>Returns a list of phases and various phase errors, all sampled at the same time. This can be used for doing encoder error mapping and creating encoder error correction tables. Returns the folliwing list of values, all in degrees:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true"></a>(</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true"></a>    phase_observer        <span class="co">; Observer phase</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true"></a>    phase_encoder         <span class="co">; Encoder phase, derived from current encoder settings</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true"></a>    phase_bemf            <span class="co">; Phase derived from the back-emf (only valid when undriven)</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true"></a>    pos_encoder           <span class="co">; Encoder angle reading in encoder reference frame</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true"></a>    err_observer_encoder  <span class="co">; Phase error between observer and encoder</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true"></a>    err_bemf_encoder      <span class="co">; Phase error between back-emf and encoder</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true"></a>    err_observer_bemf     <span class="co">; Phase error between observer and back-emf</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true"></a>    phase_hall            <span class="co">; Phase derived from the hall sensors (FW 7.00+)</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true"></a>    err_bemf_hall         <span class="co">; Phase error between back-emf and hall sensors (FW 7.00+)</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true"></a>)</span></code></pre></div>
<hr />
<h4 id="enc-corr">enc-corr</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06.1+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb132"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true"></a>(enc-corr angle optCorr)</span></code></pre></div>
<p>Get (or set) encoder correction for angle. The angle is in the encoder reference frame and the correction is in the FOC reference frame. Returns the correction value for angle. The optional value optCorr can be used to update the correction value at angle, if it is left out only the old value will be returned. The correction is applied in the FOC reference frame, so it should be the error on the FOC motor phase that the encoder causes.</p>
<p>Example:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true"></a><span class="co">; Prints encoder correction value for 10 degrees. Read only, nothing is chaged.</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true"></a>(<span class="kw">print</span> (enc-corr <span class="dv">10</span>))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true"></a><span class="co">; Set encoder correction value for 10 degrees to -5 degrees.</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true"></a>(enc-corr <span class="dv">10</span> <span class="dv">-5</span>)</span></code></pre></div>
<hr />
<hr />
<h4 id="enc-corr-en">enc-corr-en</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06.1+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb134"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true"></a>(enc-corr-en optEn)</span></code></pre></div>
<p>Returns 1 if encoder correction is enabled and 0 if it is disabled. The optional argument optEn can be used to enable or disable encoder correction.</p>
<p>Example:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true"></a><span class="co">; Prints 1 if correction is enabled, 0 otherwise. Read only, nothing is chaged.</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true"></a>(<span class="kw">print</span> (enc-corr-en))</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true"></a><span class="co">; Enable correction</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true"></a>(enc-corr-en <span class="dv">1</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true"></a><span class="co">; Disable correction</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true"></a>(enc-corr-en <span class="dv">0</span>)</span></code></pre></div>
<hr />
<h4 id="enc-sample">enc-sample</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>7.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb136"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true"></a>(enc-sample buffer samples)</span></code></pre></div>
<p>This function is used for building correction tables for encoders. It will take about 10k samples per seconds if the difference between the motor position derived from the back-emf as well as the motor position derived from the encoder and store those samples in the argument buffer, which is a byte array. The argument samples sets how many samples to take - given that the rate is around 10k passing the argument 1000 will run this function for 0.1 seconds.</p>
<p>The format of buffer is a byte array with 720 floats, meaning that its size has to be 720x4 = 2880 bytes. There is one float for the accumulater error on every encoder postion in whole degrees as well as one float for the number of samples taken at that postion.</p>
<p>Note: This function only works when the motor is spinning but undriven, so either it has to be used by externally driving the motor or by spinning it up first, releasing it and then running this function while it is spinning down.</p>
<p>Example:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true"></a><span class="co">; Create buffer for samples</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> samples </span>(bufcreate (<span class="kw">*</span> <span class="dv">360</span> <span class="dv">8</span>)))</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true"></a>(bufclear samples)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true"></a><span class="co">; Spin up motor for 3 seconds</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true"></a>(looprange i <span class="dv">0</span> <span class="dv">30</span> {</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true"></a>        (set-rpm <span class="dv">6000</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true"></a>        (sleep <span class="fl">0.1</span>)</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true"></a>})</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true"></a></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true"></a><span class="co">; Stop driving motors so that it is coasting</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true"></a>(set-current <span class="fl">0.0</span>)</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true"></a></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true"></a><span class="co">; Collect 800 samples</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true"></a>(enc-sample samples <span class="dv">800</span>)</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true"></a></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true"></a><span class="co">; This function can be used to get the accumulated value for</span></span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true"></a><span class="co">; a given encoder position</span></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true"></a>(defun get-val (pos) (bufget-f32 samples (<span class="kw">*</span> pos <span class="dv">8</span>)))</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true"></a></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true"></a><span class="co">; This function can be used to get the number of samples for</span></span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true"></a><span class="co">; a given encoder position</span></span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true"></a>(defun get-samp (pos) (bufget-f32 samples (<span class="kw">+</span> (<span class="kw">*</span> pos <span class="dv">8</span>) <span class="dv">4</span>)))</span></code></pre></div>
<p>Note that the example above is not complete and many more than 800 samples are required for generating a complete encoder correction table. VESC Tool includes an example file named test_encoder.lbm with a complete implementation that works by spinning up the motor multiple times and collecting samples.</p>
<hr />
<h3 id="setup-values">Setup Values</h3>
<p>These commands return the accumulated values from all VESC-based motor controllers on the CAN-bus. Note that the corresponding CAN status messages must be activated for these commands to work.</p>
<hr />
<h4 id="setup-ah">setup-ah</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb138"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true"></a>(setup-ah)</span></code></pre></div>
<p>Get the number of amp hours consumed since start.</p>
<hr />
<h4 id="setup-ah-chg">setup-ah-chg</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb139"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true"></a>(setup-ah-chg)</span></code></pre></div>
<p>Get the number of amp hours charged since start.</p>
<hr />
<h4 id="setup-wh">setup-wh</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb140"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true"></a>(setup-wh)</span></code></pre></div>
<p>Get the number of watt hours consumed since start.</p>
<hr />
<h4 id="setup-wh-chg">setup-wh-chg</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb141"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true"></a>(setup-wh-chg)</span></code></pre></div>
<p>Get the number of watt hours charged since start.</p>
<hr />
<h4 id="setup-current">setup-current</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb142"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true"></a>(setup-current)</span></code></pre></div>
<p>Get total motor current. Positive means that current is flowing into the motor and negative means that current is flowing out of the motor (regenerative braking).</p>
<hr />
<h4 id="setup-current-in">setup-current-in</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb143"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true"></a>(setup-current-in)</span></code></pre></div>
<hr />
<h4 id="setup-num-vescs">setup-num-vescs</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb144"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true"></a>(setup-num-vescs)</span></code></pre></div>
<p>Get the number of VESC-based motor controllers the setup values are accumulated from.</p>
<hr />
<h3 id="can-commands">CAN-Commands</h3>
<p>Notice that all canget-commands rely on the status messages being active on the VESCs on the CAN-bus. That can be done from App Settings-&gt;General-&gt;Can status message mode.</p>
<hr />
<h4 id="can-msg-age">can-msg-age</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb145"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true"></a>(can-msg-age id msg)</span></code></pre></div>
<p>Get age of can-message msg from device with can-id id. Can be used to determine how up-to-date the values are from the different messages. nil is returned if the given message has never been received from the given id.</p>
<hr />
<h4 id="canset-current">canset-current</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb146"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true"></a>(canset-current id current optOffDelay)</span></code></pre></div>
<p>Set current over CAN-bus on VESC with id. Example for setting 25A on VESC with id 115:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true"></a>(canset-current <span class="dv">115</span> <span class="dv">25</span>)</span></code></pre></div>
<p>See <a href="#set-current">set-current</a> for details on what the optional argument optOffDelay does.</p>
<hr />
<h4 id="canset-current-rel">canset-current-rel</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb148"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true"></a>(canset-current-rel id current optOffDelay)</span></code></pre></div>
<p>Same as above, but relative current in the range -1.0 to 1.0. See (set-current) for details on what relative current means.</p>
<p>See <a href="#set-current">set-current</a> for details on what the optional argument optOffDelay does.</p>
<hr />
<h4 id="canset-duty">canset-duty</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb149"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true"></a>(canset-duty id duty)</span></code></pre></div>
<p>Set duty cycle over CAN-bus on VESC with id. Range -1.0 to 1.0.</p>
<hr />
<h4 id="canset-brake">canset-brake</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb150"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true"></a>(canset-brake id current)</span></code></pre></div>
<p>Set braking current over CAN-bus.</p>
<hr />
<h4 id="canset-brake-rel">canset-brake-rel</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb151"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true"></a>(canset-brake-rel id current)</span></code></pre></div>
<p>Set relative braking current over CAN-bus. Range 0.0 to 1.0.</p>
<hr />
<h4 id="canset-rpm">canset-rpm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb152"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true"></a>(canset-rpm id rpm)</span></code></pre></div>
<p>Set rpm over CAN-bus.</p>
<hr />
<h4 id="canset-pos">canset-pos</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb153"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true"></a>(canset-pos id pos)</span></code></pre></div>
<p>Set position control in degrees over CAN-bus. Range 0.0 to 1.0.</p>
<hr />
<h4 id="canget-current">canget-current</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb154"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true"></a>(canget-current id)</span></code></pre></div>
<p>Get current over CAN-bus on VESC with id.</p>
<hr />
<h4 id="canget-current-dir">canget-current-dir</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb155"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true"></a>(canget-current-dir id)</span></code></pre></div>
<p>Get directional current over CAN-bus on VESC with id. See (get-current-dir) for what directional means.</p>
<hr />
<h4 id="canget-current-in">canget-current-in</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb156"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true"></a>(canget-current-in id)</span></code></pre></div>
<p>Get input current over CAN-bus on VESC with id.</p>
<hr />
<h4 id="canget-duty">canget-duty</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb157"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true"></a>(canget-duty id)</span></code></pre></div>
<p>Get duty cycle over CAN-bus on VESC with id.</p>
<hr />
<h4 id="canget-rpm">canget-rpm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb158"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true"></a>(canget-rpm id)</span></code></pre></div>
<p>Get RPM over CAN-bus on VESC with id.</p>
<hr />
<h4 id="canget-temp-fet">canget-temp-fet</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb159"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true"></a>(canget-temp-fet id)</span></code></pre></div>
<p>Get MOSFET temperature over CAN-bus on VESC with id.</p>
<hr />
<h4 id="canget-temp-motor">canget-temp-motor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb160"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true"></a>(canget-temp-motor id)</span></code></pre></div>
<p>Get motor temperature over CAN-bus on VESC with id.</p>
<hr />
<h4 id="canget-speed">canget-speed</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb161"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true"></a>(canget-speed id)</span></code></pre></div>
<p>Get speed in meters per second over CAN-bus on VESC with id. The gearing, wheel diameter and number of motor poles from the local configuration will be used for converting the RPM to meters per second.</p>
<hr />
<h4 id="canget-dist">canget-dist</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb162"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true"></a>(canget-dist id)</span></code></pre></div>
<p>Get distance traveled in meters over CAN-bus on VESC with id. As with (canget-speed id), the local configuration will be used to convert the tachometer value to meters.</p>
<hr />
<h4 id="canget-ppm">canget-ppm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb163"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true"></a>(canget-ppm id)</span></code></pre></div>
<p>Get PPM-input from the VESC with id on the CAN-bus. Note that CAN status message 6 as well as the PPM-app must be active on that VESC for this function to work.</p>
<hr />
<h4 id="canget-adc">canget-adc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb164"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true"></a>(canget-adc id ch)</span></code></pre></div>
<p>Get ADC channel ch from the VESC with id on the CAN-bus. Note that CAN status message 6 must be active on that VESC for this function to work.</p>
<hr />
<h4 id="canget-vin">canget-vin</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb165"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true"></a>(canget-vin id)</span></code></pre></div>
<p>Get input voltage on ESC with id on the CAN-bus. Note that CAN status message 5 must be active on that ESC for this function to work.</p>
<hr />
<h4 id="can-list-devs">can-list-devs</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb166"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true"></a>(can-list-devs)</span></code></pre></div>
<p>List CAN-devices that have been heard on the CAN-bus since boot. This function is fast as it does not actively scan the CAN-bus, but it relies on the devices sending status message 1.</p>
<hr />
<h4 id="can-scan">can-scan</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb167"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true"></a>(can-scan)</span></code></pre></div>
<p>Actively scan the CAN-bus and return a list with devices that responded. This function takes several seconds to run, but also finds devices that do not actively send messages and only respond to a ping message.</p>
<hr />
<h4 id="can-ping">can-ping</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb168"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true"></a>(can-ping id)</span></code></pre></div>
<p>Ping can-device with id. Valid IDs are 0 to 253. If the device responds 0, 1 or 2 is returned, meaning</p>
<table>
<thead>
<tr class="header">
<th>Response</th>
<th>HW Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>ESC</td>
</tr>
<tr class="even">
<td>1</td>
<td>Old BMS</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Custom (e.g. Express or new BMS)</td>
</tr>
</tbody>
</table>
<p>If the device does not respond nil is returned.</p>
<hr />
<h4 id="can-local-id">can-local-id</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb169"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true"></a>(can-local-id)</span></code></pre></div>
<p>Get local CAN ID.</p>
<hr />
<h4 id="can-update-baud">can-update-baud</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb170"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true"></a>(can-update-baud kbits)</span></code></pre></div>
<p>Update CAN baudrate locally and on connected CAN-devices. kbits is the new baudrate. Note that this is only supported when all CAN-devices have firmware 6.06 or later. If the update fails the CAN-bus can become unusable until the settings are restored manually on each device. Valid baudrates in kbits are 125, 250, 500, 1000, 10, 20, 50, 75 and 100. Example:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true"></a>(can-update-baud <span class="dv">1000</span>) <span class="co">; Update baudrate to 1 MBit/s</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true"></a>(can-update-baud <span class="dv">250</span>) <span class="co">; Update baudrate to 250 KBit/s</span></span></code></pre></div>
<hr />
<h4 id="can-send-sid">can-send-sid</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb172"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true"></a>(can-send-sid id data)</span></code></pre></div>
<p>Send standard ID CAN-frame with id and data. Data is a list with bytes, and the length of the list (max 8) decides how many data bytes are sent. Example:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true"></a>(can-send-sid <span class="bn">0x11FF11</span> (<span class="kw">list</span> <span class="bn">0xAA</span> <span class="bn">0x11</span> <span class="bn">0x15</span>))</span></code></pre></div>
<p><em>data</em> can be a list or a <a href="#byte-arrays">byte array</a>.</p>
<hr />
<h4 id="can-send-eid">can-send-eid</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb174"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true"></a>(can-send-eid id data)</span></code></pre></div>
<p>Same as (can-send-sid), but sends extended ID frame.</p>
<hr />
<h4 id="can-recv-sid">can-recv-sid</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb175"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true"></a>(can-recv-sid optTimeout)</span></code></pre></div>
<p>Block current thread until a standard-id can-frame arrives. The optional argument optTimeout can be used to specify a timeout in seconds.</p>
<p>If a timeout occurs the symbol timeout will be returned, otherwise a list with the following format will be returned:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true"></a>(id data)</span></code></pre></div>
<p>Usage example:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true"></a>(<span class="kw">print</span> (can-recv-sid))</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true"></a><span class="kw">&gt;</span> (2i32 [<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>])</span></code></pre></div>
<hr />
<h4 id="can-recv-eid">can-recv-eid</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb178"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true"></a>(can-recv-eid optTimeout)</span></code></pre></div>
<p>Same as (can-recv-sid), but waits for extended ID frame.</p>
<hr />
<h4 id="can-cmd">can-cmd</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb179"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true"></a>(can-cmd id cmd)</span></code></pre></div>
<p>Execute command cmd on CAN-device with ID id. The command cmd is sent as a string and will be parsed and evaluated by the receiver.</p>
<p>This is useful to execute arbitrary code on a CAN-device that is not covered by the other <a href="#can-commands">CAN-Commands</a>. This function has more overhead than other CAN-Commands, so if possible they should be used instead.</p>
<p>Example:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true"></a><span class="co">; Configuration update on ID54:</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true"></a>(can-cmd <span class="dv">54</span> <span class="st">&quot;(conf-set &#39;max-speed 10.0)&quot;</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true"></a><span class="co">; The string-functions can be used for setting something from a variable</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> max-speed-kmh </span><span class="fl">25.0</span>)</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true"></a>(can-cmd <span class="dv">54</span> (str-from-n (<span class="kw">/</span> max-speed-kmh <span class="fl">3.6</span>) <span class="st">&quot;(conf-set &#39;max-speed %.3f)&quot;</span>))</span></code></pre></div>
<p><strong>Note</strong><br />
can-cmd is limited to two commands per second per device. If commands are sent more often that that they are ignored.</p>
<p><strong>Note2</strong><br />
A better way to achieve something similar to can-cmd but with much less overhead and unlimited rate is using the <a href="https://github.com/vedderb/vesc_pkg/tree/main/lib_code_server">Code Server</a> library.</p>
<hr />
<h4 id="can-start">can-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb181"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true"></a>(can-start optPinTx optPinRx)</span></code></pre></div>
<p>Start or restart CAN-driver. The optional arguments optPinTx and optPinRx can be used to specify which pins to use as CAN TX and CAN RX. If they are omitted the default pins will be used. If the hardware does not have default CAN pins and no pins are specified an error is returned. This function can also be used while the CAN-driver is running for changing CAN-pins.</p>
<hr />
<h4 id="can-stop">can-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb182"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true"></a>(can-stop)</span></code></pre></div>
<p>Stop CAN-bus driver.</p>
<hr />
<h4 id="can-use-vesc">can-use-vesc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb183"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true"></a>(can-use-vesc use-vesc)</span></code></pre></div>
<p>Enable or disable decoding of the VESC Protocol on the CAN-bus. By default it is enabled. The VESC Protocol is used for communication with VESC Tool, the VESC BMS and VESC motor controllers on the CAN-bus. Disabling the VESC Protocol is useful for using the express as a generic CAN sniffer and debugger.</p>
<hr />
<h2 id="can-messages">CAN Messages</h2>
<hr />
<p>CAN messages are byte arrays of up to 500 bytes that can be sent between devices over CAN-bus. Together with flat values they are useful for e.g. remote code execution. Each CAN-device has 8 different slots to send messages to.</p>
<hr />
<h4 id="canmsg-recv">canmsg-recv</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb184"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true"></a>(canmsg-recv slot timeout)</span></code></pre></div>
<p>Wait for message on slot with timeout seconds. Returns a byte array with the received message on success or timeout if nothing is received before the timeout has passed. A negative timeout means wait forever.</p>
<hr />
<h4 id="canmsg-send">canmsg-send</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb185"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true"></a>(canmsg-send can-id slot msg)</span></code></pre></div>
<p>Send msg over CAN-bus to slot on can-id. msg is a byte array.</p>
<hr />
<h3 id="math-functions">Math Functions</h3>
<hr />
<h4 id="sin">sin</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb186"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true"></a>(sin angle)</span></code></pre></div>
<p>Get the sine of angle. Unit: Radians.</p>
<hr />
<h4 id="cos">cos</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb187"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true"></a>(cos angle)</span></code></pre></div>
<p>Get the cosine of angle. Unit: Radians.</p>
<hr />
<h4 id="tan">tan</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb188"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true"></a>(tan angle)</span></code></pre></div>
<p>Get the tangent of angle. Unit: Radians.</p>
<hr />
<h4 id="asin">asin</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb189"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true"></a>(asin x)</span></code></pre></div>
<p>Get the arc sine of x. Unit: Radians.</p>
<hr />
<h4 id="acos">acos</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb190"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true"></a>(acos x)</span></code></pre></div>
<p>Get the arc cosine of x. Unit: Radians.</p>
<hr />
<h4 id="atan">atan</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb191"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true"></a>(atan x)</span></code></pre></div>
<p>Get the arc tangent of x. Unit: Radians.</p>
<hr />
<h4 id="atan2">atan2</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb192"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true"></a>(atan2 y x)</span></code></pre></div>
<p>Get the arc tangent of y / x. Unit: Radians. This version uses the signs of y and x to determine the quadrant.</p>
<hr />
<h4 id="pow">pow</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb193"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true"></a>(pow base power)</span></code></pre></div>
<p>Get base raised to power.</p>
<hr />
<h4 id="sqrt">sqrt</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb194"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true"></a>(sqrt x)</span></code></pre></div>
<p>Get the square root of x.</p>
<hr />
<h4 id="log">log</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb195"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true"></a>(log x)</span></code></pre></div>
<p>Get the base-e logarithm of x.</p>
<hr />
<h4 id="log10">log10</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb196"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true"></a>(log10 x)</span></code></pre></div>
<p>Get the base-10 logarithm of x.</p>
<hr />
<h4 id="floor">floor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb197"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true"></a>(floor x)</span></code></pre></div>
<p>Round x down to the closest integer. Added in FW 6.02.</p>
<hr />
<h4 id="ceil">ceil</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb198"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true"></a>(ceil x)</span></code></pre></div>
<p>Round x up to the closest integer. Added in FW 6.02.</p>
<hr />
<h4 id="round">round</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb199"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true"></a>(round x)</span></code></pre></div>
<p>Round x to the closest integer. Added in FW 6.02.</p>
<hr />
<h4 id="deg2rad">deg2rad</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb200"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true"></a>(deg2rad x)</span></code></pre></div>
<p>Converts x from degrees to radians.</p>
<hr />
<h4 id="rad2deg">rad2deg</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb201"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true"></a>(rad2deg x)</span></code></pre></div>
<p>Converts x from radians to degrees.</p>
<hr />
<h4 id="abs">abs</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb202"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true"></a>(abs x)</span></code></pre></div>
<p>Get the absolute value of x.</p>
<hr />
<h4 id="throttle-curve">throttle-curve</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb203"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true"></a>(throttle-curve value accel brake mode)</span></code></pre></div>
<p>Apply throttle curve on value. accel (range -1 to 1) is the curve constant for acceleration (when value is greater than 0) and brake (range -1 to 1) is the curve constant for braking (when value is less than 0). mode (0, 1 or 2) is the throttle curve mode. Negative curve constants mean that the throttle will be gentler in the beginning and more aggressive with towards the end and positive curve constants mean the opposite. The modes are 0: Exponential, 1: Natural and 2: Polynomial. You can have a look at the throttle curves in VESC Tool for the PPM, ADC or VESC Remote app and experiment with the mode and curve constants to see a plot of the response.</p>
<hr />
<h4 id="rand">rand</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb204"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true"></a>(<span class="kw">rand</span> optSeed)</span></code></pre></div>
<p>Generate random number in the range 0 to (rand-max). Example:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true"></a><span class="co">; Generate integer in the range 0 to 99</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true"></a>(<span class="kw">mod</span> (<span class="kw">rand</span>) <span class="dv">100</span>)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true"></a><span class="co">; Generate number in the range 0.0 to 1.0</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true"></a>(<span class="kw">/</span> (to-float (<span class="kw">rand</span>)) (rand-max))</span></code></pre></div>
<hr />
<h4 id="rand-max">rand-max</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb206"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true"></a>(rand-max)</span></code></pre></div>
<p>Returns the maximum number that rand can return.</p>
<hr />
<h3 id="bit-operations">Bit Operations</h3>
<hr />
<h4 id="bits-enc-int">bits-enc-int</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb207"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true"></a>(bits-enc-int initial offset number bits)</span></code></pre></div>
<p>Put bits of number in initial at offset and return the result. For example, if the bits initial are aaaaaaaa, number is bbb, offset is 2 and bits is 3 the result is aaabbbaa. For reference, the corresponding operation in C is:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true"></a>initial &amp;= ~((<span class="bn">0xFFFFFFFF</span> &gt;&gt; (<span class="dv">32</span> - bits)) &lt;&lt; offset);</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true"></a>initial |= (number &lt;&lt; (<span class="dv">32</span> - bits)) &gt;&gt; (<span class="dv">32</span> - bits - offset);</span></code></pre></div>
<hr />
<h4 id="bits-dec-int">bits-dec-int</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb209"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true"></a>(bits-dec-int value offset size)</span></code></pre></div>
<p>Return size bits of value at offset. For example if the bits of value are abcdefgh, offset is 3 and size it 3 a number with the bits cde is returned. The corresponding operation in C is:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true"></a>val &gt;&gt;= offset;</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true"></a>val &amp;= <span class="bn">0xFFFFFFFF</span> &gt;&gt; (<span class="dv">32</span> - bits);</span></code></pre></div>
<hr />
<h3 id="raw-commands">Raw Commands</h3>
<p>Raw data commands useful for debugging hardware issues.</p>
<hr />
<h4 id="raw-adc-current">raw-adc-current</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb211"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true"></a>(raw-adc-current motor phase useRaw)</span></code></pre></div>
<p>Get raw current measurements. Motor is the motor index (1 or 2), phase is the phase (1, 2 or 3) and useRaw is whether to convert the measurements to currents or to use raw ADC values.</p>
<p><strong>Note:</strong><br />
These samples can come from either V0 or V7 depending on when the function is called (although most likely V7 as less other computations happen then), so when the motor is running this is most likely not going to look good, especially if the hardware does not have phase shunts. This function is intended for debugging hardware and returns just was goes into the ADC without any processing.</p>
<p>Example for reading phase B on motor 1 as raw ADC values:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true"></a>(raw-adc-current <span class="dv">1</span> <span class="dv">2</span> <span class="dv">1</span>)</span></code></pre></div>
<hr />
<h4 id="raw-adc-voltage">raw-adc-voltage</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb213"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true"></a>(raw-adc-voltage motor phase useRaw)</span></code></pre></div>
<p>Same as (raw-adc-current), but measures phase voltages instead.</p>
<hr />
<h4 id="raw-mod-alpha">raw-mod-alpha</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb214"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true"></a>(raw-mod-alpha)</span></code></pre></div>
<p>Get alpha modulation. Range -1.0 to 1.0 (almost).</p>
<hr />
<h4 id="raw-mod-beta">raw-mod-beta</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb215"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true"></a>(raw-mod-beta)</span></code></pre></div>
<p>Get beta modulation. Range -1.0 to 1.0 (almost).</p>
<hr />
<h4 id="raw-mod-alpha-measured">raw-mod-alpha-measured</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb216"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true"></a>(raw-mod-alpha-measured)</span></code></pre></div>
<p>Same as (raw-mod-alpha), but derives the modulation from the phase voltage reading and/or dead-time compensation.</p>
<hr />
<h4 id="raw-mod-beta-measured">raw-mod-beta-measured</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb217"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true"></a>(raw-mod-beta-measured)</span></code></pre></div>
<p>Same as (raw-mod-beta), but derives the modulation from the phase voltage reading and/or dead-time compensation.</p>
<hr />
<h4 id="raw-hall">raw-hall</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb218"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true"></a>(raw-hall motor optSamples)</span></code></pre></div>
<p>Read hall sensors for motor (1 or 2) and return their states in a list. The optional argument optSamples (max 20) can be used to set how many times the hall sensors are sampled; if it is not supplied the number of samples from the motor configuration will be used.</p>
<p>The function (ix list ind) can be used to get an element from the list. Example:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true"></a>(ix (raw-hall <span class="dv">1</span>) <span class="dv">0</span>) <span class="co">; Get hall sensor 1 state (index 0)</span></span></code></pre></div>
<hr />
<h3 id="uart">UART</h3>
<hr />
<h4 id="uart-start">uart-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb220"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true"></a>(uart-start baudrate optHd)</span></code></pre></div>
<p>Start the UART driver at baudrate on the COMM-port. optHd is an optional argument that can be set to 'half-duplex to use half-duplex mode. In half-duplex mode only the tx-pin is used. If any app is using the UART pins it will be stopped first. Example:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true"></a>(uart-start <span class="dv">115200</span>) <span class="co">; Start UART at 115200 baud in full duplex mode</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true"></a>(uart-start <span class="dv">115200</span> <span class="at">&#39;half-duplex</span>) <span class="co">; Start UART at 115200 baud in half duplex mode</span></span></code></pre></div>
<hr />
<h4 id="uart-start-1">uart-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb222"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true"></a>(uart-start uart-num rx-pin tx-pin baudrate)</span></code></pre></div>
<p>This version of uart-start is for the Express-platform. Start the UART uart-num on the pins rx-pin and tx-pin with baudrate. Uart-num can be 0 or 1 and any pin can be used. Note that GNSS uses uart 0, so when a gnss-receiver is connected uart 1 must be used. Example:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true"></a><span class="co">; Start UART 1 with pin 20 for RX, pin 21 for TX and 115200 baudrate.</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true"></a>(uart-start <span class="dv">1</span> <span class="dv">20</span> <span class="dv">21</span> <span class="dv">115200</span>)</span></code></pre></div>
<hr />
<h4 id="uart-stop">uart-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb224"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true"></a>(uart-stop)</span></code></pre></div>
<p>Stop the UART-driver and free the resources it uses.</p>
<hr />
<h4 id="uart-write">uart-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb225"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true"></a>(uart-write array)</span></code></pre></div>
<p>Write array (see <a href="#byte-arrays">byte array</a> for details) to the UART. The array-argument can also be a list. Examples:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true"></a>(uart-write <span class="st">&quot;Hello World!&quot;</span>) <span class="co">; Write the string hello world!</span></span></code></pre></div>
<div class="sourceCode" id="cb227"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true"></a>(define arr (array-create <span class="dv">6</span>)) <span class="co">; Create a 6 byte long array</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true"></a>(bufset-i16 arr <span class="dv">0</span> <span class="dv">1123</span>) <span class="co">; Set byte 0 and 1 to 1123</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true"></a>(bufset-i32 arr <span class="dv">2</span> <span class="dv">424242</span>) <span class="co">; Set byte 2 to 5 to 424242 </span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true"></a>(uart-write arr) <span class="co">; Write arr to the uart</span></span></code></pre></div>
<hr />
<h4 id="uart-read">uart-read</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb228"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true"></a>(uart-read array <span class="kw">num</span> optOffset optStopAt optTimeout)</span></code></pre></div>
<p>Read num bytes into array at offset optOffset. Stop reading if the character optStopAt is received or optTimeout time has passed. The last three arguments are optional. Setting optTimeout to 0 (or omitting the argument) makes this function return immediately, even when there is nothing to read. The return value is the number of bytes read. The optional arguments can also be set to nil in case not all of them are used. Example:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true"></a><span class="co">; Read at most 10 characters into arr and return if it takes more than</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true"></a><span class="co">; 0.5 seconds to receive anything.</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> arr </span>(bufcreate <span class="dv">10</span>))</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true"></a>(var res (uart-read arr <span class="dv">10</span> <span class="va">nil</span> <span class="va">nil</span> <span class="fl">0.5</span>))</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true"></a>(<span class="kw">print</span> (<span class="kw">list</span> res arr))</span></code></pre></div>
<hr />
<h4 id="uart-read-bytes">uart-read-bytes</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb230"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true"></a>(uart-read-bytes array <span class="kw">num</span> offset)</span></code></pre></div>
<p>Read num bytes into buffer at offset. This function is blocking, so it will not return until the specified amount of bytes is read.</p>
<hr />
<h4 id="uart-read-until">uart-read-until</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb231"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true"></a>(uart-read-until array <span class="kw">num</span> offset end)</span></code></pre></div>
<p>Same as uart-read-bytes, but will return when the byte end is read.</p>
<hr />
<h4 id="uartcomm-start">uartcomm-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb232"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true"></a>(uartcomm-start uart-num rx-pin tx-pin baudrate)</span></code></pre></div>
<p>Start VESC Tool-compatible packet handler over UART. That allows VESC Tool to connect to those pins using an USB-SERIAL adapter. Uart-num can be 0 or 1 and any pins can be used. Multiple UARTs can be used simultaneously.</p>
<hr />
<h4 id="uartcomm-stop">uartcomm-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb233"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true"></a>(uartcomm-stop uart-num)</span></code></pre></div>
<p>Stop UARTCOMM on uart-num.</p>
<hr />
<h3 id="i2c">I2C</h3>
<hr />
<h4 id="i2c-start">i2c-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb234"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true"></a>(i2c-start optRate optPinSda optPinScl)</span></code></pre></div>
<p>Start the I2C driver on the COMM-port on the VESC. If any app is using the I2C pins it will be stopped first. optRate is an optional argument for the I2C bitrate. optPinSda and optPinScl are optional arguments for using different SDA and SCL pins. Example:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true"></a>(i2c-start <span class="at">&#39;rate-400k</span>) <span class="co">; 400 kbps and the default SDA and SDC pins</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true"></a>(i2c-start <span class="at">&#39;rate-100k</span> <span class="at">&#39;pin-swdio</span> <span class="at">&#39;pin-swclk</span>) <span class="co">; 100 kbps and SWDIO and SWCLK as SDA and SCL</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true"></a></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true"></a><span class="co">; Available bitrates</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true"></a><span class="at">&#39;rate-100k</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true"></a><span class="at">&#39;rate-200k</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true"></a><span class="at">&#39;rate-400k</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true"></a><span class="at">&#39;rate-700k</span></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true"></a></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true"></a><span class="co">; Available pins</span></span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true"></a><span class="at">&#39;pin-rx</span></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true"></a><span class="at">&#39;pin-tx</span></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true"></a><span class="at">&#39;pin-swdio</span></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true"></a><span class="at">&#39;pin-swclk</span></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true"></a><span class="at">&#39;pin-hall1</span></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true"></a><span class="at">&#39;pin-hall2</span></span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true"></a><span class="at">&#39;pin-hall3</span></span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true"></a></span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true"></a><span class="co">; Note: On express the pins are a number</span></span></code></pre></div>
<hr />
<h4 id="i2c-tx-rx">i2c-tx-rx</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb236"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true"></a>(i2c-tx-rx addr arrTx optArrRx)</span></code></pre></div>
<p>Send array (or list) arrTx to the I2C-device with address addr. Optionally receive a response to opArrRx. Example:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true"></a><span class="co">; Create 14 byte long array</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true"></a>(define arr (array-create <span class="dv">14</span>))</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true"></a><span class="co">; Send 0x3B to device 0x68 and receive 14 bytes into arr</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true"></a>(i2c-tx-rx <span class="bn">0x68</span> (<span class="kw">list</span> <span class="bn">0x3B</span>) arr)</span></code></pre></div>
<hr />
<h4 id="i2c-restore">i2c-restore</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb238"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true"></a>(i2c-restore)</span></code></pre></div>
<p>Sends a sequence of bits in an attempt to restore the i2c-bus. Can be used if an i2c-device hangs and refuses to respond.</p>
<hr />
<h4 id="i2c-detect-addr">i2c-detect-addr</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb239"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true"></a>(i2c-detect-addr address)</span></code></pre></div>
<p>Test if address is present on the bus by writing to it and checking the nack-bit. Returns true if the address is present, nil otherwise. Can be used to detect if I2C-devices are plugged in and powered correctly.</p>
<hr />
<h4 id="imu-start-lsm6">imu-start-lsm6</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb240"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true"></a>(imu-start-lsm6 optRate optPinSda optPinScl)</span></code></pre></div>
<p>Start LSM6DSx IMU driver over i2c. Takes the same arguments as i2c-start and shares the same i2c-pins. Example:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true"></a>(imu-start-lsm6 <span class="at">&#39;rate-400k</span> <span class="dv">21</span> <span class="dv">20</span>)</span></code></pre></div>
<hr />
<h4 id="imu-stop">imu-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb242"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true"></a>(imu-stop)</span></code></pre></div>
<p>Stop IMU-driver and put IMU in sleep mode.</p>
<hr />
<h3 id="gpio">GPIO</h3>
<p>These functions allow using GPIO-pins from lispBM. NOTE: If you are using the SWD-pins a SWD-programmer won't work after that until the next reset. If you are using the hall sensor pins make sure that sensor port mode is not set to anything that will communicate with encoders using those pins. Leaving the sensor port in hall sensor mode should be fine.</p>
<p>The gpio-extension are also available on the express-platform. There the pins are a number (e.g. 1, 2) instead of a symbol.</p>
<hr />
<h4 id="gpio-configure">gpio-configure</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb243"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true"></a>(gpio-configure pin mode)</span></code></pre></div>
<p>Configure GPIO pin to mode. Example:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true"></a>(gpio-configure <span class="at">&#39;pin-rx</span> <span class="at">&#39;pin-mode-out</span>) <span class="co">; Set pin RX to output</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true"></a></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true"></a><span class="co">; Available pins</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true"></a><span class="at">&#39;pin-rx</span>     <span class="co">; RX-pin on the COMM-port</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true"></a><span class="at">&#39;pin-tx</span>     <span class="co">; TX-pin on the COMM-port</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true"></a><span class="at">&#39;pin-swdio</span>  <span class="co">; IO-pin on the SWD-port</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true"></a><span class="at">&#39;pin-swclk</span>  <span class="co">; CLK-pin on the SWD-port</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true"></a><span class="at">&#39;pin-hall1</span>  <span class="co">; Sensor port hall1</span></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true"></a><span class="at">&#39;pin-hall2</span>  <span class="co">; Sensor port hall2</span></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true"></a><span class="at">&#39;pin-hall3</span>  <span class="co">; Sensor port hall3</span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true"></a><span class="at">&#39;pin-adc1</span>   <span class="co">; ADC1-pin on COMM-port</span></span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true"></a><span class="at">&#39;pin-adc2</span>   <span class="co">; ADC2-pin on COMM-port</span></span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true"></a><span class="at">&#39;pin-adc3</span>   <span class="co">; ADC3-pin on COMM-port (if available)</span></span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true"></a><span class="at">&#39;pin-adc4</span>   <span class="co">; ADC4-pin on COMM-port (if available)</span></span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true"></a><span class="at">&#39;pin-ppm</span>    <span class="co">; Signal-pin on PPM-port</span></span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true"></a></span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true"></a><span class="co">; On express the pins are a number and not a symbol.</span></span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true"></a></span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true"></a><span class="co">; Available modes</span></span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true"></a><span class="at">&#39;pin-mode-out</span>    <span class="co">; Output</span></span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true"></a><span class="at">&#39;pin-mode-od</span>     <span class="co">; Open drain output</span></span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true"></a><span class="at">&#39;pin-mode-od-pu</span>  <span class="co">; Open drain output with pull-up</span></span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true"></a><span class="at">&#39;pin-mode-od-pd</span>  <span class="co">; Open drain output with pull-down</span></span>
<span id="cb244-24"><a href="#cb244-24" aria-hidden="true"></a><span class="at">&#39;pin-mode-in</span>     <span class="co">; Input</span></span>
<span id="cb244-25"><a href="#cb244-25" aria-hidden="true"></a><span class="at">&#39;pin-mode-in-pu</span>  <span class="co">; Input with pull-up</span></span>
<span id="cb244-26"><a href="#cb244-26" aria-hidden="true"></a><span class="at">&#39;pin-mode-in-pd</span>  <span class="co">; Input with pull-down</span></span>
<span id="cb244-27"><a href="#cb244-27" aria-hidden="true"></a><span class="at">&#39;pin-mode-analog</span> <span class="co">; Analog (NOTE: only works on the ADC-pins)</span></span></code></pre></div>
<hr />
<h4 id="gpio-write">gpio-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb245"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true"></a>(gpio-write pin state)</span></code></pre></div>
<p>Write state to pin. If the pin is set to an output 1 will set it to VCC and 0 to GND. If the pin is open drain 1 will set it floating and 0 will set it to GND. Example:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true"></a>(gpio-write <span class="at">&#39;pin-rx</span> <span class="dv">1</span>) <span class="co">; Set pin rx to 1</span></span></code></pre></div>
<hr />
<h4 id="gpio-read">gpio-read</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb247"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true"></a>(gpio-read pin)</span></code></pre></div>
<p>Read state of pin. Returns 1 if the pin is high, 0 otherwise.</p>
<hr />
<h4 id="gpio-hold">gpio-hold</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb248"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true"></a>(gpio-hold pin state)</span></code></pre></div>
<p>It state is 1, the state of pin will be locked to its state at the moment of the call. If state is 0 the pin will be unlocked. The state persists through reset, but not through deep sleep.</p>
<hr />
<h4 id="gpio-hold-deepsleep">gpio-hold-deepsleep</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb249"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true"></a>(gpio-hold-deepsleep state)</span></code></pre></div>
<p>It state is 1, all digital pads will hold their state during deep sleep. If it is set to 0 they will reset to their initial state when entering deep sleep.</p>
<hr />
<h3 id="pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</h3>
<p>A logic-level PWM-signal can be created on GPIO-pins for controlling various accessories. The Express-platform supports up to 4 PWM-channels on any pins and the ESC-platform supports only one PWM-channel on the servo-pin. The arguments prefixed with express in the following functions are ignored on the ESC-platform.</p>
<hr />
<h4 id="pwm-start">pwm-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb250"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true"></a>(pwm-start freq duty expressChannel expressPin optExpressBits)</span></code></pre></div>
<p>Start PWM-generation at frequency freq Hz and duty-cycle duty. The arguments expressChannel, expressPin and optExpressBits are only used on the Express-platform and control which channel and pin to use and optionally how many bits of resolution to use (2 - 14 bits, 10 bits default). On the ESC-platform the PPM/Servo-pin is always used. This function returns the actual frequency that will be used as some rounding can be done when setting up the timer. Example:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true"></a><span class="co">; Express: 2 kHz PWM with 20% duty, channel 0 pin 20, 12 bits resolution</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true"></a>(pwm-start <span class="dv">2000</span> <span class="fl">0.2</span> <span class="dv">0</span> <span class="dv">20</span> <span class="dv">12</span>)</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true"></a></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true"></a><span class="co">; ESC: 2 kHz PWM with 20% duty on the Servo/PPM-pin</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true"></a>(pwm-start <span class="dv">2000</span> <span class="fl">0.2</span>)</span></code></pre></div>
<hr />
<h4 id="pwm-stop">pwm-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb252"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true"></a>(pwm-stop expressChannel)</span></code></pre></div>
<p>Stop PWM-output. On the express-platform the channel must be specified.</p>
<hr />
<h4 id="pwm-set-duty">pwm-set-duty</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb253"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true"></a>(pwm-set-duty dutyCycle expressChannel)</span></code></pre></div>
<p>Set PWM duty cycle. Range 0.0 to 1.0. On the express-platform the channel must be specified.</p>
<hr />
<h3 id="input-capture-icu">Input Capture (ICU)</h3>
<p>Input capture can be used to measure pulse lengths and periods on the PPM input pin. This can be used to measure the frequency and duty cycle of PWM-signals. The ICU driver was added in FW 6.02.</p>
<hr />
<h4 id="icu-start">icu-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb254"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true"></a>(icu-start freqHz pol)</span></code></pre></div>
<p>Start input capture on the PPM-pin with timer frequency freqHz hertz and polarity pol. Polarity = 1 means that the high part of the pulse is measured and polarity = 0 means that the low part of the pulse is measured. Every time a pulse is received an <a href="#events">event</a> is generated. Example:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true"></a><span class="co">; Run timer at 1 MHz and capture the positive part of the pulse</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true"></a>(icu-start <span class="dv">1000000</span> <span class="dv">1</span>)</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true"></a></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> cb-cnt </span><span class="dv">0</span>)</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true"></a></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true"></a>(defun proc-icu (width period) {</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true"></a>        (<span class="bu">def</span><span class="fu"> icu-w </span>width)</span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true"></a>        (<span class="bu">def</span><span class="fu"> icu-p </span>period)</span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true"></a>        (<span class="bu">def</span><span class="fu"> cb-cnt </span>(<span class="kw">+</span> cb-cnt <span class="dv">1</span>))</span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true"></a>})</span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true"></a></span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true"></a>(defun event-handler ()</span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true"></a>    (loopwhile t</span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true"></a>        (recv</span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true"></a>            ((event-icu-period . ((? width) . (? period))) (proc-icu width period))</span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true"></a>            (_ <span class="va">nil</span>)</span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true"></a>)))</span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true"></a></span>
<span id="cb255-19"><a href="#cb255-19" aria-hidden="true"></a><span class="co">; Spawn event handler</span></span>
<span id="cb255-20"><a href="#cb255-20" aria-hidden="true"></a>(event-register-handler (spawn event-handler))</span>
<span id="cb255-21"><a href="#cb255-21" aria-hidden="true"></a></span>
<span id="cb255-22"><a href="#cb255-22" aria-hidden="true"></a><span class="co">; Enable the period event, which is generated at the end of the period.</span></span>
<span id="cb255-23"><a href="#cb255-23" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-icu-period</span>)</span></code></pre></div>
<hr />
<h4 id="icu-width">icu-width</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb256"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true"></a>(icu-width)</span></code></pre></div>
<p>Get the width of the last captured pulse. The unit is timer ticks, which depends on the freqHz you pick when running icu-start. E.g. if freqHz is 1000000 (1 MHz) the unit will be one microsecond.</p>
<hr />
<h4 id="icu-period">icu-period</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb257"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true"></a>(icu-period)</span></code></pre></div>
<p>Get the period of the last captured pulse. The unit is timer ticks, which depends on the freqHz you pick when running icu-start. E.g. if freqHz is 1000000 (1 MHz) the unit will be one microsecond.</p>
<hr />
<h3 id="as504x-encoder">AS504x Encoder</h3>
<p>The AS504x (AS5047, AS5048) encoder can be used on any pins using software SPI.</p>
<hr />
<h4 id="as5047x-init">as5047x-init</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb258"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true"></a>(as5047x-init pin-miso pin-sck pin-cs)</span></code></pre></div>
<p>Initialize the AS504x-driver on the specified pins.</p>
<hr />
<h4 id="as5047x-deinit">as5047x-deinit</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb259"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true"></a>(as5047x-deinit)</span></code></pre></div>
<p>De-initialize the AS504x-driver and restore the pins.</p>
<hr />
<h4 id="as5047x-angle">as5047x-angle</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb260"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true"></a>(as5047x-angle)</span></code></pre></div>
<p>Read angle from the AS504x-encoder in degrees.</p>
<hr />
<h3 id="configuration">Configuration</h3>
<p>The following selection of app and motor parameters can be read and set from LispBM:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true"></a><span class="at">&#39;l-current-min</span>          <span class="co">; Minimum current in A (a negative value)</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true"></a><span class="at">&#39;l-current-max</span>          <span class="co">; Maximum current in A</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true"></a><span class="at">&#39;l-current-min-scale</span>    <span class="co">; Scaled minimum current, 0.0 to 1.0</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true"></a><span class="at">&#39;l-current-max-scale</span>    <span class="co">; Scaled maximum current, 0.0 to 1.0</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true"></a><span class="at">&#39;l-in-current-min</span>       <span class="co">; Minimum input current in A (a negative value)</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true"></a><span class="at">&#39;l-in-current-max</span>       <span class="co">; Maximum input current in A</span></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true"></a><span class="at">&#39;l-abs-current-max</span>      <span class="co">; Abs max current in A</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true"></a><span class="at">&#39;l-min-erpm</span>             <span class="co">; Minimum ERPM (a negative value)</span></span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true"></a><span class="at">&#39;l-max-erpm</span>             <span class="co">; Maximum ERPM</span></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true"></a><span class="at">&#39;l-erpm-start</span>           <span class="co">; Start limiting current at this fraction of max ERPM</span></span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true"></a><span class="at">&#39;l-min-vin</span>              <span class="co">; Minimum input voltage</span></span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true"></a><span class="at">&#39;l-max-vin</span>              <span class="co">; Maximum input voltage</span></span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true"></a><span class="at">&#39;l-min-duty</span>             <span class="co">; Minimum duty cycle</span></span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true"></a><span class="at">&#39;l-max-duty</span>             <span class="co">; Maximum duty cycle</span></span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true"></a><span class="at">&#39;l-watt-min</span>             <span class="co">; Minimum power regen in W (a negative value)</span></span>
<span id="cb261-16"><a href="#cb261-16" aria-hidden="true"></a><span class="at">&#39;l-watt-max</span>             <span class="co">; Maximum power in W</span></span>
<span id="cb261-17"><a href="#cb261-17" aria-hidden="true"></a><span class="at">&#39;l-battery-cut-start</span>    <span class="co">; Voltage where current starts to get reduced</span></span>
<span id="cb261-18"><a href="#cb261-18" aria-hidden="true"></a><span class="at">&#39;l-battery-cut-end</span>      <span class="co">; Voltage below which current is not allowed</span></span>
<span id="cb261-19"><a href="#cb261-19" aria-hidden="true"></a><span class="at">&#39;l-temp-motor-start</span>     <span class="co">; Temperature where motor current starts to get reduced</span></span>
<span id="cb261-20"><a href="#cb261-20" aria-hidden="true"></a><span class="at">&#39;l-temp-motor-end</span>       <span class="co">; Temperature above which motor current is not allowed</span></span>
<span id="cb261-21"><a href="#cb261-21" aria-hidden="true"></a><span class="at">&#39;l-temp-accel-dec</span>       <span class="co">; Decrease temp limits this much during acceleration</span></span>
<span id="cb261-22"><a href="#cb261-22" aria-hidden="true"></a></span>
<span id="cb261-23"><a href="#cb261-23" aria-hidden="true"></a><span class="co">; BMS Settings (Added in FW 6.05)</span></span>
<span id="cb261-24"><a href="#cb261-24" aria-hidden="true"></a><span class="at">&#39;bms-limit-mode</span>         <span class="co">; BMS limit mode bitfield</span></span>
<span id="cb261-25"><a href="#cb261-25" aria-hidden="true"></a>                        <span class="co">; Bit 0: Enable temperature limit</span></span>
<span id="cb261-26"><a href="#cb261-26" aria-hidden="true"></a>                        <span class="co">; Bit 1: Enable SOC limit</span></span>
<span id="cb261-27"><a href="#cb261-27" aria-hidden="true"></a>                        <span class="co">; Bit 2: Enable VCell min limit</span></span>
<span id="cb261-28"><a href="#cb261-28" aria-hidden="true"></a>                        <span class="co">; Bit 3: Enable VCell max limit</span></span>
<span id="cb261-29"><a href="#cb261-29" aria-hidden="true"></a><span class="at">&#39;bms-t-limit-start</span>      <span class="co">; Temperature where current starts to get reduced</span></span>
<span id="cb261-30"><a href="#cb261-30" aria-hidden="true"></a><span class="at">&#39;bms-t-limit-end</span>        <span class="co">; Temperature above which current is not allowed</span></span>
<span id="cb261-31"><a href="#cb261-31" aria-hidden="true"></a><span class="at">&#39;bms-vmin-limit-start</span>   <span class="co">; VCell where current starts to get reduced</span></span>
<span id="cb261-32"><a href="#cb261-32" aria-hidden="true"></a><span class="at">&#39;bms-vmin-limit-end</span>     <span class="co">; VCell below which current draw is not allowed</span></span>
<span id="cb261-33"><a href="#cb261-33" aria-hidden="true"></a><span class="at">&#39;bms-vmax-limit-start</span>   <span class="co">; VCell where regen current starts to get reduced</span></span>
<span id="cb261-34"><a href="#cb261-34" aria-hidden="true"></a><span class="at">&#39;bms-vmax-limit-end</span>     <span class="co">; VCell above which regen current is not allowed</span></span>
<span id="cb261-35"><a href="#cb261-35" aria-hidden="true"></a></span>
<span id="cb261-36"><a href="#cb261-36" aria-hidden="true"></a><span class="at">&#39;motor-type</span>             <span class="co">; Motor Type</span></span>
<span id="cb261-37"><a href="#cb261-37" aria-hidden="true"></a>                        <span class="co">;    0: BLDC (6-step commutation)</span></span>
<span id="cb261-38"><a href="#cb261-38" aria-hidden="true"></a>                        <span class="co">;    1: DC (DC motor on phase A and C)</span></span>
<span id="cb261-39"><a href="#cb261-39" aria-hidden="true"></a>                        <span class="co">;    2: FOC (Field Oriented Control)</span></span>
<span id="cb261-40"><a href="#cb261-40" aria-hidden="true"></a>                        <span class="co">;    3: GPD (General Purpose Drive)</span></span>
<span id="cb261-41"><a href="#cb261-41" aria-hidden="true"></a><span class="at">&#39;m-invert-direction</span>     <span class="co">; Invert motor direction, 0 or 1</span></span>
<span id="cb261-42"><a href="#cb261-42" aria-hidden="true"></a><span class="at">&#39;m-out-aux-mode</span>         <span class="co">; AUX-pin output mode. Options:</span></span>
<span id="cb261-43"><a href="#cb261-43" aria-hidden="true"></a>                        <span class="co">;    0:  OUT_AUX_MODE_OFF</span></span>
<span id="cb261-44"><a href="#cb261-44" aria-hidden="true"></a>                        <span class="co">;    1:  OUT_AUX_MODE_ON_AFTER_2S</span></span>
<span id="cb261-45"><a href="#cb261-45" aria-hidden="true"></a>                        <span class="co">;    2:  OUT_AUX_MODE_ON_AFTER_5S</span></span>
<span id="cb261-46"><a href="#cb261-46" aria-hidden="true"></a>                        <span class="co">;    3:  OUT_AUX_MODE_ON_AFTER_10S</span></span>
<span id="cb261-47"><a href="#cb261-47" aria-hidden="true"></a>                        <span class="co">;    4:  OUT_AUX_MODE_UNUSED</span></span>
<span id="cb261-48"><a href="#cb261-48" aria-hidden="true"></a>                        <span class="co">;    5:  OUT_AUX_MODE_ON_WHEN_RUNNING</span></span>
<span id="cb261-49"><a href="#cb261-49" aria-hidden="true"></a>                        <span class="co">;    6:  OUT_AUX_MODE_ON_WHEN_NOT_RUNNING</span></span>
<span id="cb261-50"><a href="#cb261-50" aria-hidden="true"></a>                        <span class="co">;    7:  OUT_AUX_MODE_MOTOR_50</span></span>
<span id="cb261-51"><a href="#cb261-51" aria-hidden="true"></a>                        <span class="co">;    8:  OUT_AUX_MODE_MOSFET_50</span></span>
<span id="cb261-52"><a href="#cb261-52" aria-hidden="true"></a>                        <span class="co">;    9:  OUT_AUX_MODE_MOTOR_70</span></span>
<span id="cb261-53"><a href="#cb261-53" aria-hidden="true"></a>                        <span class="co">;    10: OUT_AUX_MODE_MOSFET_70</span></span>
<span id="cb261-54"><a href="#cb261-54" aria-hidden="true"></a>                        <span class="co">;    11: OUT_AUX_MODE_MOTOR_MOSFET_50</span></span>
<span id="cb261-55"><a href="#cb261-55" aria-hidden="true"></a>                        <span class="co">;    12: OUT_AUX_MODE_MOTOR_MOSFET_70</span></span>
<span id="cb261-56"><a href="#cb261-56" aria-hidden="true"></a><span class="at">&#39;m-motor-temp-sens-type</span> <span class="co">; Temperature sensor type (Added in FW 6.05). Options:</span></span>
<span id="cb261-57"><a href="#cb261-57" aria-hidden="true"></a>                        <span class="co">;    0:  TEMP_SENSOR_NTC_10K_25C</span></span>
<span id="cb261-58"><a href="#cb261-58" aria-hidden="true"></a>                        <span class="co">;    1:  TEMP_SENSOR_PTC_1K_100C</span></span>
<span id="cb261-59"><a href="#cb261-59" aria-hidden="true"></a>                        <span class="co">;    2:  TEMP_SENSOR_KTY83_122</span></span>
<span id="cb261-60"><a href="#cb261-60" aria-hidden="true"></a>                        <span class="co">;    3:  TEMP_SENSOR_NTC_100K_25C</span></span>
<span id="cb261-61"><a href="#cb261-61" aria-hidden="true"></a>                        <span class="co">;    4:  TEMP_SENSOR_KTY84_130</span></span>
<span id="cb261-62"><a href="#cb261-62" aria-hidden="true"></a>                        <span class="co">;    5:  TEMP_SENSOR_NTCX</span></span>
<span id="cb261-63"><a href="#cb261-63" aria-hidden="true"></a>                        <span class="co">;    6:  TEMP_SENSOR_PTCX</span></span>
<span id="cb261-64"><a href="#cb261-64" aria-hidden="true"></a>                        <span class="co">;    7:  TEMP_SENSOR_PT1000</span></span>
<span id="cb261-65"><a href="#cb261-65" aria-hidden="true"></a>                        <span class="co">;    8:  TEMP_SENSOR_DISABLED</span></span>
<span id="cb261-66"><a href="#cb261-66" aria-hidden="true"></a><span class="at">&#39;foc-sensor-mode</span>        <span class="co">; FOC sensor mode</span></span>
<span id="cb261-67"><a href="#cb261-67" aria-hidden="true"></a>                        <span class="co">;    0: FOC_SENSOR_MODE_SENSORLESS</span></span>
<span id="cb261-68"><a href="#cb261-68" aria-hidden="true"></a>                        <span class="co">;    1: FOC_SENSOR_MODE_ENCODER</span></span>
<span id="cb261-69"><a href="#cb261-69" aria-hidden="true"></a>                        <span class="co">;    2: FOC_SENSOR_MODE_HALL</span></span>
<span id="cb261-70"><a href="#cb261-70" aria-hidden="true"></a>                        <span class="co">;    3: FOC_SENSOR_MODE_HFI</span></span>
<span id="cb261-71"><a href="#cb261-71" aria-hidden="true"></a>                        <span class="co">;    4: FOC_SENSOR_MODE_HFI_START</span></span>
<span id="cb261-72"><a href="#cb261-72" aria-hidden="true"></a>                        <span class="co">;    5: FOC_SENSOR_MODE_HFI_V2</span></span>
<span id="cb261-73"><a href="#cb261-73" aria-hidden="true"></a>                        <span class="co">;    6: FOC_SENSOR_MODE_HFI_V3</span></span>
<span id="cb261-74"><a href="#cb261-74" aria-hidden="true"></a>                        <span class="co">;    7: FOC_SENSOR_MODE_HFI_V4</span></span>
<span id="cb261-75"><a href="#cb261-75" aria-hidden="true"></a>                        <span class="co">;    8: FOC_SENSOR_MODE_HFI_V5</span></span>
<span id="cb261-76"><a href="#cb261-76" aria-hidden="true"></a><span class="at">&#39;foc-encoder-offset</span>     <span class="co">; Encoder zero and motor zero offset (FW 6.06+)</span></span>
<span id="cb261-77"><a href="#cb261-77" aria-hidden="true"></a><span class="at">&#39;foc-encoder-inverted</span>   <span class="co">; Encoder vs motor direction inverted (FW 6.06+)</span></span>
<span id="cb261-78"><a href="#cb261-78" aria-hidden="true"></a><span class="at">&#39;foc-encoder-ratio</span>      <span class="co">; Ratio between electrical and encoder turns (FW 6.06+)</span></span>
<span id="cb261-79"><a href="#cb261-79" aria-hidden="true"></a><span class="at">&#39;m-ntc-motor-beta</span>       <span class="co">; Beta Value for Motor Thermistor</span></span>
<span id="cb261-80"><a href="#cb261-80" aria-hidden="true"></a><span class="at">&#39;m-ptc-motor-coeff</span>      <span class="co">; Coefficient for PTC Motor Thermistor. Unit: %/K (FW 6.06+)</span></span>
<span id="cb261-81"><a href="#cb261-81" aria-hidden="true"></a><span class="at">&#39;m-ntcx-ptcx-temp-base</span>  <span class="co">; Resistance of custom NTC/PTC resistor. (FW 6.06+)</span></span>
<span id="cb261-82"><a href="#cb261-82" aria-hidden="true"></a><span class="at">&#39;m-ntcx-ptcx-res</span>        <span class="co">; Base temperature of custom NTC/PTC resistor. (FW 6.06+)</span></span>
<span id="cb261-83"><a href="#cb261-83" aria-hidden="true"></a><span class="at">&#39;m-encoder-counts</span>       <span class="co">; ABI encoder counts (FW 6.06)</span></span>
<span id="cb261-84"><a href="#cb261-84" aria-hidden="true"></a><span class="at">&#39;m-sensor-port-mode</span>     <span class="co">; Sensor port mode (FW 6.06)</span></span>
<span id="cb261-85"><a href="#cb261-85" aria-hidden="true"></a>                        <span class="co">;    0: SENSOR_PORT_MODE_HALL</span></span>
<span id="cb261-86"><a href="#cb261-86" aria-hidden="true"></a>                        <span class="co">;    1: SENSOR_PORT_MODE_ABI</span></span>
<span id="cb261-87"><a href="#cb261-87" aria-hidden="true"></a>                        <span class="co">;    2: SENSOR_PORT_MODE_AS5047_SPI</span></span>
<span id="cb261-88"><a href="#cb261-88" aria-hidden="true"></a>                        <span class="co">;    3: SENSOR_PORT_MODE_AD2S1205</span></span>
<span id="cb261-89"><a href="#cb261-89" aria-hidden="true"></a>                        <span class="co">;    4: SENSOR_PORT_MODE_SINCOS</span></span>
<span id="cb261-90"><a href="#cb261-90" aria-hidden="true"></a>                        <span class="co">;    5: SENSOR_PORT_MODE_TS5700N8501</span></span>
<span id="cb261-91"><a href="#cb261-91" aria-hidden="true"></a>                        <span class="co">;    6: SENSOR_PORT_MODE_TS5700N8501_MULTITURN</span></span>
<span id="cb261-92"><a href="#cb261-92" aria-hidden="true"></a>                        <span class="co">;    7: SENSOR_PORT_MODE_MT6816_SPI_HW</span></span>
<span id="cb261-93"><a href="#cb261-93" aria-hidden="true"></a>                        <span class="co">;    8: SENSOR_PORT_MODE_AS5x47U_SPI</span></span>
<span id="cb261-94"><a href="#cb261-94" aria-hidden="true"></a>                        <span class="co">;    9: SENSOR_PORT_MODE_BISSC</span></span>
<span id="cb261-95"><a href="#cb261-95" aria-hidden="true"></a>                        <span class="co">;    10: SENSOR_PORT_MODE_TLE5012_SSC_SW</span></span>
<span id="cb261-96"><a href="#cb261-96" aria-hidden="true"></a>                        <span class="co">;    11: SENSOR_PORT_MODE_TLE5012_SSC_HW</span></span>
<span id="cb261-97"><a href="#cb261-97" aria-hidden="true"></a>                        <span class="co">;    12: SENSOR_PORT_MODE_CUSTOM_ENCODER</span></span>
<span id="cb261-98"><a href="#cb261-98" aria-hidden="true"></a>                        <span class="co">;    13: SENSOR_PORT_MODE_PWM</span></span>
<span id="cb261-99"><a href="#cb261-99" aria-hidden="true"></a>                        <span class="co">;    14: SENSOR_PORT_MODE_PWM_ABI</span></span>
<span id="cb261-100"><a href="#cb261-100" aria-hidden="true"></a><span class="at">&#39;m-fault-stop-time-ms</span>   <span class="co">; Milliseconds to stop the motor for after fauls (FW6.06.5)</span></span>
<span id="cb261-101"><a href="#cb261-101" aria-hidden="true"></a><span class="at">&#39;si-motor-poles</span>         <span class="co">; Number of motor poles, must be multiple of 2</span></span>
<span id="cb261-102"><a href="#cb261-102" aria-hidden="true"></a><span class="at">&#39;si-gear-ratio</span>          <span class="co">; Gear ratio (Added in FW 6.05)</span></span>
<span id="cb261-103"><a href="#cb261-103" aria-hidden="true"></a><span class="at">&#39;si-wheel-diameter</span>      <span class="co">; Wheel diameter in meters (Added in FW 6.05)</span></span>
<span id="cb261-104"><a href="#cb261-104" aria-hidden="true"></a><span class="at">&#39;si-battery-cells</span>       <span class="co">; Number of battery cells in series (Added in FW 6.05)</span></span>
<span id="cb261-105"><a href="#cb261-105" aria-hidden="true"></a><span class="at">&#39;si-battery-ah</span>          <span class="co">; Battery amp hours (Added in FW 6.05)</span></span>
<span id="cb261-106"><a href="#cb261-106" aria-hidden="true"></a><span class="at">&#39;foc-current-kp</span>         <span class="co">; FOC current controller KP</span></span>
<span id="cb261-107"><a href="#cb261-107" aria-hidden="true"></a><span class="at">&#39;foc-current-ki</span>         <span class="co">; FOC current controller KI</span></span>
<span id="cb261-108"><a href="#cb261-108" aria-hidden="true"></a><span class="at">&#39;foc-f-zv</span>               <span class="co">; Zero Vector Frequency in Hz (Added in FW 6.05)</span></span>
<span id="cb261-109"><a href="#cb261-109" aria-hidden="true"></a><span class="at">&#39;foc-motor-l</span>            <span class="co">; Motor inductance in microHenry</span></span>
<span id="cb261-110"><a href="#cb261-110" aria-hidden="true"></a><span class="at">&#39;foc-motor-ld-lq-diff</span>   <span class="co">; D and Q axis inductance difference in microHenry</span></span>
<span id="cb261-111"><a href="#cb261-111" aria-hidden="true"></a><span class="at">&#39;foc-motor-r</span>            <span class="co">; Motor resistance in milliOhm</span></span>
<span id="cb261-112"><a href="#cb261-112" aria-hidden="true"></a><span class="at">&#39;foc-motor-flux-linkage</span> <span class="co">; Motor flux linkage in milliWeber</span></span>
<span id="cb261-113"><a href="#cb261-113" aria-hidden="true"></a><span class="at">&#39;foc-observer-gain</span>      <span class="co">; Observer gain x1M</span></span>
<span id="cb261-114"><a href="#cb261-114" aria-hidden="true"></a><span class="at">&#39;foc-observer-type</span>      <span class="co">; Observer type (FW 6.06)</span></span>
<span id="cb261-115"><a href="#cb261-115" aria-hidden="true"></a>                        <span class="co">;    0 : FOC_OBSERVER_ORTEGA_ORIGINAL</span></span>
<span id="cb261-116"><a href="#cb261-116" aria-hidden="true"></a>                        <span class="co">;    1 : FOC_OBSERVER_MXLEMMING</span></span>
<span id="cb261-117"><a href="#cb261-117" aria-hidden="true"></a>                        <span class="co">;    2 : FOC_OBSERVER_ORTEGA_LAMBDA_COMP</span></span>
<span id="cb261-118"><a href="#cb261-118" aria-hidden="true"></a>                        <span class="co">;    3 : FOC_OBSERVER_MXLEMMING_LAMBDA_COMP</span></span>
<span id="cb261-119"><a href="#cb261-119" aria-hidden="true"></a>                        <span class="co">;    4 : FOC_OBSERVER_MXV</span></span>
<span id="cb261-120"><a href="#cb261-120" aria-hidden="true"></a>                        <span class="co">;    5 : FOC_OBSERVER_MXV_LAMBDA_COMP</span></span>
<span id="cb261-121"><a href="#cb261-121" aria-hidden="true"></a>                        <span class="co">;    6 : FOC_OBSERVER_MXV_LAMBDA_COMP</span></span>
<span id="cb261-122"><a href="#cb261-122" aria-hidden="true"></a><span class="at">&#39;foc-mtpa-mode</span>          <span class="co">; Maximum Torque per Amp (MTPA) Mode (FW 6.06)</span></span>
<span id="cb261-123"><a href="#cb261-123" aria-hidden="true"></a>                        <span class="co">;    0 : MTPA_MODE_OFF</span></span>
<span id="cb261-124"><a href="#cb261-124" aria-hidden="true"></a>                        <span class="co">;    1 : MTPA_MODE_IQ_TARGET</span></span>
<span id="cb261-125"><a href="#cb261-125" aria-hidden="true"></a>                        <span class="co">;    2 : MTPA_MODE_IQ_MEASURED</span></span>
<span id="cb261-126"><a href="#cb261-126" aria-hidden="true"></a><span class="at">&#39;foc-hfi-amb-mode</span>       <span class="co">; HFI Ambiguity Resolve Mode (FW 6.06)</span></span>
<span id="cb261-127"><a href="#cb261-127" aria-hidden="true"></a>                        <span class="co">;    0 : Six Vector</span></span>
<span id="cb261-128"><a href="#cb261-128" aria-hidden="true"></a>                        <span class="co">;    1 : ID Single Pulse</span></span>
<span id="cb261-129"><a href="#cb261-129" aria-hidden="true"></a>                        <span class="co">;    2 : ID Double Pulse</span></span>
<span id="cb261-130"><a href="#cb261-130" aria-hidden="true"></a><span class="at">&#39;foc-hfi-amb-current</span>    <span class="co">; HFI Ambiguity Resolve Current (FW 6.06)</span></span>
<span id="cb261-131"><a href="#cb261-131" aria-hidden="true"></a><span class="at">&#39;foc-hfi-amb-tres</span>       <span class="co">; HFI Ambiguity Resolve Threshold (FW 6.06)</span></span>
<span id="cb261-132"><a href="#cb261-132" aria-hidden="true"></a><span class="at">&#39;foc-hfi-voltage-start</span>  <span class="co">; HFI start voltage (V) (for resolving ambiguity)</span></span>
<span id="cb261-133"><a href="#cb261-133" aria-hidden="true"></a><span class="at">&#39;foc-hfi-voltage-run</span>    <span class="co">; HFI voltage (V) HFI voltage at min current</span></span>
<span id="cb261-134"><a href="#cb261-134" aria-hidden="true"></a><span class="at">&#39;foc-hfi-voltage-max</span>    <span class="co">; HFI voltage (V) at max current</span></span>
<span id="cb261-135"><a href="#cb261-135" aria-hidden="true"></a><span class="at">&#39;foc-sl-erpm</span>            <span class="co">; Full sensorless control (Added in FW 6.05)</span></span>
<span id="cb261-136"><a href="#cb261-136" aria-hidden="true"></a><span class="at">&#39;foc-sl-erpm-start</span>      <span class="co">; Start sensorless transition here (Added in FW 6.05)</span></span>
<span id="cb261-137"><a href="#cb261-137" aria-hidden="true"></a><span class="at">&#39;foc-hall-t0</span>            <span class="co">; Hall table index 0 (Added in FW 6.05)</span></span>
<span id="cb261-138"><a href="#cb261-138" aria-hidden="true"></a><span class="at">&#39;foc-hall-t1</span>            <span class="co">; Hall table index 1 (Added in FW 6.05)</span></span>
<span id="cb261-139"><a href="#cb261-139" aria-hidden="true"></a><span class="at">&#39;foc-hall-t2</span>            <span class="co">; Hall table index 2 (Added in FW 6.05)</span></span>
<span id="cb261-140"><a href="#cb261-140" aria-hidden="true"></a><span class="at">&#39;foc-hall-t3</span>            <span class="co">; Hall table index 3 (Added in FW 6.05)</span></span>
<span id="cb261-141"><a href="#cb261-141" aria-hidden="true"></a><span class="at">&#39;foc-hall-t4</span>            <span class="co">; Hall table index 4 (Added in FW 6.05)</span></span>
<span id="cb261-142"><a href="#cb261-142" aria-hidden="true"></a><span class="at">&#39;foc-hall-t5</span>            <span class="co">; Hall table index 5 (Added in FW 6.05)</span></span>
<span id="cb261-143"><a href="#cb261-143" aria-hidden="true"></a><span class="at">&#39;foc-hall-t6</span>            <span class="co">; Hall table index 6 (Added in FW 6.05)</span></span>
<span id="cb261-144"><a href="#cb261-144" aria-hidden="true"></a><span class="at">&#39;foc-hall-t7</span>            <span class="co">; Hall table index 7 (Added in FW 6.05)</span></span>
<span id="cb261-145"><a href="#cb261-145" aria-hidden="true"></a><span class="at">&#39;foc-sl-erpm-hfi</span>        <span class="co">; ERPM where to move to sensorless in HFI mode</span></span>
<span id="cb261-146"><a href="#cb261-146" aria-hidden="true"></a><span class="at">&#39;foc-hfi-reset-erpm</span>     <span class="co">; Reset HFI ambiguity resolution below this ERPM (FW 7.0)</span></span>
<span id="cb261-147"><a href="#cb261-147" aria-hidden="true"></a><span class="at">&#39;foc-openloop-rpm</span>       <span class="co">; Use openloop commutation below this ERPM</span></span>
<span id="cb261-148"><a href="#cb261-148" aria-hidden="true"></a><span class="at">&#39;foc-openloop-rpm-low</span>   <span class="co">; Openloop ERPM and minimum current</span></span>
<span id="cb261-149"><a href="#cb261-149" aria-hidden="true"></a><span class="at">&#39;foc-sl-openloop-time-lock</span> <span class="co">; Locking time at the start of openloop</span></span>
<span id="cb261-150"><a href="#cb261-150" aria-hidden="true"></a><span class="at">&#39;foc-sl-openloop-time-ramp</span> <span class="co">; Time to ramp up to the openloop speed</span></span>
<span id="cb261-151"><a href="#cb261-151" aria-hidden="true"></a><span class="at">&#39;foc-sl-openloop-time</span>   <span class="co">; Stay in openloop for this amount of time</span></span>
<span id="cb261-152"><a href="#cb261-152" aria-hidden="true"></a><span class="at">&#39;foc-temp-comp</span>          <span class="co">; Use observer temperature compensation</span></span>
<span id="cb261-153"><a href="#cb261-153" aria-hidden="true"></a><span class="at">&#39;foc-temp-comp-base-temp</span> <span class="co">; Temperature at which parameters were measured</span></span>
<span id="cb261-154"><a href="#cb261-154" aria-hidden="true"></a><span class="at">&#39;foc-offsets-cal-on-boot</span> <span class="co">; Measure offsets at boot (FW 6.05 only)</span></span>
<span id="cb261-155"><a href="#cb261-155" aria-hidden="true"></a><span class="at">&#39;foc-offsets-cal-mode</span>   <span class="co">; Offset Calibration Mode (Added in FW 6.06)</span></span>
<span id="cb261-156"><a href="#cb261-156" aria-hidden="true"></a>                        <span class="co">; Bit 0: Calibrate on Boot</span></span>
<span id="cb261-157"><a href="#cb261-157" aria-hidden="true"></a>                        <span class="co">; Bit 1: Enable Write from VESC Tool</span></span>
<span id="cb261-158"><a href="#cb261-158" aria-hidden="true"></a>                        <span class="co">; Bit 2: Auto-calibrate when undriven</span></span>
<span id="cb261-159"><a href="#cb261-159" aria-hidden="true"></a><span class="at">&#39;foc-fw-current-max</span>     <span class="co">; Maximum field weakening current (Added in FW 6.05)</span></span>
<span id="cb261-160"><a href="#cb261-160" aria-hidden="true"></a><span class="at">&#39;foc-fw-duty-start</span>      <span class="co">; Duty where field weakening starts (Added in FW 6.05)</span></span>
<span id="cb261-161"><a href="#cb261-161" aria-hidden="true"></a><span class="at">&#39;foc-short-ls-on-zero-duty</span> <span class="co">; Short low-side FETs on 0 duty (Added in FW 6.05)</span></span>
<span id="cb261-162"><a href="#cb261-162" aria-hidden="true"></a><span class="at">&#39;foc-overmod-factor</span>     <span class="co">; FOC overmodulation factor (Added in FW 6.06)</span></span>
<span id="cb261-163"><a href="#cb261-163" aria-hidden="true"></a><span class="at">&#39;min-speed</span>              <span class="co">; Minimum speed in meters per second (a negative value)</span></span>
<span id="cb261-164"><a href="#cb261-164" aria-hidden="true"></a><span class="at">&#39;max-speed</span>              <span class="co">; Maximum speed in meters per second</span></span>
<span id="cb261-165"><a href="#cb261-165" aria-hidden="true"></a><span class="at">&#39;app-to-use</span>             <span class="co">; App to use</span></span>
<span id="cb261-166"><a href="#cb261-166" aria-hidden="true"></a>                        <span class="co">;    0: APP_NONE</span></span>
<span id="cb261-167"><a href="#cb261-167" aria-hidden="true"></a>                        <span class="co">;    1: APP_PPM</span></span>
<span id="cb261-168"><a href="#cb261-168" aria-hidden="true"></a>                        <span class="co">;    2: APP_ADC</span></span>
<span id="cb261-169"><a href="#cb261-169" aria-hidden="true"></a>                        <span class="co">;    3: APP_UART</span></span>
<span id="cb261-170"><a href="#cb261-170" aria-hidden="true"></a>                        <span class="co">;    4: APP_PPM_UART</span></span>
<span id="cb261-171"><a href="#cb261-171" aria-hidden="true"></a>                        <span class="co">;    5: APP_ADC_UART</span></span>
<span id="cb261-172"><a href="#cb261-172" aria-hidden="true"></a>                        <span class="co">;    6: APP_NUNCHUK</span></span>
<span id="cb261-173"><a href="#cb261-173" aria-hidden="true"></a>                        <span class="co">;    7: APP_NRF</span></span>
<span id="cb261-174"><a href="#cb261-174" aria-hidden="true"></a>                        <span class="co">;    8: APP_CUSTOM</span></span>
<span id="cb261-175"><a href="#cb261-175" aria-hidden="true"></a>                        <span class="co">;    9: APP_PAS</span></span>
<span id="cb261-176"><a href="#cb261-176" aria-hidden="true"></a>                        <span class="co">;    10: APP_ADC_PAS</span></span>
<span id="cb261-177"><a href="#cb261-177" aria-hidden="true"></a><span class="at">&#39;controller-id</span>          <span class="co">; VESC CAN ID</span></span>
<span id="cb261-178"><a href="#cb261-178" aria-hidden="true"></a><span class="at">&#39;timeout-msec</span>           <span class="co">; Motor timeout in milliseconds (Added in FW 6.06)</span></span>
<span id="cb261-179"><a href="#cb261-179" aria-hidden="true"></a><span class="at">&#39;can-baud-rate</span>          <span class="co">; CAN-bus baud rate (Added in FW 6.05)</span></span>
<span id="cb261-180"><a href="#cb261-180" aria-hidden="true"></a>                        <span class="co">;    0: 125K</span></span>
<span id="cb261-181"><a href="#cb261-181" aria-hidden="true"></a>                        <span class="co">;    1: 250K</span></span>
<span id="cb261-182"><a href="#cb261-182" aria-hidden="true"></a>                        <span class="co">;    2: 500K</span></span>
<span id="cb261-183"><a href="#cb261-183" aria-hidden="true"></a>                        <span class="co">;    3: 1M</span></span>
<span id="cb261-184"><a href="#cb261-184" aria-hidden="true"></a>                        <span class="co">;    4: 10K</span></span>
<span id="cb261-185"><a href="#cb261-185" aria-hidden="true"></a>                        <span class="co">;    5: 20K</span></span>
<span id="cb261-186"><a href="#cb261-186" aria-hidden="true"></a>                        <span class="co">;    6: 50K</span></span>
<span id="cb261-187"><a href="#cb261-187" aria-hidden="true"></a>                        <span class="co">;    7: 75K</span></span>
<span id="cb261-188"><a href="#cb261-188" aria-hidden="true"></a>                        <span class="co">;    8: 100K</span></span>
<span id="cb261-189"><a href="#cb261-189" aria-hidden="true"></a><span class="at">&#39;can-mode</span>               <span class="co">; CAN-bus mode (FW 6.05.3+)</span></span>
<span id="cb261-190"><a href="#cb261-190" aria-hidden="true"></a>                        <span class="co">;    0: 125K</span></span>
<span id="cb261-191"><a href="#cb261-191" aria-hidden="true"></a>                        <span class="co">;    1: VESC</span></span>
<span id="cb261-192"><a href="#cb261-192" aria-hidden="true"></a>                        <span class="co">;    2: UAVCAN</span></span>
<span id="cb261-193"><a href="#cb261-193" aria-hidden="true"></a>                        <span class="co">;    3: COMM Bridge</span></span>
<span id="cb261-194"><a href="#cb261-194" aria-hidden="true"></a>                        <span class="co">;    4: Unused</span></span>
<span id="cb261-195"><a href="#cb261-195" aria-hidden="true"></a><span class="at">&#39;can-status-rate-1</span>      <span class="co">; CAN status rate 1 in Hz (Added in FW 6.05)</span></span>
<span id="cb261-196"><a href="#cb261-196" aria-hidden="true"></a><span class="at">&#39;can-status-msgs-r1</span>     <span class="co">; Bitfield with the status messages (Added in FW 6.05)</span></span>
<span id="cb261-197"><a href="#cb261-197" aria-hidden="true"></a>                        <span class="co">; Bit0: Status 1 (RPM, Current, Duty)</span></span>
<span id="cb261-198"><a href="#cb261-198" aria-hidden="true"></a>                        <span class="co">; Bit1: Status 2 (Ah Used, Ah Charged)</span></span>
<span id="cb261-199"><a href="#cb261-199" aria-hidden="true"></a>                        <span class="co">; Bit2: Status 3 (Wh Used, Wh Charged)</span></span>
<span id="cb261-200"><a href="#cb261-200" aria-hidden="true"></a>                        <span class="co">; Bit3: Status 4 (T FET, T Mot, I In, PID pos)</span></span>
<span id="cb261-201"><a href="#cb261-201" aria-hidden="true"></a>                        <span class="co">; Bit4: Status 5 (V In, Tacho)</span></span>
<span id="cb261-202"><a href="#cb261-202" aria-hidden="true"></a>                        <span class="co">; Bit5: Status 6 (ADC1, ADC2, ADC3, PPM)</span></span>
<span id="cb261-203"><a href="#cb261-203" aria-hidden="true"></a><span class="at">&#39;can-status-rate-2</span>      <span class="co">; CAN status rate 2 in Hz (Added in FW 6.05)</span></span>
<span id="cb261-204"><a href="#cb261-204" aria-hidden="true"></a><span class="at">&#39;can-status-msgs-r2</span>     <span class="co">; See can-status-msgs-r1 (Added in FW 6.05)</span></span>
<span id="cb261-205"><a href="#cb261-205" aria-hidden="true"></a><span class="at">&#39;ppm-ctrl-type</span>          <span class="co">; PPM Control Type</span></span>
<span id="cb261-206"><a href="#cb261-206" aria-hidden="true"></a>                        <span class="co">;    0:  PPM_CTRL_TYPE_NONE</span></span>
<span id="cb261-207"><a href="#cb261-207" aria-hidden="true"></a>                        <span class="co">;    1:  PPM_CTRL_TYPE_CURRENT</span></span>
<span id="cb261-208"><a href="#cb261-208" aria-hidden="true"></a>                        <span class="co">;    2:  PPM_CTRL_TYPE_CURRENT_NOREV</span></span>
<span id="cb261-209"><a href="#cb261-209" aria-hidden="true"></a>                        <span class="co">;    3:  PPM_CTRL_TYPE_CURRENT_NOREV_BRAKE</span></span>
<span id="cb261-210"><a href="#cb261-210" aria-hidden="true"></a>                        <span class="co">;    4:  PPM_CTRL_TYPE_DUTY</span></span>
<span id="cb261-211"><a href="#cb261-211" aria-hidden="true"></a>                        <span class="co">;    5:  PPM_CTRL_TYPE_DUTY_NOREV</span></span>
<span id="cb261-212"><a href="#cb261-212" aria-hidden="true"></a>                        <span class="co">;    6:  PPM_CTRL_TYPE_PID</span></span>
<span id="cb261-213"><a href="#cb261-213" aria-hidden="true"></a>                        <span class="co">;    7:  PPM_CTRL_TYPE_PID_NOREV</span></span>
<span id="cb261-214"><a href="#cb261-214" aria-hidden="true"></a>                        <span class="co">;    8:  PPM_CTRL_TYPE_CURRENT_BRAKE_REV_HYST</span></span>
<span id="cb261-215"><a href="#cb261-215" aria-hidden="true"></a>                        <span class="co">;    9:  PPM_CTRL_TYPE_CURRENT_SMART_REV</span></span>
<span id="cb261-216"><a href="#cb261-216" aria-hidden="true"></a>                        <span class="co">;    10: PPM_CTRL_TYPE_PID_POSITION_180</span></span>
<span id="cb261-217"><a href="#cb261-217" aria-hidden="true"></a>                        <span class="co">;    11: PPM_CTRL_TYPE_PID_POSITION_360</span></span>
<span id="cb261-218"><a href="#cb261-218" aria-hidden="true"></a><span class="at">&#39;ppm-pulse-start</span>        <span class="co">; Shortest PPM pulse in ms</span></span>
<span id="cb261-219"><a href="#cb261-219" aria-hidden="true"></a><span class="at">&#39;ppm-pulse-end</span>          <span class="co">; Longest PPM pulse in ms</span></span>
<span id="cb261-220"><a href="#cb261-220" aria-hidden="true"></a><span class="at">&#39;ppm-pulse-center</span>       <span class="co">; Pulse corresponding to center throttle in ms</span></span>
<span id="cb261-221"><a href="#cb261-221" aria-hidden="true"></a><span class="at">&#39;ppm-ramp-time-pos</span>      <span class="co">; Positive ramping time in seconds</span></span>
<span id="cb261-222"><a href="#cb261-222" aria-hidden="true"></a><span class="at">&#39;ppm-ramp-time-neg</span>      <span class="co">; Negative ramping time in seconds</span></span>
<span id="cb261-223"><a href="#cb261-223" aria-hidden="true"></a><span class="at">&#39;ppm-hyst</span>               <span class="co">; Input deadband, range 0 to 1 (Added in FW 6.06.5)</span></span>
<span id="cb261-224"><a href="#cb261-224" aria-hidden="true"></a><span class="at">&#39;adc-ctrl-type</span>          <span class="co">; ADC Control Type (Added in FW 6.02)</span></span>
<span id="cb261-225"><a href="#cb261-225" aria-hidden="true"></a>                        <span class="co">;    0:  ADC_CTRL_TYPE_NONE</span></span>
<span id="cb261-226"><a href="#cb261-226" aria-hidden="true"></a>                        <span class="co">;    1:  ADC_CTRL_TYPE_CURRENT</span></span>
<span id="cb261-227"><a href="#cb261-227" aria-hidden="true"></a>                        <span class="co">;    2:  ADC_CTRL_TYPE_CURRENT_REV_CENTER</span></span>
<span id="cb261-228"><a href="#cb261-228" aria-hidden="true"></a>                        <span class="co">;    3:  ADC_CTRL_TYPE_CURRENT_REV_BUTTON</span></span>
<span id="cb261-229"><a href="#cb261-229" aria-hidden="true"></a>                        <span class="co">;    4:  ADC_CTRL_TYPE_CURRENT_REV_BUTTON_BRAKE_ADC</span></span>
<span id="cb261-230"><a href="#cb261-230" aria-hidden="true"></a>                        <span class="co">;    5:  ADC_CTRL_TYPE_CURRENT_REV_BUTTON_BRAKE_CENTER</span></span>
<span id="cb261-231"><a href="#cb261-231" aria-hidden="true"></a>                        <span class="co">;    6:  ADC_CTRL_TYPE_CURRENT_NOREV_BRAKE_CENTER</span></span>
<span id="cb261-232"><a href="#cb261-232" aria-hidden="true"></a>                        <span class="co">;    7:  ADC_CTRL_TYPE_CURRENT_NOREV_BRAKE_BUTTON</span></span>
<span id="cb261-233"><a href="#cb261-233" aria-hidden="true"></a>                        <span class="co">;    8:  ADC_CTRL_TYPE_CURRENT_NOREV_BRAKE_ADC</span></span>
<span id="cb261-234"><a href="#cb261-234" aria-hidden="true"></a>                        <span class="co">;    9:  ADC_CTRL_TYPE_DUTY</span></span>
<span id="cb261-235"><a href="#cb261-235" aria-hidden="true"></a>                        <span class="co">;    10: ADC_CTRL_TYPE_DUTY_REV_CENTER</span></span>
<span id="cb261-236"><a href="#cb261-236" aria-hidden="true"></a>                        <span class="co">;    11: ADC_CTRL_TYPE_DUTY_REV_BUTTON</span></span>
<span id="cb261-237"><a href="#cb261-237" aria-hidden="true"></a>                        <span class="co">;    12: ADC_CTRL_TYPE_PID</span></span>
<span id="cb261-238"><a href="#cb261-238" aria-hidden="true"></a>                        <span class="co">;    13: ADC_CTRL_TYPE_PID_REV_CENTER</span></span>
<span id="cb261-239"><a href="#cb261-239" aria-hidden="true"></a>                        <span class="co">;    14: ADC_CTRL_TYPE_PID_REV_BUTTON</span></span>
<span id="cb261-240"><a href="#cb261-240" aria-hidden="true"></a><span class="at">&#39;adc-ramp-time-pos</span>      <span class="co">; Positive ramping time in seconds (Added in FW 6.05)</span></span>
<span id="cb261-241"><a href="#cb261-241" aria-hidden="true"></a><span class="at">&#39;adc-ramp-time-neg</span>      <span class="co">; Negative ramping time in seconds (Added in FW 6.05)</span></span>
<span id="cb261-242"><a href="#cb261-242" aria-hidden="true"></a><span class="at">&#39;adc-thr-hyst</span>           <span class="co">; Throttle deadband, range 0 to 1 (Added in FW 6.05)</span></span>
<span id="cb261-243"><a href="#cb261-243" aria-hidden="true"></a><span class="at">&#39;adc-v1-start</span>           <span class="co">; Throttle 1 start voltage (Added in FW 6.05)</span></span>
<span id="cb261-244"><a href="#cb261-244" aria-hidden="true"></a><span class="at">&#39;adc-v1-end</span>             <span class="co">; Throttle 1 end voltage (Added in FW 6.05)</span></span>
<span id="cb261-245"><a href="#cb261-245" aria-hidden="true"></a><span class="at">&#39;adc-v1-min</span>             <span class="co">; Throttle 1 low fault voltage (Added in FW 6.05)</span></span>
<span id="cb261-246"><a href="#cb261-246" aria-hidden="true"></a><span class="at">&#39;adc-v1-max</span>             <span class="co">; Throttle 1 high fault voltage (Added in FW 6.05)</span></span>
<span id="cb261-247"><a href="#cb261-247" aria-hidden="true"></a><span class="at">&#39;pas-current-scaling</span>    <span class="co">; PAS current scaling (Added in FW 6.05)</span></span>
<span id="cb261-248"><a href="#cb261-248" aria-hidden="true"></a></span>
<span id="cb261-249"><a href="#cb261-249" aria-hidden="true"></a><span class="co">; Express settings (Added in 6.05)</span></span>
<span id="cb261-250"><a href="#cb261-250" aria-hidden="true"></a><span class="at">&#39;controller-id</span>          <span class="co">; VESC CAN ID</span></span>
<span id="cb261-251"><a href="#cb261-251" aria-hidden="true"></a><span class="at">&#39;can-baud-rate</span>          <span class="co">; CAN-bus baud rate</span></span>
<span id="cb261-252"><a href="#cb261-252" aria-hidden="true"></a>                        <span class="co">;    0: 125K</span></span>
<span id="cb261-253"><a href="#cb261-253" aria-hidden="true"></a>                        <span class="co">;    1: 250K</span></span>
<span id="cb261-254"><a href="#cb261-254" aria-hidden="true"></a>                        <span class="co">;    2: 500K</span></span>
<span id="cb261-255"><a href="#cb261-255" aria-hidden="true"></a>                        <span class="co">;    3: 1M</span></span>
<span id="cb261-256"><a href="#cb261-256" aria-hidden="true"></a>                        <span class="co">;    4: 10K</span></span>
<span id="cb261-257"><a href="#cb261-257" aria-hidden="true"></a>                        <span class="co">;    5: 20K</span></span>
<span id="cb261-258"><a href="#cb261-258" aria-hidden="true"></a>                        <span class="co">;    6: 50K</span></span>
<span id="cb261-259"><a href="#cb261-259" aria-hidden="true"></a>                        <span class="co">;    7: 75K</span></span>
<span id="cb261-260"><a href="#cb261-260" aria-hidden="true"></a>                        <span class="co">;    8: 100K</span></span>
<span id="cb261-261"><a href="#cb261-261" aria-hidden="true"></a><span class="at">&#39;can-status-rate-hz</span>     <span class="co">; CAN status message rate</span></span>
<span id="cb261-262"><a href="#cb261-262" aria-hidden="true"></a><span class="at">&#39;wifi-mode</span>              <span class="co">; Wifi mode</span></span>
<span id="cb261-263"><a href="#cb261-263" aria-hidden="true"></a>                        <span class="co">;    0: Disabled</span></span>
<span id="cb261-264"><a href="#cb261-264" aria-hidden="true"></a>                        <span class="co">;    1: Station</span></span>
<span id="cb261-265"><a href="#cb261-265" aria-hidden="true"></a>                        <span class="co">;    2: Access Point</span></span>
<span id="cb261-266"><a href="#cb261-266" aria-hidden="true"></a><span class="at">&#39;wifi-sta-ssid</span>          <span class="co">; Wifi station SSID</span></span>
<span id="cb261-267"><a href="#cb261-267" aria-hidden="true"></a><span class="at">&#39;wifi-sta-key</span>           <span class="co">; Wifi station Key</span></span>
<span id="cb261-268"><a href="#cb261-268" aria-hidden="true"></a><span class="at">&#39;wifi-ap-ssid</span>           <span class="co">; Wifi access point SSID</span></span>
<span id="cb261-269"><a href="#cb261-269" aria-hidden="true"></a><span class="at">&#39;wifi-ap-key</span>            <span class="co">; Wifi access point key</span></span>
<span id="cb261-270"><a href="#cb261-270" aria-hidden="true"></a><span class="at">&#39;use-tcp-local</span>          <span class="co">; Use local TCP server</span></span>
<span id="cb261-271"><a href="#cb261-271" aria-hidden="true"></a><span class="at">&#39;use-tcp-hub</span>            <span class="co">; Connecto to TCP hub</span></span>
<span id="cb261-272"><a href="#cb261-272" aria-hidden="true"></a><span class="at">&#39;tcp-hub-url</span>            <span class="co">; TCP hub URL</span></span>
<span id="cb261-273"><a href="#cb261-273" aria-hidden="true"></a><span class="at">&#39;tcp-hub-port</span>           <span class="co">; TCP hub port</span></span>
<span id="cb261-274"><a href="#cb261-274" aria-hidden="true"></a><span class="at">&#39;tcp-hub-id</span>             <span class="co">; TCP hub connection ID</span></span>
<span id="cb261-275"><a href="#cb261-275" aria-hidden="true"></a><span class="at">&#39;tcp-hub-pass</span>           <span class="co">; TCP hub password</span></span>
<span id="cb261-276"><a href="#cb261-276" aria-hidden="true"></a><span class="at">&#39;ble-mode</span>               <span class="co">; BLE mode</span></span>
<span id="cb261-277"><a href="#cb261-277" aria-hidden="true"></a>                        <span class="co">;    0: Disabled</span></span>
<span id="cb261-278"><a href="#cb261-278" aria-hidden="true"></a>                        <span class="co">;    1: Enabled</span></span>
<span id="cb261-279"><a href="#cb261-279" aria-hidden="true"></a>                        <span class="co">;    2: Enabled and encrypted with pin</span></span>
<span id="cb261-280"><a href="#cb261-280" aria-hidden="true"></a>                        <span class="co">;    3: Enabled with scripting</span></span>
<span id="cb261-281"><a href="#cb261-281" aria-hidden="true"></a><span class="at">&#39;ble-name</span>               <span class="co">; Device name (also the name that shows up in VESC Tool)</span></span>
<span id="cb261-282"><a href="#cb261-282" aria-hidden="true"></a><span class="at">&#39;ble-pin</span>                <span class="co">; BLE pin code</span></span>
<span id="cb261-283"><a href="#cb261-283" aria-hidden="true"></a><span class="at">&#39;ble-service-capacity</span>   <span class="co">; BLE Service Capacity</span></span>
<span id="cb261-284"><a href="#cb261-284" aria-hidden="true"></a><span class="at">&#39;ble-chr-descr-capacity</span> <span class="co">; BLE Characteristics and Descriptor Capacity</span></span></code></pre></div>
<hr />
<h4 id="conf-set">conf-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb262"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true"></a>(conf-set param value)</span></code></pre></div>
<p>Set param to value. This can be done while the motor is running and it will be applied instantly. Note that the parameter won't be stored in flash, so it will be back to the old value on the next boot. To store all parameters that have been changed you can use <a href="#conf-store">conf-store</a>. Example:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true"></a>(conf-set <span class="at">&#39;max-speed</span> (<span class="kw">/</span> <span class="dv">25</span> <span class="fl">3.6</span>)) <span class="co">; Set the maximum speed to 25 km/h</span></span></code></pre></div>
<hr />
<h4 id="conf-get">conf-get</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb264"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true"></a>(conf-get param optDefLim)</span></code></pre></div>
<p>Get the value of param. optDefLim is an optional argument that can be set to 1 or 2; 1 means get the default value and 2 means get the limit value. Example:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true"></a>(conf-get <span class="at">&#39;foc-motor-r</span>) <span class="co">; Get the motor resistance in milliOhm</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true"></a>(conf-get <span class="at">&#39;controller-id</span> <span class="dv">1</span>) <span class="co">; Get the default CAN ID of this VESC</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true"></a>(conf-get <span class="at">&#39;l-current-max</span> <span class="dv">2</span>) <span class="co">; Get the maximum allowed current on this hardware</span></span></code></pre></div>
<hr />
<h4 id="conf-store">conf-store</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb266"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true"></a>(conf-store)</span></code></pre></div>
<p>Store the current configuration to flash. This will stop the motor. Note: On the express most settings require a reboot to be applied. Remember to use conf-store before rebooting.</p>
<hr />
<h4 id="store-backup">store-backup</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06.6+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb267"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true"></a>(store-backup)</span></code></pre></div>
<p>Store backup data, such as odometer and runtime counter, to flash. This will stop the motor. conf-store will also store this data, but this function alone is much faster as the configurations are not stored.</p>
<hr />
<h4 id="conf-detect-foc">conf-detect-foc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb268"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true"></a>(conf-detect-foc canFwd maxLoss minCurrIn maxCurrIn openloopErpm slErpm)</span></code></pre></div>
<p>Run the same autodetection as the wizard in VESC Tool does. This function will block the current lispBM-thread until in finishes (other threads will continue running). Arguments:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true"></a>canFwd       <span class="co">; Scan CAN-bus and detect on all VESCs found on CAN-bus</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true"></a>maxLoss      <span class="co">; Maximum power loss in W to derive current limit from</span></span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true"></a>minCurrIn    <span class="co">; Minimum input current in A (negative value)</span></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true"></a>maxCurrIn    <span class="co">; Maximum input current in A</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true"></a>openLoopErpm <span class="co">; Openlopp ERPM setting</span></span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true"></a>slErpm       <span class="co">; Sensorless ERPM setting</span></span></code></pre></div>
<p>Result:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true"></a>  <span class="dv">0</span> <span class="co">; OK and no sensors found</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true"></a>  <span class="dv">1</span> <span class="co">; OK and hall sensors found</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true"></a>  <span class="dv">2</span> <span class="co">; OK and AS5047 found</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true"></a> <span class="dv">-1</span> <span class="co">; Fault code during sensor detection</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true"></a><span class="dv">-10</span> <span class="co">; Flux linkage detection failed</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true"></a><span class="dv">-50</span> <span class="co">; CAN-detection failed</span></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true"></a><span class="dv">-51</span> <span class="co">; CAN-detection timed out</span></span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true"></a><span class="co">; No can detection, 50w losses max, -20 A to 50 A input current, 800 ERPM openloop and 2500 erpm for sensorless in case sensors are found</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true"></a>(<span class="kw">print</span> (conf-detect-foc <span class="dv">0</span> <span class="dv">50</span> <span class="dv">-20</span> <span class="dv">50</span> <span class="dv">800</span> <span class="dv">2500</span>))</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true"></a><span class="co">; Print the result when done</span></span></code></pre></div>
<hr />
<h4 id="conf-set-pid-offset">conf-set-pid-offset</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb272"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true"></a>(conf-set-pid-offset offset optStore)</span></code></pre></div>
<p>Set the PID controller offset such that the current angle becomes offset. This can be used in position control applications when e.g. homing against a limit switch. The optional argument optStore can be set to true to store the offset persistently (although that requires stopping the motor).</p>
<hr />
<h4 id="conf-measure-res">conf-measure-res</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb273"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true"></a>(conf-measure-res current optSamples)</span></code></pre></div>
<p>Measure motor resistance with current. The optional argument optSamples sets the number of samples to use (default 100).</p>
<p>This command is useful to update the configuration before starting the motor as the resistance is the most important when it comes to sensorless low-speed performance. It is also useful to sanity check if the motor is shorted out or if a connector is loose. Such faults cause a relatively significant change in resistance. Changes with more than 50% compared to the detected value are most likely faults.</p>
<p><strong>NOTE:</strong> Phase filters are required to get accurate resistance measurements, so resistance-based fault detection is not as useful on hardware without phase filters.</p>
<hr />
<h4 id="conf-measure-ind">conf-measure-ind</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb274"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true"></a>(conf-measure-ind target-current optSamples)</span></code></pre></div>
<p>Measure motor inductance with target-current. The optional argument optSamples sets the number of samples to use (default 100).</p>
<p>returns: ({ld_lq_avg} {ld_lq_diff} {actual_measurement_current} fault-code)</p>
<p>Can not be used when the motor is running. The measurement current is not gaurenteed to reach the target, and the actual_measurement_current parameter should be used to verify the actual current used.</p>
<p>Useful for finding the saturation inductance curve of a motor.</p>
<hr />
<h4 id="conf-restore-mc">conf-restore-mc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb275"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true"></a>(conf-restore-mc)</span></code></pre></div>
<p>Restore motor configuration to the default values on the selected motor. The current and voltage offsets are kept from the old configuration.</p>
<hr />
<h4 id="conf-restore-app">conf-restore-app</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb276"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true"></a>(conf-restore-app)</span></code></pre></div>
<p>Restore app configuration to the default values.</p>
<hr />
<h4 id="conf-dc-cal">conf-dc-cal</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb277"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true"></a>(conf-dc-cal calUndriven)</span></code></pre></div>
<p>Run FOC DC offset calibration. calUndriven can be set to true for including the undriven voltages in the calibration, which requires that the motor stands still. If the calibration fails nil is returned and on success a list with the new offsets in the following format is returned:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true"></a>(i0 i1 i2 v0 v1 v2 v0-undriven v1-undriven v2-undriven)</span></code></pre></div>
<p>Since firmware 6.06 the argument calUndriven can be omitted. When it is omitted no calibration is done and the offsets in use are returned.</p>
<hr />
<h4 id="conf-dc-cal-set">conf-dc-cal-set</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb279"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true"></a>(conf-dc-cal-set i0 i1 i2 v0 v1 v2 v0-undriven v1-undriven v2-undriven)</span></code></pre></div>
<p>Manually set the offsets on the selected motor. Arguments that are set to nil will leave the corresponding offset unchanged. If not all arguments are given the ones left out will not be updated. Example:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true"></a><span class="co">; Set the i2-offset to 1.1 ADC counts and the v2-offset to 2.3 V. Leave the rest unchanged.</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true"></a>(conf-dc-cal-set <span class="va">nil</span> <span class="va">nil</span> <span class="fl">1.1</span> <span class="va">nil</span> <span class="va">nil</span> <span class="fl">2.3</span>)</span></code></pre></div>
<hr />
<h4 id="conf-enc-sincos">conf-enc-sincos</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb281"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true"></a>(conf-enc-sincos optSinAmp optCosAmp optSinOfs optCosOfs optFilter optPhaseCorr)</span></code></pre></div>
<p>Configure Sin/Cos encoder. Arguments that are set to nil will leave the corresponding parameter unchanged. If not all arguments are given the ones left out will not be updated. The resulting configuration is returned. If no arguments are given the resulting configuration is returned. Example:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true"></a>(conf-enc-sincos <span class="fl">1.0</span> <span class="fl">1.0</span> <span class="fl">1.65</span> <span class="fl">1.65</span> <span class="fl">0.5</span> <span class="fl">0.0</span>)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true"></a><span class="co">;&gt; (1.0 1.0 1.65 1.65 0.5 0.0)</span></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true"></a></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true"></a>(conf-enc-sincos)</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true"></a><span class="co">;&gt; (1.0 1.0 1.65 1.65 0.5 0.0)</span></span></code></pre></div>
<p>The update will be applied until reboot. To store it permanently conf-store can be used.</p>
<hr />
<h4 id="conf-get-limits">conf-get-limits</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb283"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true"></a>(conf-get-limits)</span></code></pre></div>
<p>Get all overridden current limits from speed, temperature, voltage, wattage etc. Return the following list:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true"></a>(motor-min motor-max input-min input-max)</span></code></pre></div>
<hr />
<h4 id="conf-detect-lambda-enc">conf-detect-lambda-enc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb285"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true"></a>(conf-detect-lambda-enc current duty erpm-per-sec resistance-mOhm inductance-uH)</span></code></pre></div>
<p>Detect flux linkage as well as encoder parameters if an encoder is configured. The parameters are</p>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>current</td>
<td>Current to spin up the motor with.</td>
</tr>
<tr class="even">
<td>duty</td>
<td>Duty cycle to stop at.</td>
</tr>
<tr class="odd">
<td>erpm-per-sec</td>
<td>Angular rate to spin up at in ERPM per second.</td>
</tr>
<tr class="even">
<td>resistance-mOhm</td>
<td>Motor resistance in milliohm. Has to be measured before.</td>
</tr>
<tr class="odd">
<td>inductance-uH</td>
<td>Motor inductance in microhenry. Has to be measured before.</td>
</tr>
</tbody>
</table>
<p>If the detection fails nil is returned. If a fault occurs during the detection the fault code is returned. Otherwise, the following list with the result is returned:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true"></a>(flux-linkage flux-linkage-undriven undriven-samples enc-offset enc-ratio enc-inverted)</span></code></pre></div>
<p>Where the result values are</p>
<table>
<thead>
<tr class="header">
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flux-linkage</td>
<td>Flux linkage estimate¬¥ in Wb while the motor is driven.</td>
</tr>
<tr class="even">
<td>flux-linkage-undriven</td>
<td>Undriven flux linkage in Wb. <strong>This is the better estimate that you want to use.</strong></td>
</tr>
<tr class="odd">
<td>undriven-samples</td>
<td>Samples for the undriven flux linkage measurement. Should be at least 500 or so for an accurate measurement.</td>
</tr>
<tr class="even">
<td>enc-offset</td>
<td>Encoder offset in degrees. -1 if the measurement fauiled.</td>
</tr>
<tr class="odd">
<td>enc-ratio</td>
<td>Encoder ratio. -1 if the measurement failed.</td>
</tr>
<tr class="even">
<td>enc-inverted</td>
<td>Encoder is inverted.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true"></a>(<span class="kw">print</span> (conf-detect-lambda-enc <span class="dv">40</span> <span class="fl">0.3</span> <span class="dv">1500</span> <span class="dv">7</span> <span class="dv">70</span>))</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true"></a><span class="kw">-&gt;</span> (<span class="fl">0.017543</span>f32 <span class="fl">0.018353</span>f32 <span class="fl">2000.000000</span>f32 <span class="fl">6.898595</span>f32 <span class="fl">4.000000</span>f32 <span class="dv">1</span>)</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true"></a></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true"></a><span class="co">; Use result of resistance and inductance measurement</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true"></a>(<span class="kw">print</span> (conf-detect-lambda-enc <span class="dv">40</span> <span class="fl">0.3</span> <span class="dv">1500</span> (conf-measure-res <span class="dv">30</span>) (<span class="kw">first</span> (conf-measure-ind <span class="dv">20</span>))))</span></code></pre></div>
<hr />
<h4 id="conf-detect-hall">conf-detect-hall</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.06.1+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb288"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true"></a>(conf-detect-hall current)</span></code></pre></div>
<p>Runs hall sensor detection using current in openloop. Returns the hall sensor table as a byte array on success or nil on failure.</p>
<hr />
<h4 id="conf-remap-as504x">conf-remap-as504x</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>7.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb289"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true"></a>(conf-remap-as504x optCs optSck optMosi optMiso)</span></code></pre></div>
<p>Remap one or more AS504x encoder pins. All arguments are optional and nil can be used to leave pins unchanged. Example:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true"></a></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true"></a><span class="co">; Use &#39;pin-swdio as chip select and &#39;pin-swclk as clock. Leave other pins</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true"></a><span class="co">; unchanged</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true"></a>(conf-remap-as504x <span class="at">&#39;pin-swdio</span> <span class="at">&#39;pin-swclk</span>)</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true"></a></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true"></a><span class="co">; Use &#39;pin-swclk as clock. Leave other pins unchanged</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true"></a>(conf-remap-as504x <span class="va">nil</span> <span class="at">&#39;pin-swclk</span>)</span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true"></a></span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true"></a><span class="co">; Available pins</span></span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true"></a><span class="at">&#39;pin-rx</span></span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true"></a><span class="at">&#39;pin-tx</span></span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true"></a><span class="at">&#39;pin-swdio</span></span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true"></a><span class="at">&#39;pin-swclk</span></span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true"></a><span class="at">&#39;pin-hall1</span></span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true"></a><span class="at">&#39;pin-hall2</span></span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true"></a><span class="at">&#39;pin-hall3</span></span></code></pre></div>
<hr />
<h3 id="eeprom-nonvolatile-storage">EEPROM (Nonvolatile Storage)</h3>
<p>Up to 128 (256 in FW 6.06) variables (int32 or float) can be stored in a nonvolatile memory reserved for LispBM. These variables persist between power cycles and configuration changes, but not between firmware updates. Keep in mind that the motor will be stopped briefly when writing them and that they only can be written a limited number of times (about 100 000 writes) before wear on the flash memory starts to become an issue.</p>
<hr />
<h4 id="eeprom-store-f">eeprom-store-f</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb291"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true"></a>(eeprom-store-f addr number)</span></code></pre></div>
<p>Store float number on emulated eeprom at address addr. Addr range: 0 to 127. Note that this will stop the motor briefly as writing to the flash memory cannot be done at the same time as the motor is running.</p>
<hr />
<h4 id="eeprom-read-f">eeprom-read-f</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb292"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true"></a>(eeprom-read-f addr)</span></code></pre></div>
<p>Read float number on emulated eeprom at address addr. Addr range: 0 to 127. If nothing was stored on that address this function returns nil.</p>
<hr />
<h4 id="eeprom-store-i">eeprom-store-i</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb293"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true"></a>(eeprom-store-i addr number)</span></code></pre></div>
<p>Same as eeprom-store-f, but store number as i32 instead of float.</p>
<hr />
<h4 id="eeprom-read-i">eeprom-read-i</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb294"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true"></a>(eeprom-read-i addr)</span></code></pre></div>
<p>Same as eeprom-read-i, but read number as i32 instead of float.</p>
<hr />
<h3 id="loops">Loops</h3>
<hr />
<h4 id="loopfor">loopfor</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb295"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true"></a>(loopfor it start <span class="kw">cond</span> <span class="kw">update</span> body)</span></code></pre></div>
<p>For-loop. it is the iterator, start is what it is initialized to, cond is the condition that has the be true for the loop to continue running, update is how to update the iterator after each iteration and body is the code to execute each iteration. The iterator can be accessed from within body. Example:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true"></a>(loopfor i <span class="dv">0</span> (<span class="kw">&lt;</span> i <span class="dv">5</span>) (<span class="kw">+</span> i <span class="dv">1</span>)</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true"></a>    (<span class="kw">print</span> i)</span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true"></a>)</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true"></a></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true"></a>Output:</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true"></a><span class="dv">0</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true"></a><span class="dv">1</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true"></a><span class="dv">2</span></span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true"></a><span class="dv">3</span></span>
<span id="cb296-10"><a href="#cb296-10" aria-hidden="true"></a><span class="dv">4</span></span>
<span id="cb296-11"><a href="#cb296-11" aria-hidden="true"></a></span>
<span id="cb296-12"><a href="#cb296-12" aria-hidden="true"></a><span class="co">; Remember that multiple statements in the loop require {} or progn:</span></span>
<span id="cb296-13"><a href="#cb296-13" aria-hidden="true"></a>(loopfor i <span class="dv">0</span> (<span class="kw">&lt;</span> i <span class="dv">5</span>) (<span class="kw">+</span> i <span class="dv">1</span>) {</span>
<span id="cb296-14"><a href="#cb296-14" aria-hidden="true"></a>        (<span class="kw">print</span> i)</span>
<span id="cb296-15"><a href="#cb296-15" aria-hidden="true"></a>        (sleep <span class="fl">0.5</span>)</span>
<span id="cb296-16"><a href="#cb296-16" aria-hidden="true"></a>})</span></code></pre></div>
<hr />
<h4 id="loopwhile">loopwhile</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb297"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true"></a>(loopwhile <span class="kw">cond</span> body)</span></code></pre></div>
<p>While-loop. cond is the condition that has the be true for the loop to continue running and body is the code to execute each iteration. Example:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true"></a>(define i <span class="dv">0</span>)</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true"></a></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true"></a>(loopwhile (<span class="kw">&lt;</span> i <span class="dv">5</span>) {</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true"></a>        (<span class="kw">print</span> i)</span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true"></a>        (define i (<span class="kw">+</span> i <span class="dv">1</span>))</span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true"></a>})</span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true"></a></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true"></a>Output:</span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true"></a><span class="dv">0</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true"></a><span class="dv">1</span></span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true"></a><span class="dv">2</span></span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true"></a><span class="dv">3</span></span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true"></a><span class="dv">4</span></span></code></pre></div>
<p>Another example that prints "Hello World" every two seconds:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true"></a>(loopwhile t {</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="st">&quot;Hello World&quot;</span>)</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true"></a>        (sleep <span class="dv">2</span>)</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true"></a>})</span></code></pre></div>
<hr />
<h4 id="looprange">looprange</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb300"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true"></a>(looprange it start end body)</span></code></pre></div>
<p>Range-loop. Iterate it from start to end and evaluate body for each iteration. The iterator it can be accessed from within body. Example:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true"></a>(looprange i <span class="dv">0</span> <span class="dv">5</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true"></a>    (<span class="kw">print</span> i)</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true"></a>)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true"></a></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true"></a>Output:</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true"></a><span class="dv">0</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true"></a><span class="dv">1</span></span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true"></a><span class="dv">2</span></span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true"></a><span class="dv">3</span></span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true"></a><span class="dv">4</span></span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true"></a></span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true"></a><span class="co">; As with the other loops, multiple statements require {} or progn</span></span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true"></a>(looprange i <span class="dv">0</span> <span class="dv">5</span> {</span>
<span id="cb301-14"><a href="#cb301-14" aria-hidden="true"></a>        (<span class="kw">print</span> i)</span>
<span id="cb301-15"><a href="#cb301-15" aria-hidden="true"></a>        (sleep <span class="fl">0.5</span>)</span>
<span id="cb301-16"><a href="#cb301-16" aria-hidden="true"></a>})</span></code></pre></div>
<hr />
<h4 id="loopforeach">loopforeach</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb302"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true"></a>(loopforeach it lst body)</span></code></pre></div>
<p>ForEach-loop. Iterate over every element in the list lst and evaluate body for each iteration. The iterator it can be accessed from within body. Example:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true"></a>(loopforeach i &#39;(<span class="st">&quot;AB&quot;</span> <span class="st">&quot;C&quot;</span> <span class="st">&quot;dE&quot;</span> <span class="st">&quot;f&quot;</span>)</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true"></a>    (<span class="kw">print</span> i)</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true"></a>)</span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true"></a></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true"></a>Output:</span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true"></a>AB</span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true"></a>C</span>
<span id="cb303-8"><a href="#cb303-8" aria-hidden="true"></a>dE</span>
<span id="cb303-9"><a href="#cb303-9" aria-hidden="true"></a>f</span>
<span id="cb303-10"><a href="#cb303-10" aria-hidden="true"></a></span>
<span id="cb303-11"><a href="#cb303-11" aria-hidden="true"></a><span class="co">; As with the other loops, multiple statements require {} or progn</span></span>
<span id="cb303-12"><a href="#cb303-12" aria-hidden="true"></a>(loopforeach i &#39;(<span class="st">&quot;AB&quot;</span> <span class="st">&quot;C&quot;</span> <span class="st">&quot;dE&quot;</span> <span class="st">&quot;f&quot;</span>) {</span>
<span id="cb303-13"><a href="#cb303-13" aria-hidden="true"></a>        (<span class="kw">print</span> i)</span>
<span id="cb303-14"><a href="#cb303-14" aria-hidden="true"></a>        (sleep <span class="fl">0.5</span>)</span>
<span id="cb303-15"><a href="#cb303-15" aria-hidden="true"></a>})</span>
<span id="cb303-16"><a href="#cb303-16" aria-hidden="true"></a></span></code></pre></div>
<hr />
<h4 id="loopwhile-thd">loopwhile-thd</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb304"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true"></a>(loopwhile-thd stack <span class="kw">cond</span> body)</span></code></pre></div>
<p>While-loop that starts in a new thread. The argument stack is the stack-size of the thread, cond is the condition that has the be true for the loop to continue running and body is the code to execute each iteration. The difference from the regular loopwhile is that the evaluator will continue running the code after this one before this one finishes, as this loop is evaluated in a new thread.</p>
<p>Example that forever prints "Hello World" every two seconds:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true"></a>(loopwhile-thd <span class="dv">100</span> t {</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="st">&quot;Hello World&quot;</span>)</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true"></a>        (sleep <span class="dv">2</span>)</span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true"></a>})</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true"></a></span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true"></a><span class="co">; The above is equivalent to the following code</span></span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true"></a></span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true"></a>(spawn <span class="dv">100</span> (<span class="kw">fn</span> () (loopwhile t {</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true"></a>                (<span class="kw">print</span> <span class="st">&quot;Hello World&quot;</span>)</span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true"></a>                (sleep <span class="dv">2</span>)</span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true"></a>})))</span></code></pre></div>
<p>From firmware 6.06 it is possible to give the thread a name and/or a stack size. That gives the following combinations of possibilities:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true"></a><span class="co">; No name and default stack size</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true"></a>(loopwhile-thd () t {</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="st">&quot;Hello World1&quot;</span>)</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true"></a>        (sleep <span class="dv">2</span>)</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true"></a>})</span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true"></a></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true"></a><span class="co">; No name and stack size 100</span></span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true"></a>(loopwhile-thd <span class="dv">100</span> t {</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="st">&quot;Hello Worl2&quot;</span>)</span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true"></a>        (sleep <span class="dv">2</span>)</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true"></a>})</span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true"></a></span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true"></a><span class="co">; Name ThdTest and default stack size</span></span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true"></a>(loopwhile-thd <span class="st">&quot;ThdTest&quot;</span> t {</span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="st">&quot;Hello World3&quot;</span>)</span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true"></a>        (sleep <span class="dv">2</span>)</span>
<span id="cb306-17"><a href="#cb306-17" aria-hidden="true"></a>})</span>
<span id="cb306-18"><a href="#cb306-18" aria-hidden="true"></a></span>
<span id="cb306-19"><a href="#cb306-19" aria-hidden="true"></a><span class="co">; Name ThdTest2 and stack size 100</span></span>
<span id="cb306-20"><a href="#cb306-20" aria-hidden="true"></a>(loopwhile-thd (<span class="st">&quot;ThdTest2&quot;</span> <span class="dv">100</span>) t {</span>
<span id="cb306-21"><a href="#cb306-21" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="st">&quot;Hello World4&quot;</span>)</span>
<span id="cb306-22"><a href="#cb306-22" aria-hidden="true"></a>        (sleep <span class="dv">2</span>)</span>
<span id="cb306-23"><a href="#cb306-23" aria-hidden="true"></a>})</span></code></pre></div>
<hr />
<h4 id="break">break</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb307"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true"></a>(break retval)</span></code></pre></div>
<p>break can be used to break out of a loop and return retval (the result of the loop will be retval, otherwise the result of the loop will be the result of the last expression in it). break works in all of the loops above. Example:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true"></a><span class="co">; Below we make a function to determine if</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true"></a><span class="co">; the list lst contains number num</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true"></a>(defun contains (<span class="kw">num</span> lst)</span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true"></a>    (loopforeach it lst</span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true"></a>        (<span class="kw">if</span> (<span class="kw">=</span> it <span class="kw">num</span>)</span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true"></a>            (break t)</span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true"></a>            <span class="va">nil</span></span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true"></a>)))</span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true"></a></span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true"></a>(contains <span class="dv">346</span> &#39;(<span class="dv">12</span> <span class="dv">33</span> <span class="dv">452</span> <span class="dv">11</span> <span class="dv">22</span> <span class="dv">346</span> <span class="dv">99</span> <span class="dv">12</span>))</span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true"></a><span class="kw">&gt;</span> t</span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true"></a></span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true"></a>(contains <span class="dv">347</span> &#39;(<span class="dv">12</span> <span class="dv">33</span> <span class="dv">452</span> <span class="dv">11</span> <span class="dv">22</span> <span class="dv">346</span> <span class="dv">99</span> <span class="dv">12</span>))</span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="va">nil</span></span></code></pre></div>
<hr />
<h3 id="useful-lisp-functions">Useful Lisp Functions</h3>
<p>There are a number of lisp functions that can be used from lispBM in the VESC firmware. They will be loaded to the environment the first time they are used, so they do not use up memory before the first use.</p>
<hr />
<h4 id="defun">defun</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb309"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true"></a>(defun (args) body)</span></code></pre></div>
<p>Shorthand macro for defining a function. Example:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true"></a><span class="co">; Create function f with argument x that prints x</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true"></a>(defun f (x)</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true"></a>    (<span class="kw">print</span> x)</span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true"></a>)</span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true"></a></span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true"></a><span class="co">; The above is equivalent to</span></span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true"></a>(define f (lambda (x)</span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true"></a>    (<span class="kw">print</span> x)</span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true"></a>))</span></code></pre></div>
<hr />
<h4 id="defunret">defunret</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb311"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true"></a>(defunret (args) body)</span></code></pre></div>
<p>Same as defun, but allows returning at any point. This one has a bit more overhead than defun as it uses call-cc internally, which is why both exist.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true"></a>(defunret <span class="kw">test</span> (a b) {</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true"></a>        (<span class="kw">if</span> (<span class="kw">&gt;</span> a b)</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true"></a>            (return (<span class="kw">+</span> a <span class="dv">5</span>))</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true"></a>        )</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true"></a>        </span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true"></a>        (<span class="kw">+</span> a b)</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true"></a>})</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true"></a></span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true"></a>(<span class="kw">test</span> <span class="dv">2</span> <span class="dv">2</span>)</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">4</span></span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true"></a></span>
<span id="cb312-12"><a href="#cb312-12" aria-hidden="true"></a>(<span class="kw">test</span> <span class="dv">3</span> <span class="dv">2</span>)</span>
<span id="cb312-13"><a href="#cb312-13" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">8</span></span></code></pre></div>
<hr />
<h4 id="map">map</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb313"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true"></a>(<span class="kw">map</span> f lst)</span></code></pre></div>
<p>Apply function f to every element in list lst. Example:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true"></a>(<span class="kw">map</span> (<span class="kw">fn</span> (x) (<span class="kw">*</span> x <span class="dv">5</span>)) &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span>))</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">5</span> <span class="dv">10</span> <span class="dv">15</span> <span class="dv">20</span>)</span></code></pre></div>
<p>This example creates an anonymous function that takes one argument and returns that argument multiplied by 5. Map then applies it to every element in the list (1 2 3 4), which yields the list (5 10 15 20). In the later version of lispBM map is a "native" function, meaning that it is quite fast and efficient.</p>
<hr />
<h4 id="range">range</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb315"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true"></a>(<span class="kw">range</span> optStart end)</span></code></pre></div>
<p>Create a list from start to end, excluding end. Range also works with just one argument, which is takes as end assuming start is 0. Example:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true"></a>(<span class="kw">range</span> <span class="dv">2</span> <span class="dv">8</span>)</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span>)</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true"></a></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true"></a>(<span class="kw">range</span> <span class="dv">5</span>)</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span>)</span></code></pre></div>
<hr />
<h4 id="foldl">foldl</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb317"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true"></a>(foldl f init lst)</span></code></pre></div>
<p>Apply the function f to pairs of init and each element of the list lst and accumulate the result. Example:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true"></a>(foldl <span class="kw">+</span> <span class="dv">0</span> &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span>))</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">15</span></span></code></pre></div>
<hr />
<h4 id="foldr">foldr</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Same as foldl, but start from the right side of lst. Note that foldl is tail recursive but foldr is not, so if possible use foldl.</p>
<hr />
<h4 id="reverse">reverse</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb319"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true"></a>(<span class="kw">reverse</span> lst)</span></code></pre></div>
<p>Returns the list lst in reverse. Example:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true"></a>(<span class="kw">reverse</span> &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span>))</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">5</span> <span class="dv">4</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">1</span>)</span></code></pre></div>
<hr />
<h4 id="length">length</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb321"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true"></a>(length lst)</span></code></pre></div>
<p>Returns the length of list lst. Example:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true"></a>(length &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>))</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">3</span></span></code></pre></div>
<hr />
<h4 id="apply">apply</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb323"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true"></a>(<span class="kw">apply</span> f lst)</span></code></pre></div>
<p>Use the elements in list lst as arguments to function f. Example:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true"></a>(<span class="kw">apply</span> <span class="kw">+</span> &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>))</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">6</span></span></code></pre></div>
<hr />
<h4 id="zipwith">zipwith</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb325"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true"></a>(zipwith f x y)</span></code></pre></div>
<p>Apply the function f to pairs between the elements in list x and list y. Example:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true"></a>(zipwith <span class="kw">*</span> &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>) &#39;(<span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span>))</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">3</span> <span class="dv">8</span> <span class="dv">15</span>)</span></code></pre></div>
<hr />
<h4 id="filter">filter</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb327"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true"></a>(<span class="kw">filter</span> f lst)</span></code></pre></div>
<p>Filter list by keeping the elements on which f returns true. Example:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true"></a>(<span class="kw">filter</span> (<span class="kw">fn</span> (x) (<span class="kw">&lt;</span> x <span class="dv">5</span>)) &#39;(<span class="dv">3</span> <span class="dv">9</span> <span class="dv">5</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span>))</span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">3</span> <span class="dv">2</span> <span class="dv">4</span>)</span></code></pre></div>
<hr />
<h4 id="sort">sort</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb329"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true"></a>(<span class="kw">sort</span> f lst)</span></code></pre></div>
<p>Sort list lst using comparison function f. Example:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true"></a>(<span class="kw">sort</span> <span class="kw">&lt;</span> &#39;(<span class="dv">5</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">63</span> <span class="dv">33</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">8</span>))</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">33</span> <span class="dv">63</span>)</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true"></a></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true"></a>(<span class="kw">sort</span> <span class="kw">&gt;</span> &#39;(<span class="dv">5</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">63</span> <span class="dv">33</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">8</span>))</span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">63</span> <span class="dv">33</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">1</span>)</span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true"></a></span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true"></a><span class="co">; Split sentence to words and sort them in ascending order</span></span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true"></a>(<span class="kw">sort</span> str-cmp-asc (str-split <span class="st">&quot;this is a string&quot;</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="st">&quot;a&quot;</span> <span class="st">&quot;is&quot;</span> <span class="st">&quot;string&quot;</span> <span class="st">&quot;this&quot;</span>)</span></code></pre></div>
<p>Note: Sort is quite slow the way it is implemented now. If sorting becomes a bottleneck in your application you can open an issue on github and hopefully someone will look into that and make a fast implementation. <strong>Update</strong>: Since firmware 6.05 sort is a built-in function that uses the merge sort algorithm. That makes it fast and it works well on large lists.</p>
<hr />
<h3 id="string-manipulation">String Manipulation</h3>
<hr />
<h4 id="str-from-n">str-from-n</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb331"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true"></a>(str-from-n n optFormat)</span></code></pre></div>
<p>Create a string from the number n. Also takes an optional format argument optFormat that works in the same way as the printf-function in C. The optFormat argument can also be used together with other characters as long as the resulting output string is shorter than 100 characters. Example:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true"></a>(str-from-n <span class="dv">10</span>)</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;10&quot;</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true"></a></span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true"></a>(str-from-n <span class="fl">2.5</span>)</span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;2.500000&quot;</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true"></a></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true"></a>(str-from-n <span class="fl">2.5</span> <span class="st">&quot;%.1f&quot;</span>)</span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;2.5&quot;</span></span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true"></a></span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true"></a>(str-from-n <span class="dv">10</span> <span class="st">&quot;0x%04X&quot;</span>) <span class="co">; Here we also append 0x in front of optFormat</span></span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;0x000A&quot;</span></span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true"></a></span>
<span id="cb332-13"><a href="#cb332-13" aria-hidden="true"></a>(str-from-n <span class="fl">0.023e3</span>)</span>
<span id="cb332-14"><a href="#cb332-14" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;2.500000&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-join">str-join</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb333"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true"></a>(str-join strings opt-delim)</span></code></pre></div>
<p>Joins a list of strings into one, with an optional delimeter string placed between each.</p>
<p>Note: Passing in an empty list returns <code>""</code>.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true"></a>(str-join &#39;(<span class="st">&quot;a&quot;</span> <span class="st">&quot;b&quot;</span> <span class="st">&quot;c&quot;</span>))</span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;abc&quot;</span></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true"></a></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true"></a>(str-join &#39;(<span class="st">&quot;I&quot;</span> <span class="st">&quot;love&quot;</span> <span class="st">&quot;lispbm!&quot;</span>) <span class="st">&quot; &quot;</span>)</span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;I love lispbm!&quot;</span></span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true"></a></span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true"></a>(str-join &#39;() <span class="st">&quot; &quot;</span>)</span>
<span id="cb334-8"><a href="#cb334-8" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-merge">str-merge</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb335"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true"></a>(str-merge str1 str2 ...)</span></code></pre></div>
<p>Merge a number of strings into one. Example:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true"></a>(str-merge <span class="st">&quot;A&quot;</span> <span class="st">&quot;bC&quot;</span> <span class="st">&quot;D&quot;</span>)</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;AbCD&quot;</span></span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true"></a></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true"></a>(str-merge <span class="st">&quot;Num1: &quot;</span> (str-from-n <span class="dv">10</span>) <span class="st">&quot; Num2: &quot;</span> (str-from-n <span class="fl">2.1</span> <span class="st">&quot;%.1f&quot;</span>))</span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;Num1: 10 Num2: 2.1&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-to-i">str-to-i</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb337"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true"></a>(str-to-i <span class="kw">str</span> optBase)</span></code></pre></div>
<p>Convert string to integer. By default the base is chosen automatically, but it can also be specified. Example:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true"></a>(str-to-i <span class="st">&quot;123&quot;</span>)</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true"></a><span class="kw">&gt;</span> {<span class="dv">123</span>}</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true"></a></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true"></a>(str-to-i <span class="st">&quot;a&quot;</span> <span class="dv">16</span>)</span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true"></a><span class="kw">&gt;</span> {<span class="dv">10</span>}</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true"></a></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true"></a>(str-to-i <span class="st">&quot;0xa&quot;</span>) <span class="co">; Automatic base16 if str starts with 0x</span></span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true"></a><span class="kw">&gt;</span> {<span class="dv">10</span>}</span></code></pre></div>
<hr />
<h4 id="str-to-f">str-to-f</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb339"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true"></a>(str-to-f <span class="kw">str</span>)</span></code></pre></div>
<p>Convert string to floating point number. Example:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true"></a>(str-to-f <span class="st">&quot;2.5&quot;</span>)</span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true"></a><span class="kw">&gt;</span> {<span class="fl">2.500000</span>}</span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true"></a></span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true"></a><span class="co">; Also supports scientific notation</span></span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true"></a>(str-to-f <span class="st">&quot;0.0025e3&quot;</span>)</span>
<span id="cb340-6"><a href="#cb340-6" aria-hidden="true"></a><span class="kw">&gt;</span> {<span class="fl">2.500000</span>}</span></code></pre></div>
<hr />
<h4 id="str-part">str-part</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb341"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true"></a>(str-part <span class="kw">str</span> start optN)</span></code></pre></div>
<p>Take part of string str starting at start for optN characters. If optN is omitted the rest of str will be taken. Example:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true"></a>(str-part <span class="st">&quot;Hello World!&quot;</span> <span class="dv">6</span>)</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;World!&quot;</span></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true"></a></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true"></a>(str-part <span class="st">&quot;Hello World!&quot;</span> <span class="dv">6</span> <span class="dv">2</span>)</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;Wo&quot;</span></span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true"></a></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true"></a>(str-part <span class="st">&quot;Hello World!&quot;</span> <span class="dv">0</span> <span class="dv">2</span>)</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;He&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-split">str-split</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb343"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true"></a>(str-split <span class="kw">str</span> delim)</span></code></pre></div>
<p>Split string str into tokens using delimiter delim. If delim is a number str will be split into tokens the size of that number. Example:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true"></a>(str-split <span class="st">&quot;This is a test&quot;</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="st">&quot;This&quot;</span> <span class="st">&quot;is&quot;</span> <span class="st">&quot;a&quot;</span> <span class="st">&quot;test&quot;</span>)</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true"></a></span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true"></a>(str-split <span class="st">&quot;this_o_is_o_a_o_test&quot;</span> <span class="st">&quot;_o_&quot;</span>)</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="st">&quot;This&quot;</span> <span class="st">&quot;is&quot;</span> <span class="st">&quot;a&quot;</span> <span class="st">&quot;test&quot;</span>)</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true"></a></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true"></a>(str-split <span class="st">&quot;This is a test&quot;</span> <span class="dv">3</span>)</span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="st">&quot;Thi&quot;</span> <span class="st">&quot;s i&quot;</span> <span class="st">&quot;s a&quot;</span> <span class="st">&quot; te&quot;</span> <span class="st">&quot;st&quot;</span>)</span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true"></a></span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true"></a>(str-split <span class="st">&quot;This is a test&quot;</span> <span class="dv">1</span>)</span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="st">&quot;T&quot;</span> <span class="st">&quot;h&quot;</span> <span class="st">&quot;i&quot;</span> <span class="st">&quot;s&quot;</span> <span class="st">&quot; &quot;</span> <span class="st">&quot;i&quot;</span> <span class="st">&quot;s&quot;</span> <span class="st">&quot; &quot;</span> <span class="st">&quot;a&quot;</span> <span class="st">&quot; &quot;</span> <span class="st">&quot;t&quot;</span> <span class="st">&quot;e&quot;</span> <span class="st">&quot;s&quot;</span> <span class="st">&quot;t&quot;</span>)</span></code></pre></div>
<hr />
<h4 id="str-replace">str-replace</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb345"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true"></a>(str-replace <span class="kw">str</span> rep optWith)</span></code></pre></div>
<p>Replace every occurrence of rep in str with optWith. If optWith is omitted every rep will be removed. Example:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true"></a>(str-replace <span class="st">&quot;Hello World!&quot;</span> <span class="st">&quot;World&quot;</span> <span class="st">&quot;LispBM&quot;</span>)</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;Hello LispBM!&quot;</span></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true"></a></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true"></a>(str-replace <span class="st">&quot;Hello World!&quot;</span> <span class="st">&quot; World&quot;</span>)</span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;Hello!&quot;</span></span></code></pre></div>
<hr />
<h3 id="str-replicate">str-replicate</h3>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb347"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true"></a>(str-replicate n <span class="kw">char</span>)</span></code></pre></div>
<p>Build a string by replicating char n times.</p>
<p>Example:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true"></a>(str-replicate <span class="dv">8</span> <span class="at">\#</span>x)</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;xxxxxxxx&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-to-upper">str-to-upper</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb349"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true"></a>(str-to-upper <span class="kw">str</span>)</span></code></pre></div>
<p>Convert string str to upper case. Example:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true"></a>(str-to-upper <span class="st">&quot;TesTt&quot;</span>)</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;TESTT&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-to-lower">str-to-lower</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb351"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true"></a>(str-to-lower <span class="kw">str</span>)</span></code></pre></div>
<p>Convert string str to lower case. Example:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true"></a>(str-to-lower <span class="st">&quot;TesTt&quot;</span>)</span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;testt&quot;</span></span></code></pre></div>
<hr />
<h4 id="str-cmp">str-cmp</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb353"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true"></a>(str-cmp str1 str1 optN)</span></code></pre></div>
<p>Compare strings str1 and str2. Works in the same way as the strcmp-function in C, meaning that equal strings return 0 and different strings return their difference according how they would be sorted.</p>
<p>The optional argument optN can be used to specify how many characters to compare (like strncmp in C). If it is left out all characters will be compared.</p>
<p>Example:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true"></a>(str-cmp <span class="st">&quot;Hello&quot;</span> <span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">0</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true"></a></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true"></a>(str-cmp <span class="st">&quot;Hello&quot;</span> <span class="st">&quot;World&quot;</span>)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">-15</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true"></a></span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true"></a>(str-cmp <span class="st">&quot;World&quot;</span> <span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">15</span></span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true"></a></span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true"></a>(str-cmp <span class="st">&quot;ab&quot;</span> <span class="st">&quot;abcd&quot;</span> <span class="dv">2</span>) <span class="co">; Compare only the first two characters</span></span>
<span id="cb354-11"><a href="#cb354-11" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">0</span></span></code></pre></div>
<hr />
<h4 id="str-cmp-asc">str-cmp-asc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb355"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true"></a>(str-cmp-asc str1 str1)</span></code></pre></div>
<p>Return true if str1 comes before str2, nil otherwise. Useful for sorting strings using the <a href="#sort">sort</a> function in ascending order.</p>
<hr />
<h4 id="str-cmp-dsc">str-cmp-dsc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb356"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true"></a>(str-cmp-dsc str1 str1)</span></code></pre></div>
<p>Return true if str2 comes before str1, nil otherwise. Useful for sorting strings using the <a href="#sort">sort</a> function in descending order.</p>
<hr />
<h4 id="str-len">str-len</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb357"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true"></a>(str-len <span class="kw">str</span>)</span></code></pre></div>
<p>Calculate length of string str excluding the null termination. Example:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true"></a>(str-len <span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">5</span></span></code></pre></div>
<hr />
<h4 id="str-find">str-find</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb359"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true"></a>(str-find <span class="kw">str</span> substr [start] [occurrence] [direction])</span></code></pre></div>
<p>Finds the index of the first character of a substring <code>substr</code> in the string <code>str</code>, returning this index, or <code>-1</code> if it doesn't exist. <code>substr</code> can also be a list of strings, in which case a certain positon only needs to be equal to one of these substrings to be considered a match. If this list is empty, <code>-1</code> is always returned, and searching for an empty string returns the starting index.</p>
<p><strong>Optional arguments:</strong></p>
<ul>
<li><code>start</code>: Overrides which index the search starts at. May be negative, in which case it specifies which index to start at from the end, with <code>-1</code> resulting in starting at the last character of the string (See one of the examples below). Defaults to 0 if searching to the right, otherwise to the end of the string minus the length of <code>substr</code> if searching to the left. If it helps, the formula is then <code>(- (+ (str-len str) 1) (str-len substr))</code>, if <code>substr</code> is a list, the shortest string length is used.</li>
<li><code>occurrence</code>: When given, this specifies how many matches to skip before an index is returned, otherwise the index of the first is returned by default.</li>
<li><code>direction</code>: The direction to perform the search in. One of the symbols <code>left</code> or <code>right</code>. Defaults to <code>right</code>, starting from the first character. Can be passed in an earlier position if <code>occurrence</code> and/or <code>start</code> are left out.</li>
</ul>
<p>It is valid if the resulting start index is outside the range of <code>str</code> (i.e. being smaller than 0 or larger than the size of <code>str</code>), in which case the expected behaviour is performed by either immediatly returning no match (<code>-1</code>) or skipping the index forward to the first potentially valid match (depending on the direction).</p>
<p><strong>Note about byte arrays</strong><br />
<code>str</code> is actually considered to be a byte array, meaning that the final terminating null byte is considered when searching. The final byte of <code>substr</code> is on the other hand removed before it is searched for. If you want to search for an abitrary byte sequence you must first increase the size of <code>substr</code> by one, for instance with <code>(buf-resize substr 1 'copy)</code>. Note however that since specifying <code>start</code> to be <code>-1</code> starts the search at the last character (which is the second to last byte in a null-terminated string), <strong>it is impossible to specify that the search should start at the last byte</strong>! (If you need that functionality, you'll unfortunately need to implement that yourself and only specify positive values for <code>start</code>.)<br />
This function actually replaces <code>buf-find</code> which existed in earlier versions of v6.05. This version is almost backwards compatible, so you should be able to just search and replace <code>buf-find</code> with <code>str-find</code> for most cases. The only change is that the third argument <code>occurrence</code> has been moved to the fourth position (with <code>start</code> taking the third). So you'll need to replace <code>(buf-find buf seq x)</code> with <code>(str-find buf seq 0 x)</code> in this case.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true"></a>(str-find <span class="st">&quot;-str-&quot;</span> <span class="st">&quot;str&quot;</span>)</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">1</span></span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true"></a></span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true"></a>(str-find <span class="st">&quot;-str-str-&quot;</span> <span class="st">&quot;str&quot;</span> <span class="dv">0</span> <span class="dv">1</span>)</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">5</span></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true"></a></span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true"></a>(str-find <span class="st">&quot;-str-str-&quot;</span> <span class="st">&quot;str&quot;</span> <span class="dv">2</span>)</span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">5</span></span>
<span id="cb360-9"><a href="#cb360-9" aria-hidden="true"></a></span>
<span id="cb360-10"><a href="#cb360-10" aria-hidden="true"></a>(str-find <span class="st">&quot;-str-str-&quot;</span> <span class="st">&quot;str&quot;</span> <span class="at">&#39;left</span>)</span>
<span id="cb360-11"><a href="#cb360-11" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">5</span></span>
<span id="cb360-12"><a href="#cb360-12" aria-hidden="true"></a></span>
<span id="cb360-13"><a href="#cb360-13" aria-hidden="true"></a>(str-find <span class="st">&quot;-ab-ab-&quot;</span> <span class="st">&quot;ab&quot;</span> <span class="dv">5</span> <span class="at">&#39;left</span>)</span>
<span id="cb360-14"><a href="#cb360-14" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">4</span></span>
<span id="cb360-15"><a href="#cb360-15" aria-hidden="true"></a></span>
<span id="cb360-16"><a href="#cb360-16" aria-hidden="true"></a>(str-find <span class="st">&quot;-ab-ba-&quot;</span> &#39;(<span class="st">&quot;ba&quot;</span> <span class="st">&quot;ab&quot;</span>) <span class="dv">0</span> <span class="dv">1</span>)</span>
<span id="cb360-17"><a href="#cb360-17" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">4</span></span>
<span id="cb360-18"><a href="#cb360-18" aria-hidden="true"></a></span>
<span id="cb360-19"><a href="#cb360-19" aria-hidden="true"></a>(str-find <span class="st">&quot;a--a&quot;</span> <span class="st">&quot;a&quot;</span> <span class="dv">-1</span> <span class="at">&#39;left</span>)</span>
<span id="cb360-20"><a href="#cb360-20" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="dv">3</span></span></code></pre></div>
<hr />
<h4 id="to-str">to-str</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb361"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true"></a>(to-str arg1 ... argN)</span></code></pre></div>
<p>Convert LBM-types to their string representation and return that string. Example:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true"></a>(to-str &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>))</span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;(1 2 3)&quot;</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true"></a></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true"></a>(to-str <span class="st">&quot;aAa&quot;</span> <span class="dv">4</span> &#39;(a <span class="dv">2</span> <span class="dv">3</span>) <span class="dv">2</span> <span class="dv">3</span> <span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;aAa 4 (a 2 3) 2 3 Hello&quot;</span></span></code></pre></div>
<hr />
<h4 id="to-str-delim">to-str-delim</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb363"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true"></a>(to-str-delim delimiter arg1 ... argN)</span></code></pre></div>
<p>Same as <a href="#to-str">to-str</a>, but with a custom delimiter. Example:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true"></a>(to-str-delim <span class="st">&quot;::&quot;</span> <span class="st">&quot;aAa&quot;</span> <span class="dv">4</span> &#39;(a <span class="dv">2</span> <span class="dv">3</span>) <span class="dv">2</span> <span class="dv">3</span> <span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;aAa::4::(a 2 3)::2::3::Hello&quot;</span></span></code></pre></div>
<hr />
<h2 id="events">Events</h2>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Events can be used to execute code for certain events, such as when CAN-frames are received. To use events you must first register an event handler, then enable the events you want to receive. As the event handler blocks until the event arrives it is useful to spawn a thread to handle events so that other things can be done in the main thread at the same time.</p>
<p>The following example shows how to spawn a thread that handles SID (standard-id) CAN-frames and custom app data:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true"></a>(defun proc-sid (id data)</span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true"></a>    (<span class="kw">print</span> (<span class="kw">list</span> id data))</span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true"></a>)</span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true"></a></span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true"></a>(defun proc-data (data)</span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true"></a>    (<span class="kw">print</span> data)</span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true"></a>)</span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true"></a></span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true"></a>(defun event-handler ()</span>
<span id="cb365-10"><a href="#cb365-10" aria-hidden="true"></a>    (loopwhile t</span>
<span id="cb365-11"><a href="#cb365-11" aria-hidden="true"></a>        (recv</span>
<span id="cb365-12"><a href="#cb365-12" aria-hidden="true"></a>            ((event-can-sid . ((? id) . (? data))) (proc-sid id data))</span>
<span id="cb365-13"><a href="#cb365-13" aria-hidden="true"></a>            ((event-data-rx . (? data)) (proc-data data))</span>
<span id="cb365-14"><a href="#cb365-14" aria-hidden="true"></a>            (_ <span class="va">nil</span>) <span class="co">; Ignore other events</span></span>
<span id="cb365-15"><a href="#cb365-15" aria-hidden="true"></a>)))</span>
<span id="cb365-16"><a href="#cb365-16" aria-hidden="true"></a></span>
<span id="cb365-17"><a href="#cb365-17" aria-hidden="true"></a><span class="co">; Spawn the event handler thread and pass the ID it returns to C</span></span>
<span id="cb365-18"><a href="#cb365-18" aria-hidden="true"></a>(event-register-handler (spawn event-handler))</span>
<span id="cb365-19"><a href="#cb365-19" aria-hidden="true"></a></span>
<span id="cb365-20"><a href="#cb365-20" aria-hidden="true"></a><span class="co">; Enable the CAN event for standard ID (SID) frames</span></span>
<span id="cb365-21"><a href="#cb365-21" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-can-sid</span>)</span>
<span id="cb365-22"><a href="#cb365-22" aria-hidden="true"></a></span>
<span id="cb365-23"><a href="#cb365-23" aria-hidden="true"></a><span class="co">; Enable the custom app data event</span></span>
<span id="cb365-24"><a href="#cb365-24" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-data-rx</span>)</span></code></pre></div>
<p>Possible events to register are</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true"></a><span class="co">; ESC and Express</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-can-sid</span>)  <span class="co">; -&gt; (event-can-sid . (id . data)), where id is U32 and data is a byte array</span></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-can-eid</span>)  <span class="co">; -&gt; (event-can-eid . (id . data)), where id is U32 and data is a byte array</span></span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-data-rx</span>)  <span class="co">; -&gt; (event-data-rx . data), where data is a byte array</span></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-cmds-data-tx</span>)  <span class="co">; -&gt; (event-cmds-data-tx data), where data is a byte array</span></span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true"></a></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true"></a><span class="co">; ESC Only</span></span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-shutdown</span>) <span class="co">; -&gt; event-shutdown</span></span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-icu-width</span>) <span class="co">; -&gt; (event-icu-width . (width . period))</span></span>
<span id="cb366-10"><a href="#cb366-10" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-icu-period</span>) <span class="co">; -&gt; (event-icu-period . (width . period))</span></span>
<span id="cb366-11"><a href="#cb366-11" aria-hidden="true"></a></span>
<span id="cb366-12"><a href="#cb366-12" aria-hidden="true"></a><span class="co">; Express only</span></span>
<span id="cb366-13"><a href="#cb366-13" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-bms-chg-allow</span>) <span class="co">; -&gt; (event-bms-chg-allow allow)</span></span>
<span id="cb366-14"><a href="#cb366-14" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-bms-bal-ovr</span>) <span class="co">; -&gt; (event-bms-bal-ovr ch bal)</span></span>
<span id="cb366-15"><a href="#cb366-15" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-bms-reset-cnt</span>) <span class="co">; -&gt; event-bms-reset-cnt</span></span>
<span id="cb366-16"><a href="#cb366-16" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-bms-force-bal</span>) <span class="co">; -&gt; (event-bms-force-bal force)</span></span>
<span id="cb366-17"><a href="#cb366-17" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-bms-zero-ofs</span>) <span class="co">; -&gt; event-bms-zero-ofs</span></span>
<span id="cb366-18"><a href="#cb366-18" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-ble-rx</span>) <span class="co">; -&gt; (event-ble-rx handle data)</span></span>
<span id="cb366-19"><a href="#cb366-19" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-wifi-disconnect</span>) <span class="co">; -&gt; (&#39;event-wifi-disconnect reason from-extension)</span></span>
<span id="cb366-20"><a href="#cb366-20" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-esp-now-rx</span>) <span class="co">; -&gt; (event-esp-now-rx src des data rssi)</span></span></code></pre></div>
<p>The CAN-frames arrive whenever data is received on the CAN-bus and data-rx is received for example when data is sent from a Qml-script in VESC Tool.</p>
<h3 id="event-description">Event Description</h3>
<p><strong>event-can-sid</strong><br />
This event is sent when standard id CAN-frames are received.</p>
<p><strong>event-can-eid</strong><br />
This event is sent when extended id CAN-frames are received.</p>
<p><strong>event-data-rx</strong><br />
This event is sent when custom app data is sent from VESC Tool or other connected devices. This works using all communication ports including USB, UART and CAN-bus.</p>
<p><strong>event-cmds-data-tx</strong><br />
This event is sent when the commands interface has a response packet to send. See the commands chapter for more details.</p>
<p><strong>event-shutdown</strong><br />
This event is sent when the ESC is about to shut down. Note that this event currently only works on hardware with a power switch. If that is not the case you could try to, for example, monitor the input voltage and simulate this event when it drops below a set level.</p>
<p><strong>event-icu-width</strong><br />
This event is sent when the input capture unit captures a pulse. Both the pulse width and the period of the last pulse are provided.</p>
<p><strong>event-icu-period</strong><br />
This event is sent when the input capture unit ends a period and the next pulse starts. Both the pulse width and the period are provided.</p>
<p><strong>event-ble-rx</strong> (Express exclusive)<br />
This event is sent when a client connected to the Express writes a value to a characteristic or descriptor. Read the <a href="https://github.com/vedderb/vesc_express/tree/main/main/ble#events">BLE docs</a> for details.</p>
<p><strong>event-wifi-disconnect</strong> (Express exclusive)<br />
This event is sent when the Express disconnects from the currently connected network for any reason. Read the <a href="https://github.com/vedderb/vesc_express/tree/main/main/wifi#events">Wi-Fi docs</a> for details.</p>
<p><strong>event-esp-now-rx</strong><br />
This event is sent when ESP-NOW data is received.</p>
<hr />
<h4 id="event-enable">event-enable</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb367"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true"></a>(event-enable event optEn)</span></code></pre></div>
<p>Enable or disable event. The optional argument optEn can be set to 1 to enable the event or to 0 to disable it. If optEn is left out the event will be enabled.</p>
<hr />
<h2 id="byte-arrays">Byte Arrays</h2>
<p>Byte arrays (and text strings) are allocated in memory as consecutive arrays of bytes (not linked lists). They can be shared with C and are more space and performance efficient than linked lists. Several of the extensions also take byte arrays as input as an alternative to lists and some of the events return byte arrays.</p>
<p>To allocate a byte array with 20 bytes and bind the symbol <code>arr</code> to it you can use</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true"></a>(define arr (array-create <span class="dv">20</span>))</span></code></pre></div>
<hr />
<h4 id="buflen">buflen</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>The length of a byte array can be read with</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true"></a>(buflen arr)</span></code></pre></div>
<p>Which will return 20 for the array <code>arr</code> above.</p>
<hr />
<h4 id="bufclear">bufclear</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>To clear a byte array the function bufclear can be used:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true"></a>(bufclear arr optByte optStart optLen)</span></code></pre></div>
<p>Where <code>arr</code> is the byte array to clear, <code>optByte</code> is the optional argument of what to clear with (default 0), <code>optStart</code> is the optional argument of which position to start clearing (default 0) and <code>optLen</code> is the optional argument of how many bytes to clear after start (default the entire array). Example:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true"></a>(bufclear arr) <span class="co">; Clear all of arr</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true"></a>(bufclear arr <span class="bn">0xFF</span>) <span class="co">; Fill arr with 0xFF</span></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true"></a>(bufclear arr <span class="dv">0</span> <span class="dv">5</span>) <span class="co">; Clear from index 5 to the end</span></span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true"></a>(bufclear arr <span class="dv">0</span> <span class="dv">5</span> <span class="dv">10</span>) <span class="co">; Clear 10 bytes starting from index 5</span></span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true"></a>(bufclear arr <span class="bn">0xAA</span> <span class="dv">5</span> <span class="dv">10</span>) <span class="co">; Set 10 bytes to 0xAA starting from index 5</span></span></code></pre></div>
<hr />
<h4 id="bufget-x">bufget-[x]</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>To read data from the byte array you can use</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true"></a>(bufget-[x] arr <span class="kw">index</span>)</span></code></pre></div>
<p>Where [x] is i8, u8, i16, u16, i32, u32 or f32. Index is the position in the array to start reading from, starting at 0. Here are some examples</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true"></a>(bufget-i8 arr <span class="dv">0</span>) <span class="co">; read byte 0 as int8</span></span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true"></a>(bufget-i16 arr <span class="dv">0</span>) <span class="co">; read byte 0 and 1 as int16</span></span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true"></a>(bufget-i32 arr <span class="dv">0</span>) <span class="co">; read byte 0 to 3 as i32</span></span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true"></a>(bufget-u8 arr <span class="dv">0</span>) <span class="co">; read byte 0 as uint8</span></span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true"></a>(bufget-u16 arr <span class="dv">0</span>) <span class="co">; read byte 0 and 1 as uint16</span></span>
<span id="cb373-6"><a href="#cb373-6" aria-hidden="true"></a>(bufget-u24 arr <span class="dv">0</span>) <span class="co">; read byte 0, 1 and 2 as uint24</span></span>
<span id="cb373-7"><a href="#cb373-7" aria-hidden="true"></a>(bufget-u32 arr <span class="dv">0</span>) <span class="co">; read byte 0 to 3 as uint32</span></span>
<span id="cb373-8"><a href="#cb373-8" aria-hidden="true"></a>(bufget-f32 arr <span class="dv">0</span>) <span class="co">; read byte 0 to 3 as float32 (IEEE 754)</span></span></code></pre></div>
<p>By default the byte order is big endian. The byte order can also be specified as an extra argument. E.g. to read 4 bytes as int32 from position 6 in little endian you can use</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true"></a>(bufget-i32 arr <span class="dv">6</span> <span class="at">&#39;little-endian</span>)</span></code></pre></div>
<hr />
<h4 id="bufset-x">bufset-[x]</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Writing to the array can be done in a similar way</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true"></a>(bufset-[x] arr <span class="kw">index</span> value)</span></code></pre></div>
<p>Here are some examples</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true"></a>(bufset-i8 arr <span class="dv">0</span> <span class="dv">12</span>) <span class="co">; write 12 to byte 0 as int8</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true"></a>(bufset-i16 arr <span class="dv">0</span> <span class="dv">-5621</span>) <span class="co">; write -5621 to byte 0 and 1 as int16</span></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true"></a>(bufset-i32 arr <span class="dv">0</span> <span class="dv">2441</span>) <span class="co">; write 2441 to byte 0 to 3 as i32</span></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true"></a>(bufset-u8 arr <span class="dv">0</span> <span class="dv">12</span>) <span class="co">; write 12 to byte 0 as uint8</span></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true"></a>(bufset-u16 arr <span class="dv">0</span> <span class="dv">420</span>) <span class="co">; write 420 to byte 0 and 1 as uint16</span></span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true"></a>(bufset-u24 arr <span class="dv">0</span> <span class="dv">420</span>) <span class="co">; write 420 to byte 0, 1 and 2 as uint24</span></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true"></a>(bufset-u32 arr <span class="dv">0</span> <span class="dv">119</span>) <span class="co">; write 119 to byte 0 to 3 as uint32</span></span>
<span id="cb376-8"><a href="#cb376-8" aria-hidden="true"></a>(bufset-f32 arr <span class="dv">0</span> <span class="fl">3.14</span>) <span class="co">; write 3.14 to byte 0 to 3 as float32 (IEEE 754)</span></span>
<span id="cb376-9"><a href="#cb376-9" aria-hidden="true"></a>(bufset-bit arr <span class="dv">14</span> <span class="dv">1</span>) <span class="co">; Set bit 14 to 1 (note that this is a bitindex)</span></span></code></pre></div>
<p>As with bufget big endian is the default byte order and little-endian can be passed as the last argument to use little-endian byte order instead.</p>
<hr />
<h4 id="bufcpy">bufcpy</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Copy part of one array into another array.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true"></a>(bufcpy arr1 ind1 arr2 ind2 len)</span></code></pre></div>
<p>Copy len bytes from <code>arr2</code> starting at <code>ind2</code> to <code>arr1</code> starting at <code>ind1</code>. <code>len</code> will be truncated to ensure that nothing is read or written outside of the arrays.</p>
<hr />
<h4 id="free">free</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<p>Byte arrays will be de-allocated by the garbage collector on a regular basis, but can still use a lot of memory until then and large byte arrays cause a risk of running out of memory. It is possible to manually de-allocate the byte arrays when done with them by calling free</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true"></a>(free arr)</span></code></pre></div>
<p>This will clear the allocated memory for <code>arr</code>.</p>
<p><strong>Note:</strong><br />
Strings in lispBM are treated the same as byte arrays, so all of the above can be done to the characters in strings too.</p>
<hr />
<h4 id="buf-resize">buf-resize</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb379"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true"></a>(buf-resize arr delta-size opt-absolute-size opt-copy-symbol)</span></code></pre></div>
<p>Change the length of array <code>arr</code> in bytes. A reference to <code>arr</code> is returned. This extension can be used in two modes:</p>
<ol>
<li>Relative: In this mode you set <code>delta-size</code> to the amount of bytes the length should be changed by. Negative numbers makes the array smaller. <code>opt-absolute-size</code> should not be passed in this mode (it is therefore an optional argument).</li>
<li>Absolute: In this mode you set <code>delta-size</code> to be <code>nil</code> and set <code>opt-absolute-size</code> to the new length in bytes.</li>
</ol>
<p>Passing <code>nil</code> to <code>delta-size</code> while not passing any value for <code>opt-absolute-size</code> will result in an <code>eval_error</code>.</p>
<p>You can optionally pass the symbol <code>'copy</code> to <code>opt-copy-symbol</code> to specify that <code>arr</code> should be left unchanged and that a copy should instead be made. Don't worry about the exact position of the argument, the only important part is that <code>opt-copy-symbol</code> is last. So you can give a value for <code>opt-copy-symbol</code> even when <code>opt-absolute-size</code> isn't passed. You can also for completeness pass the symbol <code>'mut</code> to specify that the standard behaviour of modifying <code>arr</code> in place should remain in effect.</p>
<p>When growing the length of the array a new range will be allocated and the old data copied over. The new bytes will be initialised to zero. If the new length of the array is smaller than the previous the allocated range will simply be marked as smaller in an efficient manner which avoids any new allocations.</p>
<p>It is possible to shrink an array to a length of zero.</p>
<p><strong>Note:</strong><br />
The array will be resized in place. The returned reference to <code>arr</code> is just for convenience. (Unless <code>opt-copy-symbol</code> is <code>'copy</code> of course.)</p>
<p>Example where we remove the terminating null byte from a string buffer:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true"></a>(buf-resize <span class="st">&quot;hello&quot;</span> <span class="dv">-1</span>)</span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">104</span> <span class="dv">101</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">111</span>]</span></code></pre></div>
<p>Example where we increase the length of <code>buf</code> to 5:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> buf </span>[<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span>])</span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true"></a>(buf-resize buf <span class="va">nil</span> <span class="dv">5</span>)</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true"></a>(bufset-u8 buf <span class="dv">4</span> <span class="dv">5</span>) <span class="co">; we set it to avoid LBM printing the array as a string</span></span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true"></a>(<span class="kw">print</span> buf)</span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span>]</span></code></pre></div>
<p>Example where we create a copy of <code>name</code> with the terminating null byte removed.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> name </span><span class="st">&quot;name&quot;</span>)</span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> name-array </span>(buf-resize <span class="kw">name</span> <span class="dv">-1</span> <span class="at">&#39;copy</span>))</span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true"></a></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true"></a>(<span class="kw">print</span> <span class="kw">name</span>)</span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true"></a><span class="kw">&gt;</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true"></a>(<span class="kw">print</span> name-array)</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">110</span> <span class="dv">97</span> <span class="dv">109</span> <span class="dv">101</span>]</span></code></pre></div>
<hr />
<h2 id="import-files">Import Files</h2>
<p>Import is a special command that is mostly handled by VESC Tool. When VESC Tool sees a line that imports a file it will open and read that file and attach it as binary data to the end of the uploaded code. VESC Tool also generates a table of the imported files that will be allocated as arrays and passed to LispBM at start and bound to bindings.</p>
<p>Every imported file behaves as a byte array that is read-only (so do not try to modify it). These byte arrays can be used as usual from the lisp code to, for example, load native libraries or to load more lisp code at runtime. As they are stored in flash in raw binary format there is significantly more space available than when using e.g. the array syntax. The lisp script and the imported files can use up to 120 KB together.</p>
<hr />
<h4 id="import">import</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb383"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true"></a>(<span class="kw">import</span> filename <span class="kw">binding</span>)</span></code></pre></div>
<p>Load filename as a byte array and bind it to binding. Note that import must be on its own line and that every line can only have one import.</p>
<p><strong>Example: Load native library</strong></p>
<div class="sourceCode" id="cb384"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;ws2812.bin&quot;</span> <span class="at">&#39;ws2812</span>) <span class="co">; Import the native ws2812 library. This creates the byte array ws2812 that can be used usual.</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true"></a>(load-native-lib ws2812)<span class="co">; Load it to get the extensions it provides </span></span></code></pre></div>
<hr />
<h3 id="import-paths">Import Paths</h3>
<p>Paths for import can be relative or absolute. Absolute paths are always looked up from the root of the file system, but relative paths need to be resolved. If the lisp-file is saved (e.g. there is a path at the bottom of the editor) paths are looked up relative to the location of that lisp file. If they are not found there they are looked up relative to the location where VESC Tool is started. If the file never has been saved (e.g. you just opened a new tab and started typing) the file path is unknown until save as is used, so only the path relative to VESC Tool is looked up then.</p>
<hr />
<h3 id="special-paths">Special Paths</h3>
<p>It is also possible to import files from <a href="https://github.com/vedderb/vesc_pkg">VESC Packages</a> using a special path syntax. If you want to import the lisp-file from a VESC Package you can use the format</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;pkg@path/to/package.vescpkg&quot;</span> <span class="at">&#39;import-name</span>)</span></code></pre></div>
<p>This will import the lisp-file from that VESC Package. It is also possible to import the imports from a lisp-file in a VESC Package. This is a bit confusing as the package itself does not contain the paths anymore, so instead of referring to the path you have to refer to the label. Here is an example of that:</p>
<p>Suppose you have a VESC Package that has a lisp-file that imports a file like this:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;c_lib/ws2812/ws2812.bin&quot;</span> <span class="at">&#39;ws2812</span>)</span></code></pre></div>
<p>To import the file that is imported as ws2812 in the lisp-file of that vesc package you can use</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;pkg::ws2812@path/to/package.vescpkg&quot;</span> <span class="at">&#39;ws2812</span>)</span></code></pre></div>
<p>This means import the import ws2812 from the lisp file in the VESC Package located at path/to/package.vescpkg.</p>
<h3 id="import-official-vesc-packages">Import Official VESC Packages</h3>
<p>There is a <a href="https://github.com/vedderb/vesc_pkg">github repository</a> where official VESC Packages are located. All of the lisp-files and their imports from the packages in this repository can be imported using the special base path <strong>://vesc_packages</strong>. For example, to import the ws2812 import from lib_ws2812 the following import can be used:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;pkg::ws2812@://vesc_packages/lib_ws2812/ws2812.vescpkg&quot;</span> <span class="at">&#39;ws2812</span>)</span></code></pre></div>
<p>This should work for all VESC Packages in that repository. Most examples there use this pattern.</p>
<p><strong>NOTE:</strong> The path above does not download the repository on demand, but relies on the cached local version. This cached version is not updated automatically, so you have to run the update manually when you want to get the latest version of the repository. To update the cache you can use the <strong>Update Archive</strong>-button from the VESC Packages-page in VESC Tool.</p>
<hr />
<h2 id="native-libraries">Native Libraries</h2>
<p>Native libraries can be used when more performance is needed. They can be created by compiling position-independent C code and loaded/unloaded with the functions below. More care has to be taken when developing native libraries as they have far less sandboxing than lispBM-code, so access to a SWD-programmer is recommended while developing them.</p>
<p>Up to 10 native libraries can be loaded simultaneously and the recommended way to configure and interact with them is by providing LispBM-extensions from them.</p>
<p>Currently the documentation for native libraries is limited, but there are some examples <a href="c_libs/examples">in this diretory</a>. The interface that can be used in native libraries can be found <a href="c_libs/vesc_c_if.h">in this file</a>.</p>
<h3 id="features">Features</h3>
<p>Native libraries get a list of function pointers that can be used to interact with the rest of the VESC code. The following features are currently supported:</p>
<ul>
<li>Register LispBM-extensions.</li>
<li>Os-functions like sleep, print, malloc, free, system time.</li>
<li>Create one or more threads.</li>
<li>GPIO-control (ST and abstract).</li>
<li>The ST standard peripheral library can be used.</li>
<li>Send and receive CAN-frames and control other VESCs over CAN-bus.</li>
<li>Motor control using almost everything from mc_interface.</li>
</ul>
<h3 id="cleanup">Cleanup</h3>
<p>Every time lispBM is restarted or when new code is uploaded the native libraries are closed and reloaded, so it is important to do proper cleanup in lib_info-&gt;stop_fun when resources such as threads are allocated.</p>
<hr />
<h4 id="load-native-lib">load-native-lib</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb389"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true"></a>(load-native-lib lib)</span></code></pre></div>
<p>Load the native library lib. lib is a byte array with the compiled binary that is created after running make on the native library.</p>
<hr />
<h4 id="unload-native-lib">unload-native-lib</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb390"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true"></a>(unload-native-lib lib)</span></code></pre></div>
<p>Unload the native library lib. This is done automatically when lispBM is stopped or restarted, so there is no need to do it explicitly. This function is provided in case native libraries need to be explicitly loaded and unloaded while the same program is running.</p>
<hr />
<h3 id="native-library-example">Native Library Example</h3>
<p>This example creates an extension called ext-test that takes a number as an argument and returns the number multiplied by 3. The code for it can be found <a href="c_libs/examples/extension">in this diretory</a>.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true"></a><span class="co">; When running make in the example directory a file called example.lisp</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true"></a><span class="co">; with this array is created.</span></span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true"></a></span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> example </span>[</span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true"></a><span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x08</span> <span class="bn">0xb5</span> <span class="bn">0x07</span> <span class="bn">0x4b</span> <span class="bn">0x07</span> <span class="bn">0x49</span> <span class="bn">0x08</span> <span class="bn">0x48</span> <span class="bn">0x7b</span> <span class="bn">0x44</span> <span class="bn">0x79</span> <span class="bn">0x44</span> <span class="bn">0x1b</span> <span class="bn">0x68</span> <span class="bn">0x03</span> <span class="bn">0x4b</span></span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true"></a><span class="bn">0x78</span> <span class="bn">0x44</span> <span class="bn">0x1b</span> <span class="bn">0x68</span> <span class="bn">0x98</span> <span class="bn">0x47</span> <span class="bn">0x01</span> <span class="bn">0x20</span> <span class="bn">0x08</span> <span class="bn">0xbd</span> <span class="bn">0x00</span> <span class="bn">0xbf</span> <span class="bn">0x00</span> <span class="bn">0xf8</span> <span class="bn">0x00</span> <span class="bn">0x10</span> <span class="bn">0xf0</span> <span class="bn">0xff</span> <span class="bn">0xff</span> <span class="bn">0xff</span></span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true"></a><span class="bn">0x2b</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x18</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x65</span> <span class="bn">0x78</span> <span class="bn">0x74</span> <span class="bn">0x2d</span> <span class="bn">0x74</span> <span class="bn">0x65</span> <span class="bn">0x73</span> <span class="bn">0x74</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x00</span> <span class="bn">0x00</span></span>
<span id="cb391-8"><a href="#cb391-8" aria-hidden="true"></a><span class="bn">0x01</span> <span class="bn">0x29</span> <span class="bn">0x70</span> <span class="bn">0xb5</span> <span class="bn">0x05</span> <span class="bn">0x46</span> <span class="bn">0x09</span> <span class="bn">0x4c</span> <span class="bn">0x0d</span> <span class="bn">0xd1</span> <span class="bn">0xe3</span> <span class="bn">0x6f</span> <span class="bn">0x00</span> <span class="bn">0x68</span> <span class="bn">0x98</span> <span class="bn">0x47</span> <span class="bn">0x48</span> <span class="bn">0xb1</span> <span class="bn">0x63</span> <span class="bn">0x6e</span></span>
<span id="cb391-9"><a href="#cb391-9" aria-hidden="true"></a><span class="bn">0x28</span> <span class="bn">0x68</span> <span class="bn">0x26</span> <span class="bn">0x6c</span> <span class="bn">0x98</span> <span class="bn">0x47</span> <span class="bn">0x33</span> <span class="bn">0x46</span> <span class="bn">0x00</span> <span class="bn">0xeb</span> <span class="bn">0x40</span> <span class="bn">0x00</span> <span class="bn">0xbd</span> <span class="bn">0xe8</span> <span class="bn">0x70</span> <span class="bn">0x40</span> <span class="bn">0x18</span> <span class="bn">0x47</span> <span class="bn">0xd4</span> <span class="bn">0xf8</span></span>
<span id="cb391-10"><a href="#cb391-10" aria-hidden="true"></a><span class="bn">0x94</span> <span class="bn">0x00</span> <span class="bn">0x70</span> <span class="bn">0xbd</span> <span class="bn">0x00</span> <span class="bn">0xf8</span> <span class="bn">0x00</span> <span class="bn">0x10</span></span>
<span id="cb391-11"><a href="#cb391-11" aria-hidden="true"></a>])</span>
<span id="cb391-12"><a href="#cb391-12" aria-hidden="true"></a></span>
<span id="cb391-13"><a href="#cb391-13" aria-hidden="true"></a><span class="co">; The array can be loaded like this</span></span>
<span id="cb391-14"><a href="#cb391-14" aria-hidden="true"></a></span>
<span id="cb391-15"><a href="#cb391-15" aria-hidden="true"></a>(load-native-lib example)</span>
<span id="cb391-16"><a href="#cb391-16" aria-hidden="true"></a></span>
<span id="cb391-17"><a href="#cb391-17" aria-hidden="true"></a><span class="co">; Now an extension called ext-test is available. Here we use it</span></span>
<span id="cb391-18"><a href="#cb391-18" aria-hidden="true"></a><span class="co">; with the argument 4 and print the result</span></span>
<span id="cb391-19"><a href="#cb391-19" aria-hidden="true"></a></span>
<span id="cb391-20"><a href="#cb391-20" aria-hidden="true"></a>(<span class="kw">print</span> (ext-test <span class="dv">4</span>)) <span class="co">; Should print 12</span></span></code></pre></div>
<hr />
<h2 id="uavcan">UAVCAN</h2>
<hr />
<h4 id="uavcan-last-rawcmd">uavcan-last-rawcmd</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb392"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true"></a>(uavcan-last-rawcmd canInterface)</span></code></pre></div>
<p>Get the last raw uavcan-command and its age. Returns a list where the first element is the value and the second element is the age. canInterface is the interface, which can be 1 or 2. Interface 2 is only valid if the hardware has dual CAN-buses. Example:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true"></a>(<span class="kw">print</span> (ix (uavcan-last-rawcmd <span class="dv">1</span>) <span class="dv">0</span>)) <span class="co">; Print the value</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true"></a>(<span class="kw">print</span> (ix (uavcan-last-rawcmd <span class="dv">1</span>) <span class="dv">1</span>)) <span class="co">; Print the age in seconds</span></span></code></pre></div>
<hr />
<h4 id="uavcan-last-rpmcmd">uavcan-last-rpmcmd</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb394"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true"></a>(uavcan-last-rpmcmd canInterface)</span></code></pre></div>
<p>Same as uavcan-last-rawcmd, but for the last rpm-command.</p>
<hr />
<h2 id="lispbm">LispBM</h2>
<hr />
<h4 id="lbm-set-quota">lbm-set-quota</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb395"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true"></a>(lbm-set-quota quota-us)</span></code></pre></div>
<p>Set how many microseconds to run each thread between context switches. Default is 2000. A lower value will alter between threads more often, reducing latency between context switches at the cost of overall performance. The default value of 2000 has relatively low performance overhead.</p>
<p>Lowering this value is useful if there are one or more timing-critical threads (that e.g. read encoders) that cannot wait too long between iterations.</p>
<hr />
<h4 id="lbm-set-gc-stack-size">lbm-set-gc-stack-size</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb396"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true"></a>(lbm-set-gc-stack-size new-size)</span></code></pre></div>
<p>Change the stack size for the garbage collector. If the GC stack is too small the program can crash during garbage collection and print a message stating that it ran out of GC stack. If that happens increasing the size from the default of 160 can help. Note that the GC stack is on LBM memory and increasing its size leaves less memory available for other things.</p>
<hr />
<h4 id="image-save">image-save</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb397"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true"></a>(image-save)</span></code></pre></div>
<p>Save everything in the global environment in an image. Returns true on success and nil on failure. This function can fail if defrag memory pools are present in the global environment as these cannot be flattened. Instead, they should be created in the main-function of the program. This function will also fail if a main-function is missing.</p>
<p>After calling image-save, the next time lbm is started (such as at the next boot) the environment at the point where image-save was called will be re-created and the main-function will be called. This bypasses the reader on the next boot, which speeds up the boot-time greatly (on large programs from several seconds to a few milliseconds). It also makes it much easier to use const-blocks as one does not have to take care for the reader to always create everything in the same order.</p>
<p>One has to take care to move everything that alters the external state of the hardware, such as initializing drivers and io-pins, into the main-function as this state won't be restored when loading the image. This might sound strange in this context, but keep in mind that it is what you always do when writing regular C-programs on embedded hardware - when you enter main you initialize everything and start your threads and main loop.</p>
<p>When building something battery-powered like a BMS that wakes up from sleep regularly to check things image-save is very useful as it is critical to boot fast to conserve power. A fast boot also improves the user experience in general.</p>
<p>Example:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true"></a>(defun <span class="kw">test</span> (a) {</span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true"></a>        (<span class="kw">print</span> (<span class="kw">list</span> <span class="st">&quot;Arg:&quot;</span> a))</span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true"></a>})</span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true"></a></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true"></a>(defun <span class="kw">main</span> () {</span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true"></a>        (loopwhile t {</span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true"></a>                (<span class="kw">test</span> <span class="dv">123</span>)</span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true"></a>                (sleep <span class="dv">1</span>)</span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true"></a>        })</span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true"></a>})</span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true"></a></span>
<span id="cb398-12"><a href="#cb398-12" aria-hidden="true"></a>(image-save)</span>
<span id="cb398-13"><a href="#cb398-13" aria-hidden="true"></a></span>
<span id="cb398-14"><a href="#cb398-14" aria-hidden="true"></a><span class="co">; This is only needed in order to start the program before rebooting. Without</span></span>
<span id="cb398-15"><a href="#cb398-15" aria-hidden="true"></a><span class="co">; calling main here one has to reboot or restart lbm after stream or upload in</span></span>
<span id="cb398-16"><a href="#cb398-16" aria-hidden="true"></a><span class="co">; order to call main.</span></span>
<span id="cb398-17"><a href="#cb398-17" aria-hidden="true"></a>(<span class="kw">main</span>)</span></code></pre></div>
<hr />
<h2 id="mutexes">Mutexes</h2>
<p>Mutexes can be used to lock resources from other contexts. Example:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> mtx </span>(mutex-create))</span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true"></a></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true"></a>(defun print-numbers() {</span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true"></a>        (mutex-lock mtx)</span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="dv">1</span>)</span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true"></a>        (sleep <span class="fl">0.5</span>)</span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="dv">2</span>)</span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true"></a>        (sleep <span class="fl">0.5</span>)</span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="dv">3</span>)</span>
<span id="cb399-10"><a href="#cb399-10" aria-hidden="true"></a>        (sleep <span class="fl">0.5</span>)</span>
<span id="cb399-11"><a href="#cb399-11" aria-hidden="true"></a>        (<span class="kw">print</span> <span class="dv">4</span>)</span>
<span id="cb399-12"><a href="#cb399-12" aria-hidden="true"></a>        (mutex-unlock mtx)</span>
<span id="cb399-13"><a href="#cb399-13" aria-hidden="true"></a>})</span>
<span id="cb399-14"><a href="#cb399-14" aria-hidden="true"></a></span>
<span id="cb399-15"><a href="#cb399-15" aria-hidden="true"></a>(spawn <span class="dv">100</span> print-numbers)</span>
<span id="cb399-16"><a href="#cb399-16" aria-hidden="true"></a>(sleep <span class="fl">0.1</span>)</span>
<span id="cb399-17"><a href="#cb399-17" aria-hidden="true"></a>(spawn <span class="dv">100</span> print-numbers)</span>
<span id="cb399-18"><a href="#cb399-18" aria-hidden="true"></a>(sleep <span class="fl">0.1</span>)</span>
<span id="cb399-19"><a href="#cb399-19" aria-hidden="true"></a>(spawn <span class="dv">100</span> print-numbers)</span>
<span id="cb399-20"><a href="#cb399-20" aria-hidden="true"></a>(sleep <span class="fl">0.1</span>)</span>
<span id="cb399-21"><a href="#cb399-21" aria-hidden="true"></a>(spawn <span class="dv">100</span> print-numbers)</span></code></pre></div>
<hr />
<h4 id="mutex-create">mutex-create</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb400"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true"></a>(mutex-create)</span></code></pre></div>
<p>Creates a mutex object. The mutex object is a dotted pair (ls . last) which contains two references into a single list, implementing a O(1)-insert-last O(1)-remove-first queue. At the surface though, it is a regular lisp dotted pair that can be destroyed with standard lisp functionality, no protection!</p>
<hr />
<h4 id="mutex-lock">mutex-lock</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb401"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true"></a>(mutex-lock mtx)</span></code></pre></div>
<p>Lock mutex mtx. If mtx already is locked the current context will sleep until it is unlocked.</p>
<hr />
<h4 id="mutex-unlock">mutex-unlock</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb402"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true"></a>(mutex-unlock mtx)</span></code></pre></div>
<p>Unlock mutex mtx. If one or more contexts are waiting on this mutex the next one in the waiting queue will be unblocked.</p>
<hr />
<h2 id="plotting">Plotting</h2>
<p>VESC Tool can be used for plotting data. The easiest way to plot a variable is to just select it in the binding tab while "Poll Status" is active and go to the binding plot below the editor. The plot commands in this section make plots that show up in the "Experiment Plot" tab below the editor and allow more control over the plotting.</p>
<p>The following code adds two graphs and plots them in the experiment plot:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true"></a>(plot-init <span class="st">&quot;x-name&quot;</span> <span class="st">&quot;y-name&quot;</span>)</span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true"></a>(plot-add-graph <span class="st">&quot;sin&quot;</span>)</span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true"></a>(plot-add-graph <span class="st">&quot;cos&quot;</span>)</span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true"></a></span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true"></a>(plot-set-graph <span class="dv">0</span>)</span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true"></a>(looprange i <span class="dv">0</span> <span class="dv">200</span></span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true"></a>    (plot-send-points (<span class="kw">/</span> i <span class="fl">10.0</span>) (sin (<span class="kw">/</span> i <span class="fl">10.0</span>)))</span>
<span id="cb403-8"><a href="#cb403-8" aria-hidden="true"></a>)</span>
<span id="cb403-9"><a href="#cb403-9" aria-hidden="true"></a></span>
<span id="cb403-10"><a href="#cb403-10" aria-hidden="true"></a>(plot-set-graph <span class="dv">1</span>)</span>
<span id="cb403-11"><a href="#cb403-11" aria-hidden="true"></a>(looprange i <span class="dv">0</span> <span class="dv">200</span></span>
<span id="cb403-12"><a href="#cb403-12" aria-hidden="true"></a>    (plot-send-points (<span class="kw">/</span> i <span class="fl">10.0</span>) (cos (<span class="kw">/</span> i <span class="fl">10.0</span>)))</span>
<span id="cb403-13"><a href="#cb403-13" aria-hidden="true"></a>)</span></code></pre></div>
<hr />
<h4 id="plot-init">plot-init</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb404"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true"></a>(plot-init namex namey)</span></code></pre></div>
<p>Start a new plot with namex as the x axis name and namey as the u axis name.</p>
<hr />
<h4 id="plot-add-graph">plot-add-graph</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb405"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true"></a>(plot-add-graph <span class="kw">name</span>)</span></code></pre></div>
<p>Add a graph to the current plot that will be called name. Every added graph gets a new index, starting from 0.</p>
<hr />
<h4 id="plot-set-graph">plot-set-graph</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb406"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true"></a>(plot-set-graph ind)</span></code></pre></div>
<p>Set graph index to which data points are sent.</p>
<hr />
<h4 id="plot-send-points">plot-send-points</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb407"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true"></a>(plot-send-points x y)</span></code></pre></div>
<p>Send a xy-point to the selected graph in the plot.</p>
<hr />
<h2 id="io-boards">IO Boards</h2>
<p>CAN-connected IO-boards can be interfaced using the functions in this section.</p>
<hr />
<h4 id="ioboard-get-adc">ioboard-get-adc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb408"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true"></a>(ioboard-get-adc can-id channel)</span></code></pre></div>
<p>Read ADC-input channel from IO-board with can-id. Channel range: 1 to 8. If the IO-board with can-id is not present on the CAN-bus or if the channel is missing -1 will be returned.</p>
<hr />
<h4 id="ioboard-get-digital">ioboard-get-digital</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb409"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true"></a>(ioboard-get-digital can-id channel)</span></code></pre></div>
<p>Read digital input channel from IO-board with can-id. Channel range: 1 to 64. If the IO-board with can-id is not present on the CAN-bus or if the channel is missing -1 will be returned.</p>
<hr />
<h4 id="ioboard-set-digital">ioboard-set-digital</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb410"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true"></a>(ioboard-set-digital can-id channel state)</span></code></pre></div>
<p>Write digital output channel to IO-board with can-id. State can be 1 or 0.</p>
<hr />
<h4 id="ioboard-set-pwm">ioboard-set-pwm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb411"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true"></a>(ioboard-set-pwm can-id channel duty)</span></code></pre></div>
<p>Write PWM-output channel to IO-board with can-id. The value duty can be 0.0 to 1.0.</p>
<hr />
<h2 id="logging">Logging</h2>
<p>It is possible to log arbitrary data to log-devices such as the VESC Express, which can be connected on the CAN-bus.</p>
<p>Every log field consists of a keyword, name, unit, precision and some flags. Most of these fields control how VESC Tool renders the log. In the csv-file for the log they only show up in the first line as headers for each column.</p>
<p>VESC Tool will look for some special keywords to handle statistics and rendering on the map. If these keywords are missing the log can still be shown, but some of the functionality and statistics in VESC Tool will not be available. The following are the special keywords:</p>
<p><strong>t_day</strong><br />
Time of day in seconds. Used for statistics. This field is created by the log module when append-time is set to 1.</p>
<p><strong>gnss_h_acc</strong><br />
GNSS horizontal accuracy. Used for outlier filtering. This field is created by the log module when apped-gnss is set to 1.</p>
<p><strong>gnss_lat</strong><br />
GNSS latitude. Used for plotting traces on the map and for calculating statistics. This field is created by the log module when apped-gnss is set to 1.</p>
<p><strong>gnss_lon</strong><br />
GNSS longitude. Used for plotting traces on the map and for calculating statistics. This field is created by the log module when apped-gnss is set to 1.</p>
<p><strong>gnss_alt</strong><br />
GNSS altitude. Used for plotting traces on the map and for calculating statistics. This field is created by the log module when apped-gnss is set to 1.</p>
<p><strong>trip_vesc</strong><br />
VESC trip counter in meters. Used for calculating statistics.</p>
<p><strong>trip_vesc_abs</strong><br />
Absolute VESC trip counter in meters. Used for calculating statistics.</p>
<p><strong>trip_gnss</strong><br />
GNSS trip counter in meters. Used for calculating statistics. This field is automatically generated by VESC Tool from gnss_lat, gnss_lon and gnss_alt if it is missing.</p>
<p><strong>cnt_wh</strong><br />
Watt hour counter. Used for calculating statistics.</p>
<p><strong>cnt_wh_chg</strong><br />
Watt hour counter charging. Used for calculating statistics.</p>
<p><strong>cnt_ah</strong><br />
Amp hour counter. Used for calculating statistics.</p>
<p><strong>cnt_ah_chg</strong><br />
Amp hour counter charging. Used for calculating statistics.</p>
<p><strong>roll</strong><br />
IMU roll in degrees. Used for the IMU 3D plot.</p>
<p><strong>pitch</strong><br />
IMU pitch in degrees. Used for the IMU 3D plot.</p>
<p><strong>yaw</strong><br />
IMU yaw in degrees. Used for the IMU 3D plot.</p>
<p><strong>fault</strong><br />
Fault code. Converted to a fault string in the VESC Tool log analysis tool.</p>
<hr />
<h4 id="log-config-field">log-config-field</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb412"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true"></a>(log-config-field</span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true"></a>    can-id</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true"></a>    field-ind</span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true"></a>    <span class="kw">key</span></span>
<span id="cb412-5"><a href="#cb412-5" aria-hidden="true"></a>    <span class="kw">name</span></span>
<span id="cb412-6"><a href="#cb412-6" aria-hidden="true"></a>    unit</span>
<span id="cb412-7"><a href="#cb412-7" aria-hidden="true"></a>    precision</span>
<span id="cb412-8"><a href="#cb412-8" aria-hidden="true"></a>    is-relative</span>
<span id="cb412-9"><a href="#cb412-9" aria-hidden="true"></a>    is-timestamp</span>
<span id="cb412-10"><a href="#cb412-10" aria-hidden="true"></a>)</span></code></pre></div>
<p>Configure log field on log device. Parameters:</p>
<p><strong>can-id</strong><br />
ID on the CAN-bus. Setting the id to -1 will send the data to VESC Tool. On the express platform -2 will log to the local SD-card.</p>
<p><strong>field-ind</strong><br />
Field index in the log.</p>
<p><strong>key</strong><br />
Keyword string.</p>
<p><strong>name</strong><br />
Name string.</p>
<p><strong>unit</strong><br />
Unit string.</p>
<p><strong>precision</strong><br />
Number of decimals.</p>
<p><strong>is-relative</strong><br />
Relative fields are displayed relative to the start value of the log.</p>
<p><strong>is-timestamp</strong><br />
Timestamp fields are displayed with the format hh:mm:ss.</p>
<hr />
<h4 id="log-start">log-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb413"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true"></a>(log-start</span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true"></a>    can-id</span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true"></a>    field-num</span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true"></a>    rate-hz</span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true"></a>    append-time</span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true"></a>    apped-gnss</span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true"></a>)</span></code></pre></div>
<p>Start logging. Before starting to log all fields should be configured with <a href="#log-config-field">log-config-field</a>.</p>
<p><strong>can-id</strong><br />
ID on the CAN-bus. Setting the id to -1 will send the data to VESC Tool. On the express platform -2 will log to the local SD-card.</p>
<p><strong>field-num</strong><br />
Number of log fields.</p>
<p><strong>rate-hz</strong><br />
Log rate in Hz.</p>
<p><strong>append-time</strong><br />
If set to true the log device will append a timestamp to each sample.</p>
<p><strong>append-gnss</strong><br />
If set to true the log device will append a GNSS-position to each sample. This requires a GNSS-receiver on the log device and the log will not start until a valid position is available.</p>
<hr />
<h4 id="log-stop">log-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb414"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true"></a>(log-stop can-id)</span></code></pre></div>
<p>Stop logging data on log device with can-id. The id -1 refers to VESC Tool and id -2 refers to the local express.</p>
<hr />
<h4 id="log-send-f32">log-send-f32</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb415"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true"></a>(log-send-f32 can-id from-field-ind sample1 ... sampleN)</span></code></pre></div>
<p>Send log samples to log device with can-id. This function takes 1 to 100 samples as arguments which will be applied to the log fields starting from from-field-ind. The samples can be numbers or lists of numbers. Setting the id to -1 will send the data to VESC Tool and setting id to -2 will store it locally on the express.</p>
<hr />
<h4 id="log-send-f64">log-send-f64</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb416"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true"></a>(log-send-f64 can-id from-field-ind sample1 ... sampleN)</span></code></pre></div>
<p>Same as <a href="#log-send-f32">log-send-f32</a> but uses 64-bit values for higher precision and takes up to 50 samples. Useful for e.g. gnss-positions where 32-bit floats do not give enough precision due to the size of the earth.</p>
<hr />
<h2 id="gnss">GNSS</h2>
<p>If a GNSS-receiver such as the VESC Express is connected on the CAN-bus, the position, speed, time and precision data from it can be read from LBM.</p>
<hr />
<h4 id="gnss-lat-lon">gnss-lat-lon</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb417"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true"></a>(gnss-lat-lon)</span></code></pre></div>
<p>Returns the latitude and longitude of the position as a list with two elements.</p>
<hr />
<h4 id="gnss-height">gnss-height</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb418"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true"></a>(gnss-height)</span></code></pre></div>
<p>Returns the height of the position in meters.</p>
<hr />
<h4 id="gnss-speed">gnss-speed</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb419"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true"></a>(gnss-speed)</span></code></pre></div>
<p>Returns the speed on meters per second.</p>
<hr />
<h4 id="gnss-hdop">gnss-hdop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb420"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true"></a>(gnss-hdop)</span></code></pre></div>
<p>Returns the hdop-value of the position. Lower values mean that the precision is better.</p>
<hr />
<h4 id="gnss-date-time">gnss-date-time</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb421"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true"></a>(gnss-date-time)</span></code></pre></div>
<p>Returns date and time of the last position sample as a list with the format (year month day hours minutes seconds milliseconds).</p>
<hr />
<h4 id="gnss-age">gnss-age</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.00+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb422"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true"></a>(gnss-age)</span></code></pre></div>
<p>Returns the age of the last gnss-sample in seconds.</p>
<hr />
<h4 id="ublox-init">ublox-init</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb423"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true"></a>(ublox-init optRateMs optUartNum optPinRx optPinTx)</span></code></pre></div>
<p>Re-initializes the ublox gnss-module. Returns true on success and nil on failure. Nil most likely means that something is wrong with the connection.</p>
<p>The optional argument optRateMs can be used to set the navigation rate in milliseconds. By default 500 ms us used. Not any navigation rate is possible, it depends on the ublox module in use. Common rates that can work are 100, 200, 500, 1000 and 2000 ms.</p>
<p>The optional arguments optUartNum, optPinRx and optPinTx can be used to specify the UART peripheral and pins. optUartNum can be 0 or 1 and the pins can be any valid ESP-pins.</p>
<hr />
<h4 id="nmea-parse">nmea-parse</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb424"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true"></a>(nmea-parse <span class="kw">str</span>)</span></code></pre></div>
<p>Parse NMEA string and updates GNSS state. Supported strings are GGA, GPGSV, GLGSV and RMC. Other strings are ignored. Returns true when something was parsed, nil otherwise.</p>
<p>All of the GNSS-extensions as well as the logging can take advantage of these updates. CAN-messages for GNSS position and time will also be sent out based on the updates.</p>
<hr />
<h4 id="set-pos-time">set-pos-time</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb425"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true"></a>(set-pos-time lat lon height speed hdop msToday year month day)</span></code></pre></div>
<p>Update position, date and time state. All arguments are optional and nil can be passed for arguments that should not be updated.</p>
<p>The arguments are interpreted as follows:</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>lat</td>
<td>Latitude in degrees</td>
</tr>
<tr class="even">
<td>lon</td>
<td>Longitude in degrees</td>
</tr>
<tr class="odd">
<td>height</td>
<td>Altitude in meters</td>
</tr>
<tr class="even">
<td>speed</td>
<td>Ground speed in meters per second</td>
</tr>
<tr class="odd">
<td>hdop</td>
<td>hdop-value of position</td>
</tr>
<tr class="even">
<td>msToday</td>
<td>Time today in milliseconds</td>
</tr>
<tr class="odd">
<td>year</td>
<td>Year</td>
</tr>
<tr class="even">
<td>month</td>
<td>Month</td>
</tr>
<tr class="odd">
<td>day</td>
<td>day</td>
</tr>
</tbody>
</table>
<p>All of the GNSS-extensions as well as the logging can take advantage of these updates. CAN-messages for GNSS position and time will also be sent out based on the updates.</p>
<p>Examples</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true"></a>(var hh <span class="dv">10</span>)</span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true"></a>(var mm <span class="dv">25</span>)</span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true"></a>(var ss <span class="dv">10</span>)</span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true"></a>(var ms-today (<span class="kw">+</span></span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true"></a>    (<span class="kw">*</span> hh <span class="dv">60</span> <span class="dv">60</span> <span class="dv">1000</span>)</span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true"></a>    (<span class="kw">*</span> mm <span class="dv">60</span> <span class="dv">1000</span>)</span>
<span id="cb426-7"><a href="#cb426-7" aria-hidden="true"></a>    (<span class="kw">*</span> ss <span class="dv">1000</span>)</span>
<span id="cb426-8"><a href="#cb426-8" aria-hidden="true"></a>))</span>
<span id="cb426-9"><a href="#cb426-9" aria-hidden="true"></a></span>
<span id="cb426-10"><a href="#cb426-10" aria-hidden="true"></a><span class="co">; Set time and data only</span></span>
<span id="cb426-11"><a href="#cb426-11" aria-hidden="true"></a>(set-pos-time <span class="va">nil</span> <span class="va">nil</span> <span class="va">nil</span> <span class="va">nil</span> <span class="va">nil</span> ms-today <span class="dv">2025</span> <span class="dv">02</span> <span class="dv">02</span>)</span>
<span id="cb426-12"><a href="#cb426-12" aria-hidden="true"></a></span>
<span id="cb426-13"><a href="#cb426-13" aria-hidden="true"></a></span>
<span id="cb426-14"><a href="#cb426-14" aria-hidden="true"></a><span class="co">; Set position only</span></span>
<span id="cb426-15"><a href="#cb426-15" aria-hidden="true"></a>(set-pos-time <span class="fl">57.623761</span> <span class="fl">13.091890</span> <span class="dv">10</span> <span class="fl">0.0</span> <span class="dv">2</span>)</span></code></pre></div>
<hr />
<h2 id="commands">Commands</h2>
<p>The VESC commands interface can be accessed from LispBM. This can be used to execute all commands supported by VESC Tool or to create a bridge to VESC Tool.</p>
<hr />
<h4 id="cmds-start-stop">cmds-start-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb427"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true"></a>(cmds-start-stop optStart)</span></code></pre></div>
<p>Start or stop commands interface. The commands interface needs to be started for the extensions and related events to work. This will allocate around 4k (Express) or 3k (ESC) of memory for the packet interface and for the commands processing thread stack. When stopping the allocated memory will be freed. The optional argument optStart can be set to true for start or to false for stop. If it is left out the commands interface will be started.</p>
<hr />
<h4 id="cmds-proc">cmds-proc</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ESC, Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb428"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true"></a>(cmds-proc data)</span></code></pre></div>
<p>Process data byte array with the packet decoder. If a full command is decoded a C thread will be spawned that executes the command. If the command has a response to send this is done using the event-cmds-data-tx event.</p>
<p>The best way to illustrate how to use this is with an example. The following code uses TCP sockets on VESC Express to connect to the VESC TCP hub. VESC Tool can then connect to this express using the TCP Hub and run all commands as usual. It should be fairly simple to adapt this example to for example interface with an LTE modem.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true"></a><span class="co">; Connect to VESC TCP hub</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> socket </span>(tcp-connect <span class="st">&quot;veschub.vedder.se&quot;</span> <span class="dv">65101</span>))</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true"></a></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true"></a><span class="co">; Register with username user11 and password pass11</span></span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true"></a>(tcp-send socket <span class="st">&quot;VESC:user11:pass11</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true"></a></span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true"></a>(defun event-handler () {</span>
<span id="cb429-8"><a href="#cb429-8" aria-hidden="true"></a>        (set-mailbox-size <span class="dv">3</span>)</span>
<span id="cb429-9"><a href="#cb429-9" aria-hidden="true"></a>        (loopwhile t</span>
<span id="cb429-10"><a href="#cb429-10" aria-hidden="true"></a>            (recv</span>
<span id="cb429-11"><a href="#cb429-11" aria-hidden="true"></a>                ((event-cmds-data-tx (? data)) (tcp-send socket data))</span>
<span id="cb429-12"><a href="#cb429-12" aria-hidden="true"></a>                (_ <span class="va">nil</span>)</span>
<span id="cb429-13"><a href="#cb429-13" aria-hidden="true"></a>        ))</span>
<span id="cb429-14"><a href="#cb429-14" aria-hidden="true"></a>})</span>
<span id="cb429-15"><a href="#cb429-15" aria-hidden="true"></a></span>
<span id="cb429-16"><a href="#cb429-16" aria-hidden="true"></a>(event-register-handler (spawn event-handler))</span>
<span id="cb429-17"><a href="#cb429-17" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-cmds-data-tx</span>)</span>
<span id="cb429-18"><a href="#cb429-18" aria-hidden="true"></a></span>
<span id="cb429-19"><a href="#cb429-19" aria-hidden="true"></a>(cmds-start-stop <span class="va">true</span>)</span>
<span id="cb429-20"><a href="#cb429-20" aria-hidden="true"></a>(loopwhile t {</span>
<span id="cb429-21"><a href="#cb429-21" aria-hidden="true"></a>        (cmds-proc (tcp-recv socket <span class="dv">512</span> <span class="dv">100</span> <span class="va">false</span>))</span>
<span id="cb429-22"><a href="#cb429-22" aria-hidden="true"></a>})</span></code></pre></div>
<hr />
<h2 id="esp-now">ESP-NOW</h2>
<p>The VESC Express has full support for ESP-NOW. It can be used in any combination of bluetooth and wifi, the only limitation is that it must use the same channel as the wifi. That is mainly an issue in station mode as there is no way to control the channel that the access point the express connects to uses.</p>
<hr />
<h4 id="esp-now-start">esp-now-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb430"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true"></a>(esp-now-start)</span></code></pre></div>
<p>Start ESP-NOW. This must be run before further ESP-NOW operations.</p>
<hr />
<h4 id="esp-now-add-peer">esp-now-add-peer</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb431"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true"></a>(esp-now-add-peer peer optRate)</span></code></pre></div>
<p>Add peer. The argument is a list with the mac address of the peer to add. This must be run before esp-now-send as it only is possible to send data to peers that have been added. Example:</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true"></a>(esp-now-add-peer &#39;(<span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span>)) <span class="co">; Add broadcast address as peer</span></span></code></pre></div>
<p>The optional argument optRate (added in FW6.06) sets the wifi bitrate when sending data to this peer. By default it is 1 Mbps. The rate argument is a number between -1 and 15 with the following meaning:</p>
<pre><code>-1: Keep default Rate
0 : 1 Mbps with long preamble
1 : 2 Mbps with long preamble
2 : 5.5 Mbps with long preamble
3 : 11 Mbps with long preamble
4 : ???? Missing in ESP doc
5 : 2 Mbps with short preamble
6 : 5.5 Mbps with short preamble
7 : 11 Mbps with short preamble
8 : 48 Mbps
9 : 24 Mbps
10: 12 Mbps
11: 6 Mbps
12: 54 Mbps
13: 36 Mbps
14: 18 Mbps
15: 9 Mbps
</code></pre>
<hr />
<h4 id="esp-now-del-peer">esp-now-del-peer</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb434"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true"></a>(esp-now-del-peer peer)</span></code></pre></div>
<p>Delete peer. There is a limit to how many peers can be added, so if adding another peer does not work old peers can be deleted to free up resources.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true"></a>(esp-now-del-peer &#39;(<span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span>)) <span class="co">; Remove broadcast peer</span></span></code></pre></div>
<hr />
<h4 id="esp-now-send">esp-now-send</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb436"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true"></a>(esp-now-send peer data)</span></code></pre></div>
<p>Send the array data to peer. The peer argument is a list with the mac address of the peer to send to. If peer is not the broadcast address this function will make a few retries and returns true if the packet arrived at the receiver and false if it was not received. For broadcast only one try is made and it should always return true.</p>
<p>Example:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true"></a>(esp-now-send &#39;(<span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span>) <span class="st">&quot;Hello!&quot;</span>) <span class="co">; Broadcast the string &quot;Hello!&quot;</span></span></code></pre></div>
<hr />
<h4 id="esp-now-recv">esp-now-recv</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb438"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true"></a>(esp-now-recv optTimeout)</span></code></pre></div>
<p>Block current thread until esp-now data arrives. The optional argument optTimeout can be used to specify a timeout in seconds.</p>
<p>If a timeout occurs the symbol timeout will be returned, otherwise a list with the following format will be returned:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true"></a>(src-mac-addr dest-mac-addr payload-array rssi-db)</span></code></pre></div>
<p>Usage example:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true"></a>(esp-now-start)</span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true"></a>(<span class="kw">print</span> (esp-now-recv))</span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true"></a><span class="kw">&gt;</span> ((<span class="dv">112</span> <span class="dv">4</span> <span class="dv">29</span> <span class="dv">15</span> <span class="dv">194</span> <span class="dv">105</span>) (<span class="dv">16</span> <span class="dv">145</span> <span class="dv">168</span> <span class="dv">52</span> <span class="dv">203</span> <span class="dv">121</span>) <span class="st">&quot;Test&quot;</span> <span class="dv">-40</span>)</span></code></pre></div>
<hr />
<h4 id="get-mac-addr">get-mac-addr</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb441"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true"></a>(get-mac-addr)</span></code></pre></div>
<p>Get the mac address of the device as a list. This address is what peer refers to in the functions above. Example:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true"></a>(get-mac-addr)</span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">112</span> <span class="dv">4</span> <span class="dv">29</span> <span class="dv">15</span> <span class="dv">194</span> <span class="dv">105</span>)</span></code></pre></div>
<hr />
<h4 id="wifi-get-chan">wifi-get-chan</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb443"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true"></a>(wifi-get-chan)</span></code></pre></div>
<p>Get the current wifi-channel. For ESP-NOW to work the communicating devices need to be on the same wifi-channel. By default the channel is 1, but when station mode is used on the wifi the channel will be the same as the access point and cannot be changed.</p>
<hr />
<h4 id="wifi-set-chan">wifi-set-chan</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb444"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true"></a>(wifi-set-chan channel)</span></code></pre></div>
<p>Set the current wifi-channel. This function cannot be used when wifi is connected.</p>
<hr />
<h4 id="wifi-get-bw">wifi-get-bw</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb445"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true"></a>(wifi-get-bw)</span></code></pre></div>
<p>Get current wifi bandwidth in MHz.</p>
<hr />
<h4 id="wifi-set-bw">wifi-set-bw</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb446"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true"></a>(wifi-set-bw)</span></code></pre></div>
<p>Set wifi bandwidth in MHz. This function is experimental and should only be used if you know what you are doing.</p>
<hr />
<h4 id="wifi-stop">wifi-stop</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb447"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true"></a>(wifi-stop)</span></code></pre></div>
<p>Stop wifi-driver. Reduces power consumption.</p>
<hr />
<h4 id="wifi-start">wifi-start</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb448"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true"></a>(wifi-start)</span></code></pre></div>
<p>Start wifi-driver. Re-connects to networks that were connected before. Can be used to restart wifi after sleep-light.</p>
<hr />
<h3 id="receiving-data">Receiving Data</h3>
<p>Events can be used to receive ESP-NOW data. This is best described with an example:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true"></a><span class="co">; Here src is the mac-address of the sender, des is the mac-address</span></span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true"></a><span class="co">; of the receiver and data is an array with the sent data. If des is</span></span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true"></a><span class="co">; the broadcast address (255 255 255 255 255 255) it means that this</span></span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true"></a><span class="co">; was a broadcast packet.</span></span>
<span id="cb449-5"><a href="#cb449-5" aria-hidden="true"></a></span>
<span id="cb449-6"><a href="#cb449-6" aria-hidden="true"></a>(defun proc-data (src des data rssi)</span>
<span id="cb449-7"><a href="#cb449-7" aria-hidden="true"></a>    (<span class="kw">print</span> (<span class="kw">list</span> src des data rssi))</span>
<span id="cb449-8"><a href="#cb449-8" aria-hidden="true"></a>)</span>
<span id="cb449-9"><a href="#cb449-9" aria-hidden="true"></a></span>
<span id="cb449-10"><a href="#cb449-10" aria-hidden="true"></a>(defun event-handler ()</span>
<span id="cb449-11"><a href="#cb449-11" aria-hidden="true"></a>    (loopwhile t</span>
<span id="cb449-12"><a href="#cb449-12" aria-hidden="true"></a>        (recv</span>
<span id="cb449-13"><a href="#cb449-13" aria-hidden="true"></a>            ((event-esp-now-rx (? src) (? des) (? data) (? rssi)) (proc-data src des data rssi))</span>
<span id="cb449-14"><a href="#cb449-14" aria-hidden="true"></a>            (_ <span class="va">nil</span>)</span>
<span id="cb449-15"><a href="#cb449-15" aria-hidden="true"></a>)))</span>
<span id="cb449-16"><a href="#cb449-16" aria-hidden="true"></a></span>
<span id="cb449-17"><a href="#cb449-17" aria-hidden="true"></a>(event-register-handler (spawn event-handler))</span>
<span id="cb449-18"><a href="#cb449-18" aria-hidden="true"></a>(event-enable <span class="at">&#39;event-esp-now-rx</span>)</span></code></pre></div>
<p>NOTE: The RSSI was added in firmware 6.05 and should be left out in earlier firmwares.</p>
<hr />
<h2 id="file-system-sd-card">File System (SD Card)</h2>
<p>When a SD-card is present in the VESC Express files can be listed, read, written and removed. Directories can also be created and removed.</p>
<hr />
<h4 id="f-connect">f-connect</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb450"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true"></a>(f-connect pin-mosi pin-miso pin-sck pin-cs optSpiSpeed)</span></code></pre></div>
<p>Connect SD-card on pin-mosi, pin-miso, pin-sck and pin-cs. The optional argument optSpiSpeed can be used to specify the SPI speed (default 20000 Hz). Returns true on success, nil otherwise.</p>
<p><strong>NOTE</strong><br />
This is only needed if you connect a memory card manually to hardware that does not come with one. Hardware such as the <a href="https://www.vesclabs.com/product/vl-nanolog/">VESC Nanolog</a> already has the memory card connected and initialized, so you can use the file operations right away.</p>
<hr />
<h4 id="f-connect-nand">f-connect-nand</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb451"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true"></a>(f-connect-nand pin-mosi pin-miso pin-sck pin-cs optSpiSpeed)</span></code></pre></div>
<p>Connect NAND-flash memory on pin-mosi, pin-miso, pin-sck and pin-cs. The optional argument optSpiSpeed can be used to specify the SPI speed (default 20000 Hz). Returns true on success, nil otherwise.</p>
<hr />
<h4 id="f-disconnect">f-disconnect</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb452"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true"></a>(f-disconnect)</span></code></pre></div>
<p>Disconnect SD-card or NAND-Flash.</p>
<hr />
<h4 id="f-open">f-open</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb453"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true"></a>(f-open <span class="kw">path</span> mode)</span></code></pre></div>
<p>Open a file in open-mode mode (r, w, a, r+, w+ and a+). Returns a number that can be used as a handle to the file on success or nil if the file could not be opened.</p>
<p>The modes mean the following</p>
<table>
<thead>
<tr class="header">
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>r</td>
<td>Open for reading. The file must exist.</td>
</tr>
<tr class="even">
<td>w</td>
<td>Open for writing. Creates an empty file or truncates an existing file.</td>
</tr>
<tr class="odd">
<td>a</td>
<td>Open for appending. Writes data at the end of the file. Creates the file if it does not exist.</td>
</tr>
<tr class="even">
<td>r+</td>
<td>Open for reading and writing. The file must exist.</td>
</tr>
<tr class="odd">
<td>w+</td>
<td>Open for reading and writing. Creates an empty file or truncates an existing file.</td>
</tr>
<tr class="even">
<td>a+</td>
<td>Open for reading and appending. The file is created if it does not exist.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f </span>(f-open <span class="st">&quot;test.txt&quot;</span> <span class="st">&quot;w&quot;</span>)) <span class="co">; Open test.txt in write-only mode and store the handle as f.</span></span></code></pre></div>
<hr />
<h4 id="f-close">f-close</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb455"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true"></a>(f-close file)</span></code></pre></div>
<p>Close file. The argument file is the handle returned by f-open.</p>
<hr />
<h4 id="f-read">f-read</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb456"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true"></a>(f-read file size)</span></code></pre></div>
<p>Read up to size bytes from file. Returns an array with the read data. Successive calls to f-read will move the file position forwards. If the returned array is smaller than the size-argument it means that the end of the file was reached. When calling read after reaching the end if the file nil is returned.</p>
<hr />
<h4 id="f-readline">f-readline</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb457"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true"></a>(f-readline file maxlen)</span></code></pre></div>
<p>Read one line from file. At most maxlen bytes will be read. If maxlen is set too high this function will fail as it needs to pre-allocate enough memory to fit maxlen. This function advances the file position, so successive calls to it can be used to read the file line-by-line. When the end of the file is reached nil is returned.</p>
<hr />
<h4 id="f-write">f-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb458"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true"></a>(f-write file buf)</span></code></pre></div>
<p>Write array buf to file. This will advance the file position by the size of buf.</p>
<hr />
<h4 id="f-tell">f-tell</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb459"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true"></a>(f-tell file)</span></code></pre></div>
<p>Get the current position in the file.</p>
<hr />
<h4 id="f-seek">f-seek</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb460"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true"></a>(f-seek file pos)</span></code></pre></div>
<p>Seek to position pos in file. If pos is a negative number the seek is done from the end of the file.</p>
<hr />
<h4 id="f-mkdir">f-mkdir</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb461"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true"></a>(f-mkdir <span class="kw">path</span>)</span></code></pre></div>
<p>Make directory on path.</p>
<hr />
<h4 id="f-rm">f-rm</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb462"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true"></a>(f-rm <span class="kw">path</span>)</span></code></pre></div>
<p>Remove path recursively. If path is a file just the file is removed and if it is a directory that directory and all its content will be removed recursively.</p>
<hr />
<h4 id="f-ls">f-ls</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb463"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true"></a>(f-ls <span class="kw">path</span>)</span></code></pre></div>
<p>List all files and directories in path. Returns a list with the entries; each entry is a list where the first element is the name, the second element is true for directories and nil for files and the third element is the size. For directories the size says how many entries that directory has and for files it says what size the file has in bytes.</p>
<p>Example:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true"></a>(f-ls <span class="st">&quot;&quot;</span>)</span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="st">&quot;testsize.bin&quot;</span> <span class="va">nil</span> <span class="dv">100</span>) (<span class="st">&quot;test.txt&quot;</span> <span class="va">nil</span> <span class="dv">7</span>) (<span class="st">&quot;old_logs&quot;</span> t <span class="dv">47</span>))</span></code></pre></div>
<hr />
<h4 id="f-size">f-size</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb465"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true"></a>(f-size file)</span></code></pre></div>
<p>Get the size of a file in bytes. File can be a path (e.g. "test.txt") or a file pointer opened with f-open.</p>
<hr />
<h4 id="f-rename">f-rename</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb466"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true"></a>(f-rename oldname newname)</span></code></pre></div>
<p>Rename file (same as moving a file). Returns true on success, nil otherwise.</p>
<hr />
<h4 id="f-sync">f-sync</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb467"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true"></a>(f-sync file)</span></code></pre></div>
<p>Write buffered changes to the memory card.</p>
<hr />
<h4 id="f-fatinfo">f-fatinfo</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb468"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true"></a>(f-fatinfo)</span></code></pre></div>
<p>Returns a list where the first element is the free space on the file system and the second element is the total size of the file system. Unit: MB. Example:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true"></a>(f-fatinfo)</span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">30298</span> <span class="dv">30417</span>)</span></code></pre></div>
<hr />
<h2 id="firmware-update">Firmware Update</h2>
<p>The firmware can be updated locally and on CAN-devices. This requires that the firmware-file is pre-processed using VESC Tool with the cli-command --packFirmware.</p>
<hr />
<h4 id="fw-erase">fw-erase</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb470"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true"></a>(fw-erase size optCanId)</span></code></pre></div>
<p>Erase firmware-buffer. This is required before writing the firmware. Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="fw-write">fw-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb471"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true"></a>(fw-write offset data optCanId)</span></code></pre></div>
<p>Write data to firmware-buffer at offset. Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="fw-reboot">fw-reboot</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb472"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true"></a>(fw-reboot optCanId)</span></code></pre></div>
<p>Reboot and attempt to load the new firmware from the firmware-buffer using the bootloader. This function always returns true as there is no easy way to get the response from the bootloader. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="fw-info">fw-info</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb473"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true"></a>(fw-info optCanId)</span></code></pre></div>
<p>Get an assoc-list containing information about the VESC version number and git commit hashes. If optCanId is <code>-1</code> or not given the local device is queried. If the target device does not run a recent enough firmware that supports this, or if the CAN bus is otherwise non-functional, this function will timeout after 2 seconds returning the symbol <code>timeout</code>.</p>
<p>The returned assoc-list has the following structure:</p>
<pre><code>(
    (&#39;version . (majorNumber minorNumber))
    (&#39;test-version . number)
    (&#39;commit . str)
    (&#39;user-commit . str-or-nil)
)
</code></pre>
<p>The test versions exact semantics depend on which firmware is running on the queried device, but on bldc for instance it is the beta version number. The user commit hash can be configured when you are compiling any of the VESC firmwares yourself, and is useful when you have a separate project that is using any of the VESC firmwares as a dependency, you can then configure it to be the commit of said project. If it was not configured when building it is instead set to <code>nil</code>. Unfortunately there is currently no documentation written anywhere for how to set it, <a href="../Makefile#L167-L172">but here are the relevant lines of code in bldc's makefile</a>, and <a href="https://github.com/vedderb/vesc_express/blob/main/CMakeLists.txt#L32-L37">here they are in vesc_express's CMake configuration</a>. Similar <a href="https://github.com/vedderb/vesc_bms_fw/blob/main/Makefile#L32-L37">flags exist for vesc_bms_fw</a> and <a href="https://github.com/vedderb/vesc_gpstm/blob/main/Makefile#L31-L36">vesc_gpstm</a>.</p>
<p>Example where we queried a bldc unit with the CAN id 10 running a development build of v6.6 beta 3:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true"></a>(fw-info <span class="dv">10</span>)</span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true"></a><span class="kw">&gt;</span> ((version 6u 6u) (test-version . 3u) (commit . <span class="st">&quot;4f2df650c4ed6d820657217e966d1dbd6c2c01e6&quot;</span>) (user-commit . <span class="va">nil</span>))</span></code></pre></div>
<hr />
<h4 id="fw-data">fw-data</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb476"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true"></a>(fw-data optOffset optLen)</span></code></pre></div>
<p>Get the firmware data partition as an array. The optional argument optOffset can be used to specify an offset in the partition and the optional argument optLen can be used to specify the length. By default the offset is 0 and the length is the entire firmware buffer (around 1.5 MB).</p>
<p>Note that this array is read-only, so do not try to write directly to it! It is however possible to write to it using fw-write-raw if fw-erase has been performed first. After the erase each byte can be written to once, in any order.</p>
<p>Example:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true"></a><span class="co">; An array with the first 10 bytes of the firmware buffer</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> fwd </span>(fw-data <span class="dv">0</span> <span class="dv">10</span>))</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true"></a></span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true"></a><span class="co">; Erase at least 100 bytes</span></span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true"></a>(fw-erase <span class="dv">100</span>)</span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true"></a></span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true"></a><span class="co">; Write 1 to 10 to the beginning of the firmware buffer.</span></span>
<span id="cb477-8"><a href="#cb477-8" aria-hidden="true"></a>(fw-write-raw <span class="dv">0</span> [<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span>])</span>
<span id="cb477-9"><a href="#cb477-9" aria-hidden="true"></a></span>
<span id="cb477-10"><a href="#cb477-10" aria-hidden="true"></a><span class="co">; Print the array</span></span>
<span id="cb477-11"><a href="#cb477-11" aria-hidden="true"></a>(<span class="kw">print</span> fwd)</span></code></pre></div>
<hr />
<h4 id="fw-write-raw">fw-write-raw</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb478"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true"></a>(fw-write-raw offset data)</span></code></pre></div>
<p>Write data to firmware-buffer at offset. Returns true on success or nil on failure. Unlike fw-write, this function writes directly to the firmware buffer without an offset shift and it supports writing more than 500 bytes at a time.</p>
<hr />
<h2 id="lisp-and-qml-upload">Lisp and Qml Upload</h2>
<p>Lisp and QML-scripts can be updated locally and on CAN-devices. This requires that the file is pre-processed using VESC Tool with the cli-command --packLisp and --packQml.</p>
<hr />
<h4 id="lbm-erase">lbm-erase</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb479"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true"></a>(lbm-erase optCanId)</span></code></pre></div>
<p>Erase lisp-code. This is required before writing new code. Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="qml-erase">qml-erase</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb480"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true"></a>(qml-erase optCanId)</span></code></pre></div>
<p>Erase qml-code. This is required before writing new code. Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="lbm-write">lbm-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb481"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true"></a>(lbm-write offset data optCanId)</span></code></pre></div>
<p>Write data to lbm-buffer at offset. Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="qml-write">qml-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb482"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true"></a>(qml-write offset data optCanId)</span></code></pre></div>
<p>Write data to qml-buffer at offset. Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId.</p>
<hr />
<h4 id="lbm-run">lbm-run</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb483"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true"></a>(lbm-run running optCanId)</span></code></pre></div>
<p>Run or stop the lbm-code (run if running is 1, stop otherwise). Returns true on success or nil/timeout on failure. If the optional argument optCanId is omitted or set to -1 the command is performed locally, otherwise it is performed on the CAN-device with id optCanId. If running is set to 1 and LispBM already is running a restart is performed.</p>
<hr />
<h2 id="rgb-led-eg-ws2812">RGB LED (e.g. WS2812)</h2>
<p>The express can use the remote peripheral to drive addressable LEDs on any pin. The LED on the DevKitM-1 is actually and addressable LED connected to pin 8, so this driver is required to use it.</p>
<hr />
<h4 id="rgbled-init">rgbled-init</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb484"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true"></a>(rgbled-init pin)</span></code></pre></div>
<p>Initialize the rgbled-driver on pin. If the driver already is initialized it will be de-initialized first.</p>
<hr />
<h4 id="rgbled-deinit">rgbled-deinit</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb485"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true"></a>(rgbled-deinit)</span></code></pre></div>
<p>De-initialize the rgbled-driver and release the resources it used. If data is currently sent to the LEDs this function will block until that is done.</p>
<hr />
<h4 id="rgbled-buffer">rgbled-buffer</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb486"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true"></a>(rgbled-buffer num-leds optLedType optGammaCorr)</span></code></pre></div>
<p>Creates an LED-buffer for num-leds leds. The optional argument optLedType specifies the type of LEDs. If it is omitted type 0 (GRB) is used. The available types are:</p>
<table>
<thead>
<tr class="header">
<th>Number</th>
<th>LED Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>GRB</td>
</tr>
<tr class="even">
<td>1</td>
<td>RGB</td>
</tr>
<tr class="odd">
<td>2</td>
<td>GRBW</td>
</tr>
<tr class="even">
<td>3</td>
<td>RGBW</td>
</tr>
<tr class="odd">
<td>4</td>
<td>WRGB</td>
</tr>
</tbody>
</table>
<p>The optional argument optGammaCorr can be set to enable gamma correction for this LED-buffer. Gamma correction makes the brightness non-linear matching the response of human eyes. Generally that makes colors look better and it is something that all monitors do. The downside is that fewer distinct colors are available as not all bits can be used.</p>
<p>Example:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true"></a><span class="co">; Create a buffer for 10 GRBW-LEDs</span></span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> strip1 </span>(rgbled-buffer <span class="dv">10</span> <span class="dv">2</span>))</span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true"></a></span>
<span id="cb487-4"><a href="#cb487-4" aria-hidden="true"></a><span class="co">; Create a buffer for 10 GRB-LEDs with gamma-correction enabled</span></span>
<span id="cb487-5"><a href="#cb487-5" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> strip2 </span>(rgbled-buffer <span class="dv">10</span> <span class="dv">0</span> <span class="dv">1</span>))</span></code></pre></div>
<hr />
<h4 id="rgbled-color">rgbled-color</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb488"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true"></a>(rgbled-color buffer led-num color optBrightness)</span></code></pre></div>
<p>Set LED led-num to color in buffer. The color is a number in WRGB8888 format, alternatively a list of numbers in WRGB8888 format. When a list of numbers is used all colors after led-num will be set to the corresponding colors in the list. When the white color is used the type must be u32 as all 32 bits are needed then. Buffer must be created with rgbled-buffer. Example:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true"></a><span class="co">; Create led-buffer and bind it to strip1</span></span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> strip1 </span>(rgbled-buffer <span class="dv">10</span> <span class="dv">2</span>))</span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true"></a></span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true"></a><span class="co">; Set the first LED to red</span></span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">0</span> <span class="bn">0x00FF0000</span>u32)</span>
<span id="cb489-6"><a href="#cb489-6" aria-hidden="true"></a></span>
<span id="cb489-7"><a href="#cb489-7" aria-hidden="true"></a><span class="co">; Set the second LED to white</span></span>
<span id="cb489-8"><a href="#cb489-8" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">1</span> <span class="bn">0xFF000000</span>u32)</span>
<span id="cb489-9"><a href="#cb489-9" aria-hidden="true"></a></span>
<span id="cb489-10"><a href="#cb489-10" aria-hidden="true"></a><span class="co">; Set the second LED to white with 30 % brightness</span></span>
<span id="cb489-11"><a href="#cb489-11" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">1</span> <span class="bn">0xFF000000</span>u32 <span class="fl">0.3</span>)</span>
<span id="cb489-12"><a href="#cb489-12" aria-hidden="true"></a></span>
<span id="cb489-13"><a href="#cb489-13" aria-hidden="true"></a><span class="co">; Set LED 4 to white, LED 5 to red and LED 6 to green, all at 40 % brightness</span></span>
<span id="cb489-14"><a href="#cb489-14" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">4</span> &#39;(<span class="bn">0xFF000000</span>u32 <span class="bn">0x00FF0000</span>u32 <span class="bn">0x0000FF00</span>u32) <span class="fl">0.4</span>)</span></code></pre></div>
<p>Note: This function only updates the color in the buffer. To show the new color the function rgbled-update must be used.</p>
<hr />
<h4 id="rgbled-update">rgbled-update</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb490"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true"></a>(rgbled-update buffer)</span></code></pre></div>
<p>Send buffer to the LEDs.</p>
<h3 id="multiple-led-strips">Multiple LED-strips</h3>
<p>It is possible to use multiple pins to drive different LED-strips. Even different types of LEDs can be used on the different pins. To do that more than one buffer can be used and rgbled-init can be used to move the driver to a different pin. Example:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true"></a><span class="co">; In this example a strip with 10 GRBW-LEDs is connected to</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true"></a><span class="co">; pin 20 and another strip with 10 GRB-LEDs is conneced to pin 21.</span></span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true"></a></span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true"></a><span class="co">; Buffer for 10 GRBW-LEDs</span></span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> strip1 </span>(rgbled-buffer <span class="dv">10</span> <span class="dv">2</span>))</span>
<span id="cb491-6"><a href="#cb491-6" aria-hidden="true"></a><span class="co">; Buffer for 10 GRB-LEDs</span></span>
<span id="cb491-7"><a href="#cb491-7" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> strip2 </span>(rgbled-buffer <span class="dv">10</span> <span class="dv">0</span>))</span>
<span id="cb491-8"><a href="#cb491-8" aria-hidden="true"></a></span>
<span id="cb491-9"><a href="#cb491-9" aria-hidden="true"></a><span class="co">; Write some colors to the buffers of the</span></span>
<span id="cb491-10"><a href="#cb491-10" aria-hidden="true"></a><span class="co">; two strips</span></span>
<span id="cb491-11"><a href="#cb491-11" aria-hidden="true"></a></span>
<span id="cb491-12"><a href="#cb491-12" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">0</span> <span class="bn">0x330000</span>)</span>
<span id="cb491-13"><a href="#cb491-13" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">1</span> <span class="bn">0x22000000</span>u32)</span>
<span id="cb491-14"><a href="#cb491-14" aria-hidden="true"></a>(rgbled-color strip1 <span class="dv">9</span> <span class="bn">0x003311</span>)</span>
<span id="cb491-15"><a href="#cb491-15" aria-hidden="true"></a></span>
<span id="cb491-16"><a href="#cb491-16" aria-hidden="true"></a>(rgbled-color strip2 <span class="dv">0</span> <span class="bn">0x330000</span>)</span>
<span id="cb491-17"><a href="#cb491-17" aria-hidden="true"></a>(rgbled-color strip2 <span class="dv">1</span> <span class="bn">0x22000000</span>u32)</span>
<span id="cb491-18"><a href="#cb491-18" aria-hidden="true"></a>(rgbled-color strip2 <span class="dv">6</span> <span class="bn">0x330011</span>)</span>
<span id="cb491-19"><a href="#cb491-19" aria-hidden="true"></a></span>
<span id="cb491-20"><a href="#cb491-20" aria-hidden="true"></a><span class="co">; Start the driver on pin 20 and send the first buffer</span></span>
<span id="cb491-21"><a href="#cb491-21" aria-hidden="true"></a>(rgbled-init <span class="dv">20</span>)</span>
<span id="cb491-22"><a href="#cb491-22" aria-hidden="true"></a>(rgbled-update strip1)</span>
<span id="cb491-23"><a href="#cb491-23" aria-hidden="true"></a></span>
<span id="cb491-24"><a href="#cb491-24" aria-hidden="true"></a><span class="co">; Now move the driver to pin 21 and send the other buffer. This</span></span>
<span id="cb491-25"><a href="#cb491-25" aria-hidden="true"></a><span class="co">; function will block until the previous update has finished.</span></span>
<span id="cb491-26"><a href="#cb491-26" aria-hidden="true"></a>(rgbled-init <span class="dv">21</span>)</span>
<span id="cb491-27"><a href="#cb491-27" aria-hidden="true"></a>(rgbled-update strip2)</span></code></pre></div>
<hr />
<h2 id="color-manipulation">Color Manipulation</h2>
<p>The following functions are useful for manipulating colors and lists of colors. The color format used here is RGB888 (or WRGB8888), which is compatible with both the display and the RGB LED extensions. This format is just a u32-number and it is also compatible with common hexadecimal color codes found in most color pickers and HTML color tables.</p>
<hr />
<h4 id="color-make">color-make</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb492"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true"></a>(color-make red green blue optWhite)</span></code></pre></div>
<p>Make color from individual color components. The components can be expressed in 0 to 255 or as floating point 0.0 to 1.0 (in any combination). optWhite is an optional argument for the white component, which often is used in RGBW LED-strips. Example:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true"></a>(color-make <span class="dv">37</span> <span class="dv">150</span> <span class="dv">90</span>) <span class="co">; Creates the color 0x2596be</span></span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true"></a>(color-make <span class="fl">0.146</span> <span class="fl">0.59</span> <span class="fl">0.747</span>) <span class="co">; Creates the color 0x2596be</span></span></code></pre></div>
<hr />
<h4 id="color-split">color-split</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb494"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true"></a>(color-split color optMode)</span></code></pre></div>
<p>Split color into a list of components. The optional argument optMode can be used to define how the color is split. The options are:</p>
<table>
<thead>
<tr class="header">
<th>Number</th>
<th>Mode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>(red green blue)</td>
</tr>
<tr class="even">
<td>1</td>
<td>(red green blue white)</td>
</tr>
<tr class="odd">
<td>2</td>
<td>(red-float green-float blue-float)</td>
</tr>
<tr class="even">
<td>3</td>
<td>(red-float green-float blue-float white-float)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true"></a>(color-split <span class="bn">0x123456</span>)</span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">18</span> <span class="dv">52</span> <span class="dv">86</span>)</span>
<span id="cb495-3"><a href="#cb495-3" aria-hidden="true"></a></span>
<span id="cb495-4"><a href="#cb495-4" aria-hidden="true"></a>(color-split <span class="bn">0x123456</span> <span class="dv">1</span>)</span>
<span id="cb495-5"><a href="#cb495-5" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">18</span> <span class="dv">52</span> <span class="dv">86</span> <span class="dv">0</span>)</span>
<span id="cb495-6"><a href="#cb495-6" aria-hidden="true"></a></span>
<span id="cb495-7"><a href="#cb495-7" aria-hidden="true"></a>(color-split <span class="bn">0x50123456</span>u32 <span class="dv">1</span>)</span>
<span id="cb495-8"><a href="#cb495-8" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">18</span> <span class="dv">52</span> <span class="dv">86</span> <span class="dv">80</span>)</span>
<span id="cb495-9"><a href="#cb495-9" aria-hidden="true"></a></span>
<span id="cb495-10"><a href="#cb495-10" aria-hidden="true"></a>(color-split <span class="bn">0x123456</span> <span class="dv">2</span>)</span>
<span id="cb495-11"><a href="#cb495-11" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="fl">0.070588</span>f32 <span class="fl">0.203922</span>f32 <span class="fl">0.337255</span>f32)</span>
<span id="cb495-12"><a href="#cb495-12" aria-hidden="true"></a></span>
<span id="cb495-13"><a href="#cb495-13" aria-hidden="true"></a>(color-split <span class="bn">0x123456</span> <span class="dv">3</span>)</span>
<span id="cb495-14"><a href="#cb495-14" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="fl">0.070588</span>f32 <span class="fl">0.203922</span>f32 <span class="fl">0.337255</span>f32 <span class="fl">0.000000</span>f32)</span>
<span id="cb495-15"><a href="#cb495-15" aria-hidden="true"></a></span>
<span id="cb495-16"><a href="#cb495-16" aria-hidden="true"></a>(color-split (color-make <span class="dv">123</span> <span class="dv">250</span> <span class="dv">99</span>))</span>
<span id="cb495-17"><a href="#cb495-17" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">123</span> <span class="dv">250</span> <span class="dv">99</span>)</span></code></pre></div>
<hr />
<h4 id="color-mix">color-mix</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb496"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true"></a>(color-mix color1 color2 ratio)</span></code></pre></div>
<p>Mix color1 with color2 with mix-ratio ratio. Ratio has a range of 0.0 to 1.0. Ratio 0.0 will result in color1 and ratio 1.0 will result in color2. The argument color1 can be a single color or a list of colors. If it is a list of colors a list with the mixed colors will be returned.</p>
<p>Example:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true"></a><span class="co">; Helper function to print colors as components</span></span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true"></a>(defun print-color (c)</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true"></a>    (<span class="kw">if</span> (eq (type-of c) type-list)</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true"></a>        (<span class="kw">print</span> (<span class="kw">map</span> (<span class="kw">fn</span> (x) (color-split x <span class="dv">1</span>)) c))</span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true"></a>        (<span class="kw">print</span> (color-split c <span class="dv">1</span>))</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true"></a>    )</span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true"></a>)</span>
<span id="cb497-8"><a href="#cb497-8" aria-hidden="true"></a></span>
<span id="cb497-9"><a href="#cb497-9" aria-hidden="true"></a>(print-color (color-mix (color-make <span class="dv">123</span> <span class="dv">250</span> <span class="dv">99</span>) (color-make <span class="dv">12</span> <span class="dv">25</span> <span class="dv">9</span>) <span class="fl">0.3</span>))</span>
<span id="cb497-10"><a href="#cb497-10" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">89</span> <span class="dv">182</span> <span class="dv">71</span> <span class="dv">0</span>)</span>
<span id="cb497-11"><a href="#cb497-11" aria-hidden="true"></a></span>
<span id="cb497-12"><a href="#cb497-12" aria-hidden="true"></a>(print-color (color-mix &#39;(<span class="bn">0x224488</span> <span class="bn">0x111111</span> <span class="bn">0x222222</span>) <span class="bn">0x446699</span> <span class="fl">0.5</span>))</span>
<span id="cb497-13"><a href="#cb497-13" aria-hidden="true"></a><span class="kw">&gt;</span> ((<span class="dv">51</span> <span class="dv">85</span> <span class="dv">144</span> <span class="dv">0</span>) (<span class="dv">42</span> <span class="dv">59</span> <span class="dv">85</span> <span class="dv">0</span>) (<span class="dv">51</span> <span class="dv">68</span> <span class="dv">93</span> <span class="dv">0</span>))</span></code></pre></div>
<hr />
<h4 id="color-add">color-add</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb498"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true"></a>(color-add color1 color2)</span></code></pre></div>
<p>Add color2 to color1. The components are truncated at 255. As with color-mix, the argument color1 can be a single color or a list with colors. Example:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true"></a><span class="co">; Helper function to print colors as components</span></span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true"></a>(defun print-color (c)</span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true"></a>    (<span class="kw">if</span> (eq (type-of c) type-list)</span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true"></a>        (<span class="kw">print</span> (<span class="kw">map</span> (<span class="kw">fn</span> (x) (color-split x <span class="dv">1</span>)) c))</span>
<span id="cb499-5"><a href="#cb499-5" aria-hidden="true"></a>        (<span class="kw">print</span> (color-split c <span class="dv">1</span>))</span>
<span id="cb499-6"><a href="#cb499-6" aria-hidden="true"></a>    )</span>
<span id="cb499-7"><a href="#cb499-7" aria-hidden="true"></a>)</span>
<span id="cb499-8"><a href="#cb499-8" aria-hidden="true"></a></span>
<span id="cb499-9"><a href="#cb499-9" aria-hidden="true"></a>(print-color (color-add (color-make <span class="dv">123</span> <span class="dv">250</span> <span class="dv">99</span>) (color-make <span class="dv">12</span> <span class="dv">25</span> <span class="dv">9</span>)))</span>
<span id="cb499-10"><a href="#cb499-10" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">135</span> <span class="dv">255</span> <span class="dv">108</span> <span class="dv">0</span>)</span>
<span id="cb499-11"><a href="#cb499-11" aria-hidden="true"></a></span>
<span id="cb499-12"><a href="#cb499-12" aria-hidden="true"></a>(print-color (color-add &#39;(<span class="bn">0x224488</span> <span class="bn">0x111111</span> <span class="bn">0x222222</span>) <span class="bn">0x446699</span>))</span>
<span id="cb499-13"><a href="#cb499-13" aria-hidden="true"></a><span class="kw">&gt;</span> ((<span class="dv">102</span> <span class="dv">170</span> <span class="dv">255</span> <span class="dv">0</span>) (<span class="dv">85</span> <span class="dv">119</span> <span class="dv">170</span> <span class="dv">0</span>) (<span class="dv">102</span> <span class="dv">136</span> <span class="dv">187</span> <span class="dv">0</span>))</span></code></pre></div>
<h4 id="color-sub">color-sub</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb500"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true"></a>(color-sub color1 color2)</span></code></pre></div>
<p>Subtract color2 from color1. The components are truncated at 0. As with color-mix, the argument color1 can be a single color or a list with colors.</p>
<hr />
<h4 id="color-scale">color-scale</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb501"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true"></a>(color-sub color factor)</span></code></pre></div>
<p>Scale color with factor. The result is truncated between 0 to 255. As with color-mix, the argument color can be a single color or a list with colors. The argument factor is a scaling factor. Example:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true"></a><span class="co">; Helper function to print colors as components</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true"></a>(defun print-color (c)</span>
<span id="cb502-3"><a href="#cb502-3" aria-hidden="true"></a>    (<span class="kw">if</span> (eq (type-of c) type-list)</span>
<span id="cb502-4"><a href="#cb502-4" aria-hidden="true"></a>        (<span class="kw">print</span> (<span class="kw">map</span> (<span class="kw">fn</span> (x) (color-split x <span class="dv">1</span>)) c))</span>
<span id="cb502-5"><a href="#cb502-5" aria-hidden="true"></a>        (<span class="kw">print</span> (color-split c <span class="dv">1</span>))</span>
<span id="cb502-6"><a href="#cb502-6" aria-hidden="true"></a>    )</span>
<span id="cb502-7"><a href="#cb502-7" aria-hidden="true"></a>)</span>
<span id="cb502-8"><a href="#cb502-8" aria-hidden="true"></a></span>
<span id="cb502-9"><a href="#cb502-9" aria-hidden="true"></a>(print-color (color-scale (color-make <span class="dv">123</span> <span class="dv">250</span> <span class="dv">99</span>) <span class="fl">2.0</span>))</span>
<span id="cb502-10"><a href="#cb502-10" aria-hidden="true"></a><span class="kw">&gt;</span> (<span class="dv">246</span> <span class="dv">255</span> <span class="dv">198</span> <span class="dv">0</span>)</span>
<span id="cb502-11"><a href="#cb502-11" aria-hidden="true"></a></span>
<span id="cb502-12"><a href="#cb502-12" aria-hidden="true"></a>(print-color (color-scale &#39;(<span class="bn">0x224488</span> <span class="bn">0x111111</span> <span class="bn">0x222222</span>) <span class="fl">0.6</span>))</span>
<span id="cb502-13"><a href="#cb502-13" aria-hidden="true"></a><span class="kw">&gt;</span> ((<span class="dv">20</span> <span class="dv">40</span> <span class="dv">81</span> <span class="dv">0</span>) (<span class="dv">10</span> <span class="dv">10</span> <span class="dv">10</span> <span class="dv">0</span>) (<span class="dv">20</span> <span class="dv">20</span> <span class="dv">20</span> <span class="dv">0</span>))</span></code></pre></div>
<hr />
<h2 id="file-de-compression">File (De-)Compression</h2>
<hr />
<h4 id="unzip">unzip</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb503"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true"></a>(unzip input fileInZip optOutputFile)</span></code></pre></div>
<p>Unzip input. Input can be a byte array or a file handle on the SD-card. FileInZip is the file in the zip-archive; if it is a string the filename will be used and if it is an integer its sequence number will be used. The optional argument optOutputFile can be used to specify a file to write the output to - if it is not provided the decompressed file is returned as a byte array.</p>
<p><strong>Note:</strong><br />
When optOutputFile is used the firmware buffer is used to temporally store the output file in order to make the operation as fast as possible. That means if anything is in the firmware buffer it will be destroyed. It also means that the maximum size of the output file is 1.5 MB.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true"></a><span class="co">; Unzip the first file of the archive test.zip (on the SD-card) to the byte array uz </span></span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f </span>(f-open <span class="st">&quot;test.zip&quot;</span> <span class="st">&quot;r&quot;</span>))</span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> uz </span>(unzip f <span class="dv">0</span>))</span>
<span id="cb504-4"><a href="#cb504-4" aria-hidden="true"></a>(f-close f)</span></code></pre></div>
<div class="sourceCode" id="cb505"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true"></a><span class="co">; Unzip the file hello.txt of the archive test.zip (on the SD-card) to the byte array uz </span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f </span>(f-open <span class="st">&quot;test.zip&quot;</span> <span class="st">&quot;r&quot;</span>))</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> uz </span>(unzip f <span class="st">&quot;hello.txt&quot;</span>))</span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true"></a>(f-close f)</span></code></pre></div>
<div class="sourceCode" id="cb506"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true"></a><span class="co">; Unzip the first file of the imported archive test.zip to the byte array uz </span></span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;test.zip&quot;</span> <span class="at">&#39;test</span>)</span>
<span id="cb506-3"><a href="#cb506-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> uz </span>(unzip <span class="kw">test</span> <span class="dv">0</span>))</span></code></pre></div>
<div class="sourceCode" id="cb507"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true"></a><span class="co">; Unzip the file hello.txt of the imported archive test.zip to the byte array uz </span></span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;test.zip&quot;</span> <span class="at">&#39;test</span>)</span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> uz </span>(unzip <span class="kw">test</span> <span class="st">&quot;hello.txt&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb508"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true"></a><span class="co">; Unzip the file hello.txt of the archive test.zip (on the SD-card) to the file hello.txt on the SD-card </span></span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f </span>(f-open <span class="st">&quot;test.zip&quot;</span> <span class="st">&quot;r&quot;</span>))</span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f-out </span>(f-open <span class="st">&quot;hello.txt&quot;</span> <span class="st">&quot;w&quot;</span>))</span>
<span id="cb508-4"><a href="#cb508-4" aria-hidden="true"></a>(unzip f <span class="st">&quot;hello.txt&quot;</span> f-out)</span>
<span id="cb508-5"><a href="#cb508-5" aria-hidden="true"></a>(f-close f)</span>
<span id="cb508-6"><a href="#cb508-6" aria-hidden="true"></a>(f-close f-out)</span></code></pre></div>
<div class="sourceCode" id="cb509"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true"></a><span class="co">; Unzip the file hello.txt of the archive imported test.zip to the file hello.txt on the SD-card </span></span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;test.zip&quot;</span> <span class="at">&#39;test</span>)</span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f-out </span>(f-open <span class="st">&quot;hello.txt&quot;</span> <span class="st">&quot;w&quot;</span>))</span>
<span id="cb509-4"><a href="#cb509-4" aria-hidden="true"></a>(unzip <span class="kw">test</span> <span class="st">&quot;hello.txt&quot;</span> f-out)</span>
<span id="cb509-5"><a href="#cb509-5" aria-hidden="true"></a>(f-close f-out)</span></code></pre></div>
<hr />
<h4 id="zip-ls">zip-ls</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb510"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true"></a>(zip-ls input)</span></code></pre></div>
<p>List all files in the archive input. Input can be a byte array or a file handle on the SD-card. Returns a list with the entries; each entry is a list where the first element is the name and the second element is the size when uncompressed.</p>
<p>Example:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true"></a><span class="co">; List all files in the archive test.zip on the SD-card</span></span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> f </span>(f-open <span class="st">&quot;test.zip&quot;</span> <span class="st">&quot;r&quot;</span>))</span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true"></a>(<span class="kw">print</span> (zip-ls f))</span>
<span id="cb511-4"><a href="#cb511-4" aria-hidden="true"></a>(f-close f)</span>
<span id="cb511-5"><a href="#cb511-5" aria-hidden="true"></a></span>
<span id="cb511-6"><a href="#cb511-6" aria-hidden="true"></a><span class="kw">&gt;</span> ((<span class="st">&quot;test.txt&quot;</span> <span class="dv">7</span>) (<span class="st">&quot;fw.bin&quot;</span> <span class="dv">291871</span>))</span></code></pre></div>
<div class="sourceCode" id="cb512"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true"></a><span class="co">; List all files in the imported archive test.zip</span></span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true"></a>(<span class="kw">import</span> <span class="st">&quot;test.zip&quot;</span> <span class="at">&#39;test</span>)</span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true"></a>(<span class="kw">print</span> (zip-ls <span class="kw">test</span>))</span>
<span id="cb512-4"><a href="#cb512-4" aria-hidden="true"></a></span>
<span id="cb512-5"><a href="#cb512-5" aria-hidden="true"></a><span class="kw">&gt;</span> ((<span class="st">&quot;test.txt&quot;</span> <span class="dv">7</span>) (<span class="st">&quot;fw.bin&quot;</span> <span class="dv">291871</span>))</span></code></pre></div>
<hr />
<h2 id="crypto">Crypto</h2>
<hr />
<h4 id="aes-ctr-crypt">aes-ctr-crypt</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb513"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true"></a>(aes-ctr-crypt <span class="kw">key</span> counter data start-offset length)</span></code></pre></div>
<p>Performs in-place AES-CTR (128/192/256) encryption/decryption. Counter will also be updated.</p>
<p>Example:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> data </span>[<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span>]) </span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> key </span>[<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span>]) </span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> counter </span>[<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span>])</span>
<span id="cb514-4"><a href="#cb514-4" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> start-offset </span><span class="dv">5</span>)</span>
<span id="cb514-5"><a href="#cb514-5" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> len </span><span class="dv">6</span>)</span>
<span id="cb514-6"><a href="#cb514-6" aria-hidden="true"></a><span class="co">; Encrypt data</span></span>
<span id="cb514-7"><a href="#cb514-7" aria-hidden="true"></a>(aes-ctr-crypt <span class="kw">key</span> counter data start-offset len)</span>
<span id="cb514-8"><a href="#cb514-8" aria-hidden="true"></a>(<span class="kw">print</span> data)</span>
<span id="cb514-9"><a href="#cb514-9" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">15</span> <span class="dv">146</span> <span class="dv">12</span> <span class="dv">189</span> <span class="dv">72</span> <span class="dv">100</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span>]</span>
<span id="cb514-10"><a href="#cb514-10" aria-hidden="true"></a>(<span class="kw">print</span> counter)</span>
<span id="cb514-11"><a href="#cb514-11" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">16</span>]</span>
<span id="cb514-12"><a href="#cb514-12" aria-hidden="true"></a><span class="co">; Reset counter</span></span>
<span id="cb514-13"><a href="#cb514-13" aria-hidden="true"></a>(setq counter [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span>])</span>
<span id="cb514-14"><a href="#cb514-14" aria-hidden="true"></a><span class="co">; Decrypt data</span></span>
<span id="cb514-15"><a href="#cb514-15" aria-hidden="true"></a>(aes-ctr-crypt <span class="kw">key</span> counter data start-offset len)</span>
<span id="cb514-16"><a href="#cb514-16" aria-hidden="true"></a>(<span class="kw">print</span> data)</span>
<span id="cb514-17"><a href="#cb514-17" aria-hidden="true"></a><span class="kw">&gt;</span> [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span>]</span></code></pre></div>
<hr />
<h2 id="sleep-modes">Sleep Modes</h2>
<hr />
<h4 id="sleep-deep">sleep-deep</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb515"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true"></a>(sleep-deep <span class="kw">time</span>)</span></code></pre></div>
<p>Put the CPU in deep sleep mode for time seconds. If time is negative the CPU will sleep forever, or until a wakeup pin triggers a wakeup. Waking up from sleep-deep results in a complete reset.</p>
<hr />
<h4 id="sleep-light">sleep-light</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb516"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true"></a>(sleep-light <span class="kw">time</span>)</span></code></pre></div>
<p>Put the CPU in light sleep mode for time seconds. Waking up will return to the point where sleep-light was called without a complete reset, but the power draw is much higher than for sleep-deep. Note that wifi and bluetooth are disabled when using this function, so they have to be enabled again when waking up.</p>
<hr />
<h4 id="sleep-config-wakeup-pin">sleep-config-wakeup-pin</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.02+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb517"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true"></a>(sleep-config-wakeup-pin pin state)</span></code></pre></div>
<p>Configure pin to wake up the CPU from sleep mode. The available pins are 0 to 5 and state can be 0 or 1. 0 means that a low state wakes up the CPU and 1 means that a high state wakes up the CPU.</p>
<hr />
<h4 id="rtc-data">rtc-data</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb518"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true"></a>(rtc-data)</span></code></pre></div>
<p>Returns a 4k byte array from RTC memory that can be used as a general purpose array. What is special about it is that it is retained in deep sleep mode, which is useful for storing state while the CPU is in deep sleep mode.</p>
<hr />
<h2 id="connection-checks">Connection Checks</h2>
<hr />
<h4 id="connected-wifi">connected-wifi</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb519"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true"></a>(connected-wifi)</span></code></pre></div>
<p>Check if any client (e.g. VESC Tool) is connected over wifi. Returns true when connected, nil otherwise.</p>
<hr />
<h4 id="connected-hub">connected-hub</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb520"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true"></a>(connected-hub)</span></code></pre></div>
<p>Check if we are connected to the TCP hub. Returns true when connected, nil otherwise. Notice that this does not tell if someone is connected to us using the hub, it only tells that we are connected to the hub and that others can connect to us.</p>
<hr />
<h4 id="connected-ble">connected-ble</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb521"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true"></a>(connected-ble)</span></code></pre></div>
<p>Check if any client (e.g. VESC Tool) is connected over ble. Returns true when connected, nil otherwise.</p>
<hr />
<h4 id="connected-usb">connected-usb</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.05+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb522"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true"></a>(connected-usb)</span></code></pre></div>
<p>Check if any client (e.g. VESC Tool) is connected over usb. Returns true when connected, nil otherwise.</p>
<hr />
<h2 id="non-volatile-storage-nvs">Non-Volatile Storage (NVS)</h2>
<p>The <code>nvs</code> and <code>qml</code> partition on the ESP32 can be used to store non-volatile data as key-values using <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/nvs_flash.html">Espressifs NVS library</a>.</p>
<p>A key is a string of maximum of 15 characters.</p>
<p>Functions operating on QML partition are named <code>nvs-qml-*</code></p>
<p>Note that QML-data cannot be stored as usual when using the QML-partition as NVS.</p>
<p>Functions using nvs partition are named <code>nvs-*</code>.</p>
<p>On the nvs partition, storage is shared wth <code>eeprom-*</code>.</p>
<hr />
<h4 id="nvs-erase">nvs-erase</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb523"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true"></a>(nvs-erase)</span></code></pre></div>
<p>Erase all nvs keys on nvs partition.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true"></a>(nvs-erase <span class="st">&quot;key&quot;</span>)</span></code></pre></div>
<p>Erase a specific key on nvs partition.</p>
<hr />
<h4 id="nvs-qml-erase">nvs-qml-erase</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb525"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true"></a>(nvs-qml-erase)</span></code></pre></div>
<p>Erase all nvs keys on qml partition.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true"></a>(nvs-qml-erase <span class="st">&quot;key&quot;</span>)</span></code></pre></div>
<p>Erase a specific key on qml partition.</p>
<hr />
<h4 id="nvs-qml-init">nvs-qml-init</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb527"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true"></a>(nvs-qml-init)</span></code></pre></div>
<p>Initialize the QML-partition with the NVS-module. This has to be done before further NVS-operations can be used. If needed, the QML-partition will be erased; this can happen if other data is stored on the QML-partition that is incompatible with the NVS-module.</p>
<hr />
<h4 id="nvs-read">nvs-read</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb528"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true"></a>(nvs-read <span class="kw">key</span>)</span></code></pre></div>
<p>Read key from nvs-partition, return the content as a byte array.</p>
<p>Returns <code>nil</code> if a key has not been written to previously.</p>
<hr />
<h4 id="nvs-qml-read">nvs-qml-read</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb529"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true"></a>(nvs-qml-read <span class="kw">key</span>)</span></code></pre></div>
<p>Read key from QML-partition, return the content as a byte array.</p>
<p>Returns <code>nil</code> if a key has not been written to previously.</p>
<hr />
<h4 id="nvs-write">nvs-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb530"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true"></a>(nvs-write <span class="kw">key</span> data)</span></code></pre></div>
<p>Write data to key on nvs-partition.</p>
<p>If key already exists the old data will be replaced.</p>
<p>This can fail if there is not enough space. The space on the nvs partition is shared with eeprom-* commands.</p>
<hr />
<h4 id="nvs-qml-write">nvs-qml-write</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb531"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true"></a>(nvs-qml-write <span class="kw">key</span> data)</span></code></pre></div>
<p>Write data to key on QML-partition. If key already exists the old data will be replaced. This can fail if (nvs-qml-init) has not been run or if there is not enough space.</p>
<hr />
<h4 id="nvs-qml-erase-partition">nvs-qml-erase-partition</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb532"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true"></a>(nvs-qml-erase-partition)</span></code></pre></div>
<p>Erase all nvs data from qml partition and deinitialize. This allows the QML partition to be used for QML if it was previously used for nvs storage.</p>
<hr />
<h4 id="nvs-list">nvs-list</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb533"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true"></a>(nvs-list)</span></code></pre></div>
<p>Return a list with all existing NVS keys on the nvs partition.</p>
<hr />
<h4 id="nvs-qml-list">nvs-qml-list</h4>
<table>
<thead>
<tr class="header">
<th>Platforms</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Express</td>
<td>6.06+</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb534"><pre class="sourceCode clj"><code class="sourceCode clojure"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true"></a>(nvs-qml-list)</span></code></pre></div>
<p>Return a list with all existing NVS keys on the <code>qml</code> partition.</p>
<p>If (nvs-qml-init) has not been run this always returns <code>nil</code>.</p>
<hr />
<h2 id="how-to-update">How to update</h2>
<p>To update from remote repository:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true"></a><span class="fu">git</span> remote add lispBM git@github.com:svenssonjoel/lispBM.git</span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true"></a><span class="fu">git</span> subtree pull --squash --prefix=lispBM/lispBM/ lispBM master</span></code></pre></div>
<p>The first command might fail if it already is added, but the second one should still work. If there are uncomitted changes you can run <strong>git stash</strong> before the commands and <strong>git stash pop</strong> after them.</p>
</div> <!-- Close pagefind-body -->
</div> <!-- Close container -->

<footer style="margin-top: 50px; padding: 20px; background: #f8f9fa; border-top: 1px solid #dee2e6; text-align: center;">
  <p>
    <a href="index.html" style="color: #007bff; text-decoration: none;">‚Üê Back to Reference Manual Index</a> |
    <a href="https://www.lispbm.com/" style="color: #007bff; text-decoration: none;">LispBM Home</a>
  </p>

  <p>
    Please contact me with questions, suggestions or feedback at blog
    (dot) joel (dot) svensson (at) gmail (dot) com or join the
    <a href="https://discord.gg/KgD4WcnFjv">Discord server</a>.
  </p>

  <p>&copy; Copyright 2026 Bo Joel Svensson</p>

  <p><small>This page was generated using <a href="https://pandoc.org/">Pandoc</a>.</small></p>
</footer>

</body>
</html>
