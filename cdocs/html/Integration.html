<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LispBM: LispBM Integration Safety Manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LispBM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">LispBM Integration Safety Manual</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>LispBM Integration Safety Manual</h1>
<h2>Document Information</h2>
<table class="doxtable">
<tr>
<td><b>Document Version:</b></td><td>DRAFT </td></tr>
<tr>
<td><b>LispBM Version:</b></td><td>0.33.0 </td></tr>
<tr>
<td><b>Last Updated:</b></td><td>September 2025 </td></tr>
</table>
<h3>Revision History</h3>
<p><em>Future versions of this document will include change logs highlighting modifications to integration requirements, safety considerations, and API changes that may affect existing integrations.</em></p>
<h2>Overview</h2>
<p>LispBM is designed to be integrated into larger systems as a sandboxed scripting runtime that interacts with the host system through well-defined, controlled mechanisms. This manual describes how to integrate LispBM correctly to maintain system safety and reliability.</p>
<p>An incorrectly integrated LispBM can compromise sandboxing, cause system instability, memory corruption, or unpredictable behavior. This document provides safety-focused integration guidelines.</p>
<h2>Sandboxed runtime system </h2>
<p>The LispBM runtime system is designed such that it cannot access or manipulate any memory not explicitly assigned to the runtime system for use as Heap, Arrays memory or image storage. </p>
<p>The programs running on the LispBM runtime system can communicate with the host application through usage of extensions or message-passing (via an events system). Note that extensions are implemented in C and can access, read/write, any memory. The extensions form the interface between the host application and the LispBM applications. The lispBM runtime system can do nothing to ensure that extensions are well behaved in relation to memory. </p>
<h2>Integration requirements</h2>
<p>LispBM requires the following functionality to be supplied by a HAL or RTOS: </p>
<ul>
<li>
A <b>Thread</b> abstraction. </li>
<li>
A <b>Mutex</b> implementation. </li>
</ul>
<p>If Chibios, FreeRTOS, Zephyr is used, LispBM can use the threading support supplied by these RTOSes. The threading abstraction is used at the border-line between the C application and the LispBM runtime system. The C application will start a thread for running the LispBM runtime system and scheduler. </p>
<p><br  />
</p>
<p>Mutexes are used on the inside of lispbm (as well as in the C application) to ensure that communication between C and LispBM is safe. As mutexes are used internally, a LispBM mutex abstraction is defined in the <code>platform</code> directory. </p>
<p>The LispBM mutex abstraction consists of: </p>
<ul>
<li>
A type: <code>mutex_t</code>.  </li>
<li>
Initialization function: <code>bool mutex_init(mutex_t *m)</code>. </li>
<li>
Lock function: <code>void mutex_lock(mutex_t *m)</code>. </li>
<li>
Unlock function: <code>void mutex_unlock(mutex_t *m)</code>. </li>
</ul>
<p>Here a FreeRTOS implementation of the LispBM mutex abstraction is shown as an example: </p>
<div class="fragment"><div class="line"><span class="comment">// In header file platform/freertos/include/platform_mutex.h</span></div>
<div class="line"><span class="preprocessor">#include &lt;freertos/FreeRTOS.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;freertos/semphr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> SemaphoreHandle_t mutex_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> mutex_init(mutex_t *m);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> mutex_lock(mutex_t *m);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> mutex_unlock(mutex_t *m);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// In source file platform/freertos/src/platform_mutex.c</span></div>
<div class="line"><span class="preprocessor">#include &quot;platform_mutex.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> mutex_init(mutex_t *m) {</div>
<div class="line">  *m = xSemaphoreCreateMutex();</div>
<div class="line">  <span class="keywordflow">if</span> (*m != NULL)</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> mutex_lock(mutex_t *m) {</div>
<div class="line">  xSemaphoreTake(*m, portMAX_DELAY);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> mutex_unlock(mutex_t *m) {</div>
<div class="line">  xSemaphoreGive(*m);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Porting LispBM to a different HAL or RTOS, X, requires an implementation of <code>platform/X/include/platform_mutex.h</code> and <code>platform/X/src/platform_mutex.c</code>.</p>
<h2>Building the LispBM runtime system</h2>
<p>LispBM is compiled into an application by the integrator. While the LispBM runtime system is thoroughly tested, differences in compiler version or libraries could reveal bugs. A final set of integration tests on the system as a whole is strongly recommended.</p>
<p>Practical building instructions can be found here <a class="el" href="Building.html">Building LispBM</a>.</p>
<h2>Configuring the LispBM runtime system</h2>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
